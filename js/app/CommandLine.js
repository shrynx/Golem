define(function(require,exports,module){{var e,t,r,n,i,o,s,a=module.uri||"";a.substring(0,a.lastIndexOf("/")+1)}n=require("React"),s=(o=require("hyper"))._div,e=require("ejquery"),i=require("./AceEditor"),r=require("./CommandMode"),module.exports=o(t=function(){function t(){}return t.prototype.propTypes={timeline:n.PropTypes.object.isRequired,onCommandExecution:n.PropTypes.func.isRequired,onCommandCompiled:n.PropTypes.func.isRequired,onCommandFailed:n.PropTypes.func.isRequired},t.prototype.getInitialState=function(){return{backgroundColor:"#222"}},t.prototype.handleMouseEnter=function(){return this.editor.focus(),this.props.onFocus()},t.prototype._getEditorNode=function(){return this.refs.ace.getDOMNode()},t.prototype.componentWillReceiveProps=function(t){var r,n,i;return r=t.focus,n=t.moduleName,i=t.updatedSource,r?this.editor.focus():e("input").blur(),i!==this.props.updatedSource&&this.editor.session.getMode().updateWorker(!1),this.editor.session.getMode().reportModuleName(n)},t.prototype.componentDidMount=function(){var t,n,o,s;return o=new r("COMMAND_LINE",this.props.completers),this.editor=n=i.edit(this._getEditorNode(),o,"ace/theme/tea"),n.setFontSize(13),n.renderer.setScrollMargin(2,2),n.setHighlightActiveLine(!1),n.setShowPrintMargin(!1),n.renderer.setShowGutter(!1),o.registerWithWorker(this.props.worker),o.setContent("",null,this.props.moduleName),n.renderer.on("themeLoaded",function(t){return function(){return t.setState({backgroundColor:e(t._getEditorNode()).css("background-color")})}}(this)),n.commands.addCommand({name:"execute",bindKey:{win:"Enter",mac:"Enter"},exec:function(){return function(){return o.handleEnter(),o.updateWorker(!0)}}(this)}),s=this.props.timeline,n.commands.addCommand({name:"previous",bindKey:{win:"Up",mac:"Up"},exec:function(){return s.isInPast()||s.temp(n.getValue()),o.setContent(s.goBack())}}),n.commands.addCommand({name:"following",bindKey:{win:"Down",mac:"Down"},exec:function(){return s.isInPast()?o.setContent(s.goForward()):void 0}}),n.commands.addCommand({name:"leave",bindKey:{win:"Esc",mac:"Esc"},exec:this.props.onLeave}),n.commands.addCommand({name:"jump to output",bindKey:{win:"Tab",mac:"Tab"},exec:function(e){return function(){return e.props.onFocusOutput(0)}}(this)}),n.commands.addCommand({name:"erase all output",bindKey:{win:"Ctrl-Shift-Backspace",mac:"Command-Shift-Backspace"},exec:function(e){return function(){return e.props.onRemoveAll()}}(this)}),t=o.worker,this.props.memory.loadCommands(s),t.on("ok",function(e){return function(t){var r,i,a,d,u;return u=t.data,i=u.result,d=u.type,r=u.commandSource,a=n.getValue(),a===r?"execute"===d||"command"===d?a.length>0?(s.push(a),"command"!==d&&o.setContent(""),o.resetEditing(),e.props.onCommandExecution(a,e.props.moduleName,i,d),e.props.memory.saveCommands(s)):e.props.onCommandCompiled():(o.updateAst(i.ast),e.props.onCommandCompiled()):void 0}}(this)),t.on("error",function(e){return function(t){var r;return r=t.data.text,console.log("command line error",r),e.props.onCommandFailed(r)}}(this))},t.prototype.render=function(){return s({onMouseEnter:this.handleMouseEnter},s({className:"areaBorder",style:{backgroundColor:this.state.backgroundColor}},s({ref:"ace",style:{width:"100%",height:23}})))},t}())});