define(function(require,exports,module){{var e,t,r,n,o,i,a,s=module.uri||"";s.substring(0,s.lastIndexOf("/")+1)}n=require("React"),a=(i=require("hyper"))._div,e=require("ejquery"),o=require("./AceEditor"),r=require("./CommandMode"),module.exports=i(t=function(){function t(){}return t.prototype.propTypes={timeline:n.PropTypes.object.isRequired,onCommandExecution:n.PropTypes.func.isRequired,onCommandCompiled:n.PropTypes.func.isRequired,onCommandFailed:n.PropTypes.func.isRequired},t.prototype.getInitialState=function(){return{backgroundColor:"#222"}},t.prototype.handleMouseEnter=function(){return this.editor.focus(),this.props.onFocus()},t.prototype._getEditorNode=function(){return this.refs.ace.getDOMNode()},t.prototype.componentWillReceiveProps=function(t){var r,n,o;return r=t.focus,n=t.moduleName,o=t.updatedSource,r?this.editor.focus():e("input").blur(),o!==this.props.updatedSource&&this.editor.session.getMode().updateWorker(!1),this.editor.session.getMode().reportModuleName(n)},t.prototype.componentDidMount=function(){var t,n,i,a;return i=new r("COMMAND_LINE",this.props.completers),this.editor=n=o.edit(this._getEditorNode(),i,"ace/theme/tea"),n.setFontSize(13),n.renderer.setScrollMargin(2,2),n.setHighlightActiveLine(!1),n.setShowPrintMargin(!1),n.renderer.setShowGutter(!1),i.registerWithWorker(this.props.worker),i.setContent("",null,this.props.moduleName),n.renderer.on("themeLoaded",function(t){return function(){return t.setState({backgroundColor:e(t._getEditorNode()).css("background-color")})}}(this)),n.commands.addCommand({name:"execute",bindKey:{win:"Enter",mac:"Enter"},exec:function(){return function(){return i.handleEnter(),i.updateWorker(!0)}}(this)}),a=this.props.timeline,n.commands.addCommand({name:"previous",bindKey:{win:"Up",mac:"Up"},exec:function(){return a.isInPast()||a.temp(n.getValue()),i.setContent(a.goBack())}}),n.commands.addCommand({name:"following",bindKey:{win:"Down",mac:"Down"},exec:function(){return a.isInPast()?i.setContent(a.goForward()):void 0}}),n.commands.addCommand({name:"leave",bindKey:{win:"Esc",mac:"Esc"},exec:this.props.onLeave}),n.commands.addCommand({name:"jump to output",bindKey:{win:"Tab",mac:"Tab"},exec:function(e){return function(){return e.props.onFocusOutput(0)}}(this)}),t=i.worker,this.props.memory.loadCommands(a),t.on("ok",function(e){return function(t){var r,o,s,d,u;return u=t.data,o=u.result,d=u.type,r=u.commandSource,s=n.getValue(),s===r?"execute"===d||"command"===d?s.length>0?(a.push(s),"command"!==d&&i.setContent(""),i.resetEditing(),e.props.onCommandExecution(s,e.props.moduleName,o,d),e.props.memory.saveCommands(a)):e.props.onCommandCompiled():(i.updateAst(o.ast),e.props.onCommandCompiled()):void 0}}(this)),t.on("error",function(e){return function(t){var r;return r=t.data.text,console.log("command line error",r),e.props.onCommandFailed(r)}}(this))},t.prototype.render=function(){return a({onMouseEnter:this.handleMouseEnter},a({className:"areaBorder",style:{backgroundColor:this.state.backgroundColor}},a({ref:"ace",style:{width:"100%",height:23}})))},t}())});