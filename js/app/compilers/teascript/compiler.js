define(function(require,exports,module){var __filename=module.uri||"",__dirname=__filename.substring(0,__filename.lastIndexOf("/")+1),ClassConstraint,Constrained,Context,ForAll,KindFn,QuantifiedVar,TempKind,TempType,TypeApp,TypeConstr,TypeVariable,Types,accessList,actualOpName,addAllToSet,addConstraints,addConstraintsFrom,addSiblingDefines,addToMap,addToSet,all,allDelims,allInjected,allMap,any,applyKindFn,arityOfKind,arrayToMap,arrayToSet,arrayType,arrowType,assignCompile,assignCompileAs,assignMethodTypes,astFromSource,astize,astizeExpression,astizeExpressionWithWrapper,astizeList,atomCompile,atomicType,auxiliaryDependencies,bindVariable,bindVariable_pure,blockOfLines,boolType,builtInDefinitions,builtInMacros,builtInTypeNames,cache_,callCompile,callConstructorPattern,callInfer,callInferSingle,callJsMethodCompile,callKnownCompile,callMacroCompile,callMacroExpand,callSaturatedKnownCompile,callTyping,callUnknownCompile,callUnknownTranslate,callZeroInfer,call_,charCompile,charType,checkTypes,cloneMap,cloneSet,cloneType,closeDelimFor,collapse,collectArgs,collectRequiresFor,colorize,combinePatterns,compileAstToJs,compileCtxAstToJs,compileCtxAstToJsAlways,compileCtxIrToJs,compileDeferred,compileExpression,compileModule,compileToJs,compileTopLevel,compileTopLevelAndExpression,compileTopLevelSource,compileVariableAssignment,compiledModules,concat,concatConcatMaps,concatMap,concatMaps,concatSets,concatTest,concreteReturnType,cond_,conditional,constPattern,constantLabeling,constantToSource,constraintsEqual,constraintsFromCanonicalType,constraintsFromInstance,constraintsFromReference,constraintsFromSuperClasses,constructCond,contextWithDependencies,controls,copyOrigin,crawl,createIndent,curriedType,debug,declareImported,declareImportedByDefault,declareMethods,declaredTypeMissingConstraint,declaredTypeTooGeneral,deferConstraints,deferCurrentDefinition,deferDeferred,deferredExpression,definitionList,definitionListCompile,definitionPairCompile,dependentToGraph,dictAccessors,dictConstructorFunction,dictForConstraint,dictsForConstraint,doIntersect,emptySubstitution,entail,entailedBySuperClasses,expandCall,exportAll,expressionCompile,expressionType,expressionsCompile,extractDocs,fakeCompile,fakeContext,fake_,filter,filterAst,filterMap,filterSet,finalizeTypes,findAvailableTypes,findClassType,findConstrained,findDataType,findDeclarables,findDeclarationFor,findDefinitions,findDefinitionsIncludingDeps,findDeps,findDocsFor,findFree,findFreeInList,findFree_pure,findMatchingDefinitions,findMatchingDefinitionsOnType,findSubClassParam,findSubstitutions,findSuperClassChain,findSuperClassInstances,findUnconstrained,first,firstOrCall,flatten,flattenType,fn_,forallToHumanReadable,formatFail,freshInstance,freshName,freshenType,functionReturnType,hashmapCompile,hashmapType,hashsetType,highlightType,highlightTypeForError,hoistWheres,htmlCalled,htmlDelimited,i,id,iife,immutable,importAny,imports,importsFor,inSet,inSub,includesJsType,indentLines,inferType,injectContext,injectedContext,instanceDictFor,instanceLookupFailed,instancePrefix,intersectMaps,intersectRight,intersectSets,irArray,irArrayTranslate,irCall,irCallTranslate,irDefinition,irDefinitionTranslate,irFunction,irFunctionTranslate,irJsCompatible,irJsCompatibleTranslate,irList,irListTranslate,irMap,irMapTranslate,irMethod,irMethodTranslate,irReference,irReferenceTranslate,irSet,irSetTranslate,isAlreadyParametrized,isAtom,isCall,isCapital,isComment,isConst,isConstructor,isCustomCollectionType,isDotAccess,isExpression,isExpressionOrFake,isFailed,isFake,isForm,isFunctionType,isLabel,isMapEmpty,isModuleAccess,isName,isNormalizedConstraint,isNormalizedConstraintArgument,isNormalizedConstraintArgument_pure,isNotCapital,isNotEmptyForm,isRecord,isSeq,isSetEmpty,isSimpleTranslated,isSplat,isSubset,isTranslated,isTuple,isTypeAnnotation,isValidTypeConstraint,isZeroArityFunctionType,join,joinSubs,joinSubs_pure,jsAccess,jsAccessTranslate,jsArray,jsArrayTranslate,jsAssign,jsAssignStatement,jsAssignStatementTranslate,jsAssignTranslate,jsBinary,jsBinaryMulti,jsBinaryMultiTranslate,jsBinaryTranslate,jsCall,jsCallMethod,jsCallTranslate,jsConditional,jsConditionalTranslate,jsDictionary,jsDictionaryTranslate,jsExprList,jsExprListTranslate,jsFunction,jsFunctionTranslate,jsMalformed,jsMalformedTranslate,jsMethod,jsMethodTranslate,jsNew,jsNewTranslate,jsNoop,jsNoopTranslate,jsReturn,jsReturnTranslate,jsTernary,jsTernaryTranslate,jsType,jsUnary,jsUnaryTranslate,jsValue,jsValueTranslate,jsVarDeclaration,jsVarDeclarationTranslate,jsVarDeclarations,jsVarDeclarationsTranslate,jsWrap,jsWrapTranslate,keysOfMap,kind,kindFn,kindFnNumArgs,kindFnOfArgs,kindedToHtml,kindsEq,labelComments,labelConflict,labelConflicts,labelDelimeters,labelDocs,labelMapping,labelOf,labelOperator,labelUsedParams,labeledToMap,leftDelims,library,listOf,listOfLines,listToPairsWith,listType,literalPattern,logError,lookupCompiledModule,lookupInMap,lookupJs,lookupOrAdd,malformed,map,mapCompile,mapKeys,mapMap,mapOrigin,mapOriginOnFunction,mapSet,mapSub,mapSyntax,mapToArray,mapToArrayVia,mapTyping,mapTypingBare,mapWithOrigin,markFake,markOrigin,matchBranchTranslate,matchType,matchType_pure,mergeSubs,moduleDependencies,moduleGraph,mostGeneralUnifier,mostGeneralUnifier_pure,ms,ms_List,ms_Map,ms_Set,ms_class,ms_comma,ms_cond,ms_data,ms_doset,ms_eq,ms_fn,ms_format,ms_global,ms_instance,ms_log,ms_macro,ms_match,ms_quote,ms_record,ms_req,ms_syntax,ms_type,ms_typed,ms_typed_expression,mutateMappingOrigin,mutateMarkingOrigin,nameCompile,nameTranslate,namespacedNameCompile,nestedAddToMap,nestedLookupInMap,newMap,newMapKeysVals,newMapWith,newSet,newSetWith,newSubstitution,newSubstitution_pure,niceName,normalizeConstraints,numType,numericalCompile,objectToMap,opNameToHtml,operatorCompile,originOf,pairs,pairsLeft,pairsRight,paramTupleIn,parentize,partition,partitionMap,patternCompile,plainPrettyPrint,polymorphicAssignCompile,preDeclareExplicitlyTyped,preDeclarePatterns,prefixWithInstanceName,prettyPrint,prettyPrintForError,prettyPrintWith,print,printFlattenedToHtml,printIr,printKind,printSubstitution,printType,printTypeToHtml,properTypeFn,ps,quantify,quantifyAll,quantifyConstraintFor,quantifyUnbound,reduceConstraints,reduceSet,regexCompile,regexType,rehashMap,removeAllFromSet,removeFromMap,removeFromSet,replaceConstraints,replaceInMap,replaceOrAddToMap,replaceQuantifiedByOrigin,replicate,requireName,requiresFor,reservedInJs,resolveDeferredTypes,retrieve,reverse,reverseModuleDependencies,rightDelims,runTest,runTests,runtimeDependencies,safePrintType,scopedName,seqCompile,seqOrMapCompile,setInSub,setToArray,simpleMacro,simplifyConstraints,sortBasedOnOriginPosition,sortCallArguments,sortedArgs,sortedStronglyConnectedComponents,spaceSeparatedPairs,specialCharacters,splatToName,star,stringCompile,stringType,string_,subIntersection,subLimit,subLimit_pure,subMagnitude,subStart,subToObject,subUnion,subUnion_pure,substitute,substituteList,substituteVarNames,substituteVarNames_pure,substitute_pure,substitutionFail,subtractContexts,subtractMaps,subtractSets,syntaxNameAs,syntaxNewName,syntaxType,syntaxedExpHtml,syntaxedType,tagFreeLabels,teas,termCompile,termsCompile,termsCompileExpectingSameType,termsCompileExpectingType,test,testNamed,tests,theme,themize,toConstrained,toForAll,toHtml,toJs,toJsString,toMatchTypes,toMatchTypes_pure,toMultilineJsString,toNameSets,token_,tokenize,topLevel,topLevelAndExpression,topLevelExpression,topLevelExpressionInModule,topLevelModule,topologicallySortedGroups,trackTransformation,translateIr,translateStatementsToJs,translateToJs,tryDeferConstraints,tupleCompile,tupleOfTypes,tupleType,tuple_,tuplize,typeCompile,typeConstant,typeConstrainedCompile,typeConstraintCompile,typeConstraintsCompile,typeConstructorCompile,typeEnumaration,typeEq,typeFail,typeFn,typeNameCompile,typeNamesOfNormalized,typeTupleCompile,typesCompile,uniformCollectionCompile,unify,unifyFail,unifyImpliedParams,unifyImpliedParams_pure,unifyTypesOfTerms,unifyTypesOfTermsWithType,unify_pure,unique,unzip,validIdentifier,values,varList,varNames,visitExpressions,walk,walkIr,withCache,withOrigin,zeroArrowType,zip,zipWith,__,_arguments,_assigns,_cache,_constraints,_empty,_fakeContext,_fn,_fst,_i,_is,_labelName,_labeled,_len,_names,_not,_notEmpty,_operator,_precs,_ref,_snd,_stringValue,_symbol,_tea,_terms,_type,_validArguments,_validTerms,__indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},__slice=[].slice;tokenize=function(e,t){var n,r,i,o,s,a;for(null==t&&(t=0),n=t,a=[];e.length>0;){if(i=e.match(RegExp("^(\\x20|\\n|["+controls+']|/([^\\s\\)\\}\\]]|\\\\/)([^/]|\\\\/)*?/[gmi]?|"(?:[^"\\\\]|\\\\.)*"|\\\\[^\\s][^\\s'+controls+"]*|[^"+controls+'\\\\"\\s]+)')),!i)throw new Error("Could not recognize a token starting with `"+e.slice(0,11)+"`");s=i[0],e=e.slice(s.length),o=n,n+=s.length,r=n,a.push(constantLabeling({symbol:s,start:o,end:r}))}return a},controls="\\(\\)\\[\\]\\{\\}",astize=function(e,t){var n,r,i,o,s,a,l,c,u,h,d,p;for(null==t&&(t=0),c=[],i=[],a=[[]],s=[],u=0,h=e.length;h>u;u++)if(l=e[u]," "===l.symbol&&(null!=s?s.length:void 0)<2*(t+a.length-1))s.push(l);else if((null!=s?s.length:void 0)>0&&a[a.length-1].push(createIndent(s)),s=void 0,"\n"===l.symbol&&(s=[]),d=l.symbol,__indexOf.call(leftDelims,d)>=0)o=[l],o.start=l.start,a.push(o);else if(p=l.symbol,__indexOf.call(rightDelims,p)>=0){if(r=a.pop(),!a[a.length-1])throw new Error("Missing opening delimeter matching "+l.symbol);if(l.symbol!==closeDelimFor[r[0].symbol])throw new Error("Wrong closing delimiter "+l.symbol+" for opening delimiter "+r[0].symbol);r.push(l),r.end=l.end,markFake(r),a[a.length-1].push(r)}else a[a.length-1].push(l);if(n=a[0][0])return n;throw new Error("Missing closing delimeter matching "+a[a.length-1][0].symbol)},leftDelims=["(","[","{"],rightDelims=[")","]","}"],allDelims=[].concat(leftDelims,rightDelims),closeDelimFor={"(":")","[":"]","{":"}"},createIndent=function(e){return{symbol:new Array(e.length+1).join(" "),start:e[0].start,end:e[e.length-1].end,label:"indent"}},markFake=function(e){var t,n,r,i,o,s,a,l,c,u,h;for(i=e[0],o=2<=e.length?__slice.call(e,1):[],s=0,a=o.length;a>s;s++)r=o[s],("whitespace"===(l=i.label)||"indent"===l||(c=i.symbol,t=__indexOf.call(leftDelims,c)>=0))&&("whitespace"===r.label||(u=r.symbol,n=__indexOf.call(rightDelims,u)>=0))&&(!t||!n||"{"!==(h=i.symbol)&&"["!==h)&&(r.fake=!0),i=r},constantLabeling=function(e){var t;return t=e.symbol,labelMapping(e,[["numerical",function(){return/^-?(\d+|Infinity)/.test(t)}],["label",function(){return isLabel(e)}],["string",function(){return/^"/.test(t)}],["char",function(){return/^\\/.test(t)}],["regex",function(){return/^\/.*\/[gmi]?$/.test(t)}],["paren",function(){return"("===t||")"===t}],["bracket",function(){return"["===t||"]"===t}],["brace",function(){return"{"===t||"}"===t}],["whitespace",function(){return/^\s+$/.test(t)}]])},labelMapping=function(e,t){var n,r,i,o,s;for(i=0,o=t.length;o>i;i++)if(s=t[i],r=s[0],n=s[1],n())return e.label=r,e;return e},labelOperator=function(e){return isForm(e)?labelDelimeters(e,"operator"):isFake(e)?void 0:e.label="operator"},labelDelimeters=function(e,t){var n,r,i,o;return r=e[0],i=3<=e.length?__slice.call(e,1,o=e.length-1):(o=1,[]),n=e[o++],r.label=n.label=t},crawl=function(e,t,n){var r,i,o,s;if(Array.isArray(e)){for(s=[],i=0,o=e.length;o>i;i++)r=e[i],s.push(crawl(r,t,e));return s}return t(e,e.symbol,n)},visitExpressions=function(e,t){var n,r,i,o,s;if(t(e),isForm(e)){for(o=_terms(e),s=[],r=0,i=o.length;i>r;r++)n=o[r],s.push(visitExpressions(n,t));return s}},teas=function(e,t){var n,r,i;return n=astize(tokenize(t)),r=e(i=new Context,n),{syntax:collapse(toHtml(n)),types:values(mapMap(__(highlightType,_type),subtractMaps(i._scope(),builtInDefinitions()))),translation:"\n"+r}},mapCompile=function(e,t){return e(new Context,astize(tokenize(t)))},mapTyping=function(e,t){var n,r,i;return n=astize(tokenize(t)),e(r=new Context,n),i=[],visitExpressions(n,function(e){return e.tea?i.push(""+collapse(toHtml(e))+" :: "+highlightType(e.tea)):void 0}),{types:values(mapMap(__(highlightType,_type),subtractMaps(r._scope(),builtInDefinitions()))),fails:map(formatFail,r.substitution.fails),ast:i,deferred:r.deferredBindings()}},formatFail=function(e){return e.message?join([e.message],map(__(collapse,toHtml),filter(_is,e.conflicts))):e},printSubstitution=function(e){return subToObject(mapSub(highlightType,e))},mapTypingBare=function(e,t){var n,r,i;return n=astize(tokenize(t)),e(r=new Context,n),i=[],visitExpressions(n,function(e){return e.tea?i.push([collapse(toHtml(e)),e.tea]):void 0}),{types:values(mapMap(_type,subtractMaps(r._scope(),builtInDefinitions()))),subs:r.substitution,ast:i,deferred:r.deferredBindings()}},highlightType=function(e){var t;return e?(t=astize(tokenize(printType(e))),syntaxType(t),collapse(toHtml(t))):"undefined"},subToObject=function(e){var t,n,r,i,o,s;for(n={},s=e.vars,t=i=0,o=s.length;o>i;t=++i)r=s[t],r&&(n[""+(t+e.start)]=r);return n},_type=function(e){return e.type},mapSyntax=function(e,t){var n;return n=astize(tokenize(t)),e(new Context,n),collapse(toHtml(n))},Context=function(){function e(){var e;this.definitions=[],this.variableIndex=0,this.typeVariabeIndex=0,this.logId=0,this.nameIndex=1,this.substitution=emptySubstitution(),this.statement=[],this.cacheScopes=[[]],this._assignTos=[],e=this._augmentScope(builtInDefinitions(),builtInMacros(),this.scopeIndex=0),e.typeNames=builtInTypeNames(),e.topLevel=!0,this.scopes=[e],this.savedScopes=[],this.classParams=newMap(),this.types=[],this.isMalformed=!1,this.importedModules=newSet(),this._requested=newMap()}return e.prototype.req=function(e,t){return addToMap(this._requested,e,t),this.isModuleLoaded(e)?void 0:this._requesting=!0},e.prototype.isModuleLoaded=function(e){return inSet(this.importedModules,e)},e.prototype.requested=function(){return this._requested.size>0?this._requested:void 0},e.prototype.isRequesting=function(){return this._requesting},e.prototype.markMalformed=function(){return this.isMalformed=!0},e.prototype.definePattern=function(e){if(this.isDefining())throw new Error("already defining, forgot to leaveDefinition?");return this._scope().definition={name:e&&!isFake(e)&&e.symbol,id:(null!=e?e.symbol:void 0)&&this.currentDeclarationId(e.symbol)||this.freshId(),pattern:e,inside:0,late:!1,deferredBindings:[],definedNames:[],usedNames:[],deferrable:!0,_defers:[]}},e.prototype.bareDefine=function(){return this.definePattern()},e.prototype.defineNonDeferrablePattern=function(e){var t;return t=this.definePattern(e),t.deferrable=!1},e.prototype.leaveDefinition=function(){return this._scope().definition=void 0},e.prototype.downInsideDefinition=function(){var e;return null!=(e=this._definition())?e.inside++:void 0},e.prototype.upInsideDefinition=function(){var e;return null!=(e=this._definition())?e.inside--:void 0},e.prototype.definitionName=function(){return this._definition().name},e.prototype.definitionId=function(){return this._definition().id},e.prototype.definitionPattern=function(){return this._definition().pattern},e.prototype._currentDefinition=function(){return this._scope().definition},e.prototype._currentDeferrableDefinition=function(){var e;return(e=this._scope().definition)&&e.deferrable&&e},e.prototype._definition=function(){return this._definitionAtScope(this.scopes.length-1)},e.prototype._definitionAtScope=function(e){return this.scopes[e].definition||e>0&&this._definitionAtScope(e-1)||void 0},e.prototype._deferrableDefinition=function(){return this._deferrableDefinitionAtScope(this.scopes.length-1)},e.prototype._deferrableDefinitionAtScope=function(e){var t;return(t=this.scopes[e].definition)&&t.deferrable&&t||e>0&&this._deferrableDefinitionAtScope(e-1)||void 0},e.prototype.parentDeferrableDefinitionNames=function(){return this._parentDeferrableDefinitionNames(this.scopes.length-1)},e.prototype._parentDeferrableDefinitionNames=function(e){var t,n;return n=e>0?this._parentDeferrableDefinitionNames(e-1):[],(t=this.scopes[e].definition)&&t.deferrable&&t.name?join([t.name],n):n},e.prototype.isDefining=function(){return!!this._scope().definition},e.prototype.isAtDefinition=function(){var e;return(e=this._currentDefinition())&&e.pattern&&0===e.inside},e.prototype.isAtBareDefinition=function(){var e;return(e=this._currentDefinition())&&0===e.inside},e.prototype.isAtSimpleDefinition=function(){return this.isAtDefinition()&&this.definitionName()},e.prototype.isAtNonDeferrableDefinition=function(){return this.isAtDefinition()&&!this._currentDefinition().deferrable},e.prototype.isAtDeferrableDefinition=function(){return this.isAtDefinition()&&this._currentDefinition().deferrable},e.prototype.setAssignTo=function(e){return this._assignTos.push({value:e})},e.prototype.assignTo=function(){var e;return null!=(e=this._assignTos[this._assignTos.length-1])?e.value:void 0},e.prototype.cacheAssignTo=function(){var e,t,n;return e=this._assignTos[this._assignTos.length-1],(null!=e?e.value:void 0)&&!e.cache?(n=this.newJsVariable(),t=[n,this.assignTo()],this._assignTos[this._assignTos.length-1]={value:n,cache:t}):void 0},e.prototype.resetAssignTo=function(){var e;return(e=this._assignTos.pop().cache)?[e]:[]},e.prototype._scope=function(){return this.scopes[this.scopes.length-1]},e.prototype._outerScope=function(){return this.scopes[this.scopes.length-2]},e.prototype.newScope=function(){return this.scopes.push(this._augmentScope(newMap(),newMap(),++this.scopeIndex))},e.prototype._augmentScope=function(e,t,n){return e.index=n,e.macros=t,e.deferred=[],e.deferredBindings=[],e.boundTypeVariables=newSet(),e.classes=newMap(),e.typeNames=newMap(),e.typeAliases=newMap(),e.deferredConstraints=[],e.usedNames=[],e.auxiliaries=newMap(),e},e.prototype.newLateScope=function(){var e;return this.newScope(),null!=(e=this._deferrableDefinition())?e.late=!0:void 0},e.prototype.closeScope=function(){var e;return e=this.scopes.pop(),this.savedScopes[e.index]={parent:this.currentScopeIndex(),definitions:cloneMap(e),deferredConstraints:e.deferredConstraints,boundTypeVariables:e.boundTypeVariables}},e.prototype.currentScopeIndex=function(){return this._scope().index},e.prototype.isInsideLateScope=function(){var e;return null!=(e=this._deferrableDefinition())?e.late:void 0},e.prototype.isInTopScope=function(){return this._scope().topLevel},e.prototype.addTypeName=function(e){var t,n,r;return e instanceof TypeApp?(r=e.op,n=r.name,t=r.kind):(n=e.name,t=e.kind),lookupInMap(this._scope().typeNames,n)instanceof TempKind&&removeFromMap(this._scope().typeNames,n),addToMap(this._scope().typeNames,n,t)},e.prototype.kindOfTypeName=function(e){var t,n,r,i,o;for(o=reverse(this.scopes),r=0,i=o.length;i>r;r++)if(n=o[r],t=lookupInMap(n.typeNames,e))return t},e.prototype.addTypeAlias=function(e,t){return addToMap(this._scope().typeAliases,e,t)},e.prototype.resolveTypeAliases=function(e){var t;return(t=lookupInMap(this._scope().typeAliases,e))?t:e},e.prototype.bindTypeVariables=function(e){var t,n,r,i,o,s;for(s=[],r=0,i=e.length;i>r;r++)o=e[r],t=o.name,n=o.ref,s.push(addToMap(this._scope().boundTypeVariables,t,n));return s},e.prototype.bindTypeVariableNames=function(e){var t,n,r,i;for(i=[],n=0,r=e.length;r>n;n++)t=e[n],i.push(addToMap(this._scope().boundTypeVariables,t,{}));return i},e.prototype.allBoundTypeVariables=function(){return this.allBoundTypeVariablesAt(this.currentScopeIndex())},e.prototype.allBoundTypeVariablesAt=function(e){var t;return substituteVarNames(this,concatMaps.apply(null,e===this.currentScopeIndex()?this.boundTypeVariablesInCurrentScopes():join(function(){var n;for(n=[];t=this.savedScopes[e];)e=t.parent,n.push(t.boundTypeVariables);return n}.call(this),this.boundTypeVariablesInCurrentScopes())))},e.prototype.boundTypeVariablesInCurrentScopes=function(){var e,t,n,r,i;for(r=this.scopes,i=[],t=0,n=r.length;n>t;t++)e=r[t],i.push(e.boundTypeVariables);return i},e.prototype.addToScopeConstraints=function(e){var t;return(t=this._scope().deferredConstraints).push.apply(t,e)},e.prototype.currentScopeConstraints=function(){return this._scope().deferredConstraints},e.prototype.isClassDefined=function(e){return!!this._classNamed(e)},e.prototype.addClass=function(e,t,n,r){return addToMap(this._scope().classes,e,{supers:n,constraint:t,instances:[],declarations:r})},e.prototype.classNamed=function(e){return this._classNamed(e)||function(){throw new Error("Class "+e+" is not defined")}()},e.prototype._classNamed=function(e){var t,n,r,i,o;for(o=reverse(this.scopes),r=0,i=o.length;i>r;r++)if(n=o[r],t=lookupInMap(n.classes,e))return t},e.prototype.addInstance=function(e,t){return this.classNamed(t.type.type.className).instances.push({name:e,type:t})},e.prototype.isMethod=function(e,t){var n;return any(function(){var r,i,o,s;for(o=t.constraints,s=[],r=0,i=o.length;i>r;r++)n=o[r].className,s.push(lookupInMap(this.classNamed(n).declarations,e));return s}.call(this))},e.prototype.declareMacro=function(e,t,n){return e.id=t.id=this.freshId(),e.scope=this.currentScopeIndex(),t.docs=n,addToMap(this._scope().macros,e.symbol,t)},e.prototype.isMacroDeclared=function(e){return!!this.macro(e)},e.prototype.macro=function(e){return this._macroInScope(this.scopes.length-1,e)},e.prototype._macroInScope=function(e,t){return lookupInMap(this.scopes[e].macros,t)||!this._declarationInScope(e,t)&&e>0&&this._macroInScope(e-1,t)||void 0},e.prototype.isDeclared=function(e){return!!this._declaration(e)},e.prototype.isFinallyDeclared=function(e){var t;return null!=(t=this._declaration(e))?t.final:void 0},e.prototype.isCurrentlyDeclared=function(e){return!!this._declarationInCurrentScope(e)},e.prototype.isFinallyCurrentlyDeclared=function(e){var t;return null!=(t=this._declarationInCurrentScope(e))?t.final:void 0},e.prototype.isFinallyDeclaredCurrentlyTyped=function(e){var t;return t=this._declarationInCurrentScope(e),(null!=t?t.final:void 0)&&(null!=t?t.type:void 0)},e.prototype.isTyped=function(e){return!!this.type(e)},e.prototype.isPreTyped=function(e){return!!this.preDeclaredType(e)},e.prototype.isFinallyTyped=function(e,t){return!!this.finalType(e,t)},e.prototype.type=function(e){var t;return null!=(t=this._declaration(e))?t.type:void 0},e.prototype.finalType=function(e,t){var n,r;return(n=null!=(r=this.savedDeclaration(e,t))?r.type:void 0)&&!(n instanceof TempType)&&n},e.prototype.preDeclaredType=function(e){var t;return null!=(t=this._preDeclaration(e))?t.type:void 0},e.prototype.currentDeclarations=function(){return cloneMap(this._scope())},e.prototype.scopeIndexOfDeclaration=function(e){return this._scopeOfDeclared(this.scopes.length-1,e).index},e.prototype.assignType=function(e,t){return this.assignTypeTo(e,this._declarationInCurrentScope(e),t)},e.prototype.assignTypeLate=function(e,t,n){return t!==this.currentScopeIndex()?this.assignTypeTo(e,this.savedDeclaration(e,t),n):this.assignType(e,n)},e.prototype.assignTypeTo=function(e,t,n){if(t){if(t.type&&!(t.type instanceof TempType))throw new Error("assignType: "+e+" already has a type");return t.type=n,this.types[t.id]=n}throw new Error("assignType: "+e+" is not declared")},e.prototype.assignArity=function(e,t){return this._declarationInCurrentScope(e).arity=t},e.prototype.addDefinitionSource=function(e,t){return this._declarationInCurrentScope(e).source=t},e.prototype.declareTyped=function(e,t){var n,r,i,o,s;for(s=[],n=i=0,o=e.length;o>i;n=++i)r=e[n],s.push(this.declare(r,{type:t[n]}));return s},e.prototype.declare=function(e,t){return t.final=!0,this._declare(e,t)},e.prototype.preDeclare=function(e,t){return t.final=!1,this._declare(e,t)},e.prototype.declareAsFinal=function(e,t){return this.savedDeclaration(e,t).final=!0},e.prototype._declare=function(e,t){return null==t.id&&(t.id=this.freshId()),replaceOrAddToMap(this._scope(),e,t)},e.prototype._preDeclaration=function(e){var t;return(t=this._declarationInCurrentScope(e))&&!t.final&&t},e.prototype._declarationInCurrentScope=function(e){return lookupInMap(this._scope(),e)},e.prototype._declaration=function(e){return this._lookupDeclaration(this.scopes.length-1,e)},e.prototype._lookupDeclaration=function(e,t){return this._declarationInScope(e,t)||e>0&&this._lookupDeclaration(e-1,t)||void 0},e.prototype._scopeOfDeclared=function(e,t){return this._declarationInScope(e,t)&&this.scopes[e]||e>0&&this._scopeOfDeclared(e-1,t)||void 0},e.prototype._declarationInScope=function(e,t){var n;return(n=lookupInMap(this.scopes[e],t))&&!n.isClass&&n},e.prototype.freshId=function(){return this.nameIndex++},e.prototype.savedDeclaration=function(e,t){var n;return t!==this.currentScopeIndex()?(n=this.savedScopes[t],lookupInMap(n.definitions,e)||this.savedDeclaration(e,n.parent)):this._declarationInCurrentScope(e)},e.prototype.addToDeferredNames=function(e){return this._deferrableDefinition().deferredBindings.push(e)},e.prototype.addToDeferredBindings=function(e){return this._scope().deferredBindings.push(e)},e.prototype.addToParentDeferred=function(e){return this._outerScope().deferredBindings.push(e)},e.prototype.addToDefinedNames=function(e){var t,n;return null!=(t=this._currentDefinition())&&null!=(n=t.definedNames)?n.push(e):void 0},e.prototype.addToUsedNames=function(e){return this._scopeOfDeclared(this.scopes.length-1,e).usedNames.push(e)},e.prototype.definedNames=function(){var e,t;return null!=(e=null!=(t=this._currentDefinition())?t.definedNames:void 0)?e:[]},e.prototype.usedNames=function(){return this._scope().usedNames},e.prototype.setUsedNames=function(e){return this._scope().usedNames=e},e.prototype.setAuxiliaryDefinitions=function(e){var t,n,r,i,o,s,a,l;for(t=newMap(),i=0,s=e.length;s>i;i++)if(n=e[i],n.definedNames)for(l=n.definedNames,o=0,a=l.length;a>o;o++)r=l[o],addToMap(t,r,{deps:unique(n.usedNames),defines:n.definedNames,definition:n});return this._scope().auxiliaries=t},e.prototype.auxiliaries=function(){return this._scope().auxiliaries},e.prototype.deferredNames=function(){return this._definition().deferredBindings},e.prototype.deferredBindings=function(){return this._scope().deferredBindings},e.prototype.currentDeclarationId=function(e){var t;return null!=(t=this._declarationInCurrentScope(e))?t.id:void 0},e.prototype.declarationId=function(e){var t;return null!=(t=this._declaration(e))?t.id:void 0},e.prototype.arity=function(e){var t;return null!=(t=this._declaration(e))?t.arity:void 0},e.prototype.tempType=function(e){var t;return null!=(t=this._declaration(e))?t.tempType:void 0},e.prototype.freshTypeVariable=function(e){var t;if(!e)throw new Error("Provide kind in freshTypeVariable");return t=freshName(this.typeVariabeIndex++),new TypeVariable(t,e)},e.prototype.extendSubstitution=function(e){return this.substitution=joinSubs(e,this.substitution)},e.prototype.newJsVariable=function(){return"i"+this.variableIndex++},e.prototype.doDefer=function(e,t){var n;return n=this._deferrableDefinition(),n._defers.push([e,t,this.currentScopeIndex()])},e.prototype.deferReason=function(){return this._deferReasonOf(this._deferrableDefinition())},e.prototype.shouldDefer=function(){return!!this._deferReasonOf(this._deferrableDefinition())},e.prototype._deferReasonOf=function(e){return null!=e?e._defers[0]:void 0},e.prototype.addDeferredDefinition=function(e){var t,n,r,i,o;return n=e[0],t=e[1],o=e[2],r=e[3],i=e[4],this._scope().deferred.push([n,t,o,r,i])},e.prototype.deferred=function(){return this._scope().deferred},e.prototype.addClassParams=function(e){return this.classParams=concatMaps(this.classParams,e)},e.prototype.classParamNameFor=function(e){var t;return t=this.classParamsForType(e),t?lookupInMap(t,e.className):void 0},e.prototype.classParamsForType=function(e){return nestedLookupInMap(this.classParams,typeNamesOfNormalized(e))},e.prototype.updateClassParams=function(){},e}(),expressionCompile=function(e,t){var n;if(!(e instanceof Context&&null!=t))throw new Error("invalid expressionCompile args");return n=isFake(t)?fakeCompile:isAtom(t)?atomCompile:isTuple(t)?tupleCompile:isSeq(t)?seqOrMapCompile:isCall(t)?callCompile:void 0,n?n(e,t):malformed(e,t,"not a valid expression")},callCompile=function(e,t){var n,r,i;return r=_operator(t),i=_symbol(r),isName(r)?(isDotAccess(r)?callJsMethodCompile:e.isMacroDeclared(i)&&!e.isDeclared(i)?callMacroCompile:isFake(r)||e.isFinallyDeclared(i)&&!e.arity(i)?callUnknownCompile:callKnownCompile)(e,t):(n=termCompile(e,r),isTranslated(n)?callUnknownTranslate(e,n,t):expressionCompile(e,replicate(t,call_(join([n],_arguments(t))))))},callMacroCompile=function(e,t){var n,r;return r=callMacroExpand(e,t),isTranslated(r)?r:(n=expressionCompile(e,r),retrieve(t,r),n)},callMacroExpand=function(e,t){var n,r;return r=_operator(t),r.label="keyword",r.scope=e.currentScopeIndex(),n=e.macro(r.symbol),r.id=n.id,n(e,t)},isTranslated=function(e){return isSimpleTranslated(e)||Array.isArray(e)&&(_empty(e)||isSimpleTranslated(e[0]))},isSimpleTranslated=function(e){return e.js||e.ir||e.precs||e.assigns},callUnknownCompile=function(e,t){return callUnknownTranslate(e,operatorCompile(e,t),t)},callKnownCompile=function(e,t){var n,r,i,o,s,a,l,c,u,h,d,p,f,m,g;return d=_operator(t),n=_labeled(_arguments(t)),l=labeledToMap(n),tagFreeLabels(e,n)?jsNoop():(p=e.arity(d.symbol))?(f=arrayToSet(p),m=filter(function(e){return!lookupInMap(l,e)},p),h=map(_snd,filter(function(e){var t,n;return t=e[0],n=e[1],!t},n)),a=map(_fst,filter(function(e){var t,n;return t=e[0],n=e[1],t&&!inSet(f,_labelName(t))},n)),map(function(t){return malformed(e,t,"Invalid label for "+d.symbol)},a),_notEmpty(a)?jsNoop():(o=m.slice(h.length),s=map(token_,function(){var e,t,n;for(n=[],e=0,t=o.length;t>e;e++)u=o[e],n.push("_"+u);return n}()),r=sortCallArguments(p,l,h,s),g=call_(d,r),e.assignTo()?isCapital(d)?n.length<p.length&&h.length>0?malformed(e,t,"curried constructor pattern"):(i=callConstructorPattern(e,g,o),retrieve(t,g),i):malformed(e,t,"function patterns not supported"):h.length<m.length?(c=fn_(s,[g]),trackTransformation(c,g),i=callMacroCompile(e,c),retrieve(t,c),e.savedScopes[e.savedScopes.length-1].definitions=newMap(),i):(i=e.isMacroDeclared(d.symbol)?callMacroCompile(e,g):callSaturatedKnownCompile(e,g),retrieve(t,g),h.length>m.length&&malformed(e,t,"Too many arguments to "+d.symbol),i))):callUnknownCompile(e,t)},sortedArgs=function(e,t){var n,r,i;return n=_labeled(_arguments(t)),r=labeledToMap(n),i=map(_snd,filter(function(e){var t,n;return t=e[0],n=e[1],!t},n)),sortCallArguments(e,r,i,[])},sortCallArguments=function(e,t,n,r){var i,o,s,a,l,c;for(s=map(id,n),i=map(id,r),c=[],a=0,l=e.length;l>a;a++)o=e[a],c.push(lookupInMap(t,o)||s.shift()||i.shift());return c},callConstructorPattern=function(e,t,n){var r,i,o,s,a,l,c,u,h,d,p;for(c=_operator(t),i=_arguments(t),l=function(e){var t;return isAtom(e)&&(t=_symbol(e),__indexOf.call(n,t)>=0)},u=e.arity(c.symbol),i.length-n.length>1&&e.cacheAssignTo(),o=function(){var t,n,o;for(o=[],a=t=0,n=i.length;n>t;a=++t)r=i[a],l(r)||(e.setAssignTo(jsAccess(e.assignTo(),u[a])),s=expressionCompile(e,r),o.push(withCache(e.resetAssignTo(),s)));return o}(),h=operatorCompile(e,t),d=0,p=i.length;p>d;d++)r=i[d],l(r)&&(r.tea=toConstrained(e.freshTypeVariable(star)));return callTyping(e,t),combinePatterns(join([h],o))},callSaturatedKnownCompile=function(e,t){var n,r,i,o;return o=_operator(t),n=_arguments(t),i=operatorCompile(e,t),r=termsCompile(e,n),callTyping(e,t),assignCompile(e,t,irCall(o.tea,i,r))},labeledToMap=function(e){var t;return t=function(e){var t,n;return t=e[0],n=e[1],[_labelName(t),n]},newMapKeysVals.apply(null,unzip(map(t,filter(all,e))))},tagFreeLabels=function(e,t){var n;return n=filter(function(e){var t,n;return t=e[0],n=e[1],!n},t),n.map(function(t){return malformed(e,t,"Missing value for a label")}),n.length>0},operatorCompile=function(e,t){var n,r;return r=_operator(t),e.downInsideDefinition(),n=expressionCompile(e,r),isAtom(r)&&labelOperator(r),e.upInsideDefinition(),n},callUnknownTranslate=function(e,t,n){var r,i;return i=_arguments(n),r=e.shouldDefer()?deferredExpression():termsCompile(e,i),callTyping(e,n),e.assignTo()?malformed(e,n,"Invalid pattern"):assignCompile(e,n,isFake(_operator(n))?jsNoop():jsCall("_"+i.length,join([t],r)))
},callTyping=function(e,t){var n,r,i;if(!e.shouldDefer()&&(i=_terms(t),n=_operator(t),all(function(){var e,t,n;for(n=[],e=0,t=i.length;t>e;e++)r=i[e].tea,n.push(r);return n}())))return t.tea=1===i.length?callZeroInfer(e,n,n.tea):callInfer(e,_operator(t),i)},callInfer=function(e,t,n){var r,i,o,s,a;return n.length>2?(s=2<=n.length?__slice.call(n,0,a=n.length-1):(a=0,[]),i=n[a++],callInferSingle(e,t,callInfer(e,t,s),i.tea)):(o=n[0],r=n[1],callInferSingle(e,t,o.tea,r.tea))},callInferSingle=function(e,t,n,r){var i,o;return o=withOrigin(e.freshTypeVariable(star),t),i=mapOriginOnFunction(typeFn(r.type,o),t),unify(e,n.type,i),new Constrained(join(n.constraints,r.constraints),o)},callZeroInfer=function(e,t,n){var r,i;return i=withOrigin(e.freshTypeVariable(star),t),r=mapOriginOnFunction(typeFn(i),t),unify(e,n.type,r),new Constrained(n.constraints,i)},termsCompile=function(e,t){var n,r,i,o;for(o=[],r=0,i=t.length;i>r;r++)n=t[r],o.push(termCompile(e,n));return o},termCompile=function(e,t){var n;return e.downInsideDefinition(),n=expressionCompile(e,t),e.upInsideDefinition(),n},expressionsCompile=function(e,t){var n,r,i,o;for(o=[],r=0,i=t.length;i>r;r++)n=t[r],o.push(expressionCompile(e,n));return o},tupleCompile=function(e,t){var n,r,i,o,s,a;return s=_terms(t),n=s.length,n>1&&e.cacheAssignTo(),r=function(){var t,n,r;if(e.assignTo()){for(r=[],a=t=0,n=s.length;n>t;a=++t)i=s[a],e.setAssignTo(jsAccess(e.assignTo(),""+a)),o=expressionCompile(e,i),r.push(withCache(e.resetAssignTo(),o));return r}return termsCompile(e,s)}(),e.shouldDefer()||(t.tea=withOrigin(tupleOfTypes(map(_tea,s)),t)),e.assignTo()?combinePatterns(r):(labelOperator(t),assignCompile(e,t,jsArray(r)))},withCache=function(e,t){return{precs:t.precs,assigns:e.concat(t.assigns||[])}},seqOrMapCompile=function(e,t){var n;return n=_terms(t),(_notEmpty(n)&&isLabel(n[0])?hashmapCompile:seqCompile)(e,t)},seqCompile=function(e,t){var n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,C,w;if(a=_validTerms(t),g=a.length,g>1&&e.cacheAssignTo(),m=e.assignTo()){for(l=!1,p=0,y=0,C=a.length;C>y;y++)if(o=a[y],isSplat(o)){if(l)return malformed(e,o,"Only one splat is allowed");l=!0}else p++;if(l&&0===p)return malformed(e,t,"Matching with splat requires at least one element name");for(v=!1,n=function(){var t,n,r,i;for(i=[],c=t=0,n=a.length;n>t;c=++t)o=a[c],r=isSplat(o)?(v=!0,o.label="name",[splatToName(o),jsCall("seq_splat",[c,a.length-c-1,m])]):(u=v?jsBinary("-",jsCall("seq_size",[m]),a.length-c):c,[o,jsCall("seq_at",[u,m])]),h=r[0],f=r[1],e.setAssignTo(f),d=expressionCompile(e,h),retrieve(o,h),i.push(withCache(e.resetAssignTo(),d));return i}(),s=e.freshTypeVariable(star),t.tea=new Constrained(concatMap(_constraints,map(_tea,a)),mapOrigin(new TypeApp(cloneType(arrayType),s),t)),b=0,w=a.length;w>b;b++)o=a[b],unify(e,o.tea.type,isSplat(o)?t.tea.type:s);return i=jsBinary(l?">=":"===",jsCall("seq_size",[m]),p),combinePatterns(join([{precs:[cond_(i)]}],n))}return _notEmpty(a)&&(a=_terms(t)),r=uniformCollectionCompile(e,t,a,arrayType),assignCompile(e,t,irArray(r))},isSplat=function(e){return isAtom(e)&&".."===_symbol(e).slice(0,2)},splatToName=function(e){return replicate(e,token_(_symbol(e).slice(2)))},hashmapCompile=function(e,t){var n,r,i,o,s,a,l;if(r=e.assignTo())throw new Error("matching on hash maps not supported yet");return l=unzip(pairs(_terms(t))),a=l[0],i=l[1],o=withOrigin(new TypeApp(hashmapType,stringType),t),n=uniformCollectionCompile(e,t,i,o),s=map(__(string_,_labelName),a),assignCompile(e,t,irMap(s,n))},uniformCollectionCompile=function(e,t,n,r,i){var o,s,a,l,c;return null==i&&(i=[]),l=mapWithOrigin(r,isCall(t)?_operator(t):t),c=termsCompileExpectingSameType(e,t,n),s=c.constraints,a=c.itemType,o=c.compiled,isCall(t)||labelOperator(t),t.tea=new Constrained(join(i,s),withOrigin(new TypeApp(l,a),t)),o},termsCompileExpectingSameType=function(e,t,n){var r;return r=withOrigin(e.freshTypeVariable(star),t),termsCompileExpectingType(e,r,n)},termsCompileExpectingType=function(e,t,n){var r,i;return r=termsCompile(e,n),i=unifyTypesOfTermsWithType(e,t,n),{constraints:i,itemType:t,compiled:r}},unifyTypesOfTerms=function(e,t){var n,r;return r=e.freshTypeVariable(star),n=unifyTypesOfTermsWithType(e,r,t),{itemType:r,constraints:n}},unifyTypesOfTermsWithType=function(e,t,n){var r,i,o,s;for(o=0,s=n.length;s>o;o++)i=n[o],i.tea&&unify(e,t,i.tea.type);return concatMap(_constraints,function(){var e,t,i;for(i=[],e=0,t=n.length;t>e;e++)r=n[e].tea,r&&i.push(r);return i}())},typeConstrainedCompile=function(e,t){var n,r,i;return i=_arguments(t),r=i[0],n=2<=i.length?__slice.call(i,1):[],new Constrained(typeConstraintsCompile(e,n),typeCompile(e,r))},typeCompile=function(e,t,n){var r;if(!t)throw new Error("invalid typeCompile args");return"function"==typeof(r=isAtom(t)?typeNameCompile:isTuple(t)?typeTupleCompile:isCall(t)?typeConstructorCompile:malformed(e,t,"not a valid type"))?r(e,t,n):void 0},typesCompile=function(e,t,n){var r,i,o,s,a;for(null==n&&(n=[]),a=[],i=o=0,s=t.length;s>o;i=++o)r=t[i],a.push(typeCompile(e,r,n[i]));return a},typeNameCompile=function(e,t,n){var r,i,o,s;return r=e.resolveTypeAliases(t.symbol),s=r===t.symbol?(o=isNotCapital(t)?n||star:e.kindOfTypeName(t.symbol),o instanceof TempKind?o=n||star:void 0,o?void 0:(isFake(t)?void 0:malformed(e,t,"This type name has not been defined"),o=star),isFake(t)?t.inferredType=!0:void 0,withOrigin(isFake(t)?e.freshTypeVariable(o):atomicType(t.symbol,o),t)):r,i=kind(s),n instanceof KindFn?labelOperator(t):isFake(t)||(t.label="typename"),s},typeTupleCompile=function(e,t){var n;return labelOperator(t),n=_terms(t),applyKindFn.apply(null,[withOrigin(tupleType(n.length),t)].concat(__slice.call(typesCompile(e,n))))},typeConstructorCompile=function(e,t){var n,r,i,o,s,a;return s=_operator(t),n=_arguments(t),isAtom(s)?(o=s.symbol,i=typesCompile(e,n),"Fn"===o?(labelOperator(s),mapOriginOnFunction(typeFn.apply(null,i),t)):(r=n.length,a=typeNameCompile(e,s,kindFn(r)),withOrigin(applyKindFn.apply(null,[a].concat(__slice.call(i))),t))):malformed(e,s,"Expected a type constructor instead")},typeConstraintCompile=function(e,t){var n,r,i,o,s;return isValidTypeConstraint(e,t)?(o=_operator(t),n=_arguments(t),labelOperator(o),r=o.symbol,i=e.classNamed(r).constraint,s=map(kind,i.types.types),withOrigin(new ClassConstraint(o.symbol,new Types(typesCompile(e,n,s))),t)):void 0},isValidTypeConstraint=function(e,t){var n;return isCall(t)?!isAtom(n=_operator(t))||isFake(n)?(malformed(e,t,"Class name required in a constraint"),!1):!0:(malformed(e,t,"Class constraint expected"),!1)},typeConstraintsCompile=function(e,t){var n;return filter(function(e){return e instanceof ClassConstraint},function(){var r,i,o;for(o=[],r=0,i=t.length;i>r;r++)n=t[r],isFake(n)||o.push(typeConstraintCompile(e,n));return o}())},assignCompile=function(e,t,n){return assignCompileAs(e,t,n,!1)},assignCompileAs=function(e,t,n,r){var i,o,s,a,l,c,u,h,d;return e.isAtDefinition()?(c=e.definitionPattern(),e.setAssignTo(irDefinition(t.tea,n,{name:e.definitionName(),scopeIndex:e.currentScopeIndex()})),d=patternCompile(e,c,t,r),l=d.precs,i=d.assigns,s=d.isMalformed,h=e.resetAssignTo(),e.shouldDefer()?deferCurrentDefinition(e,t):t.tea?s||isFake(t)?jsNoop():0===i.length?malformed(e,c,"Not an assignable pattern"):(u=map(compileVariableAssignment,join(h,i)),u.usedNames=e.usedNames(),u.definedNames=function(){var t,n,r,i;for(r=e.definedNames(),i=[],t=0,n=r.length;n>t;t++)a=r[t].name,i.push(a);return i}(),e.setUsedNames([]),u):jsNoop()):(e.isAtBareDefinition()&&t.tea&&(o=t.tea,deferConstraints(e,o.constraints,o,e.currentScopeIndex())),n)},deferCurrentDefinition=function(e,t){return e.addDeferredDefinition(e.deferReason().concat([e.definitionPattern(),t])),deferredExpression()},polymorphicAssignCompile=function(e,t,n){return assignCompileAs(e,t,n,!0)},patternCompile=function(e,t,n,r){var i,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,C,w,A;if(C=expressionCompile(e,t),p=C.precs,i=C.assigns,l=e.definedNames(),e.shouldDefer()){for(f=e.isDeclared(e.deferReason()[1]),g=0,y=l.length;y>g;g++)w=l[g],d=w.name,u=w.id,f&&!e.isFinallyCurrentlyDeclared(d)?e.declare(d,{id:u}):e.isCurrentlyDeclared(d)||e.preDeclare(d,{id:u});return{}}if(t.tea&&n.tea&&unify(e,n.tea.type,t.tea.type),!n.tea||isFake(t))return{precs:p,assigns:i,isMalformed:!0};for(o=n.tea.constraints,v=0,b=l.length;b>v;v++)A=l[v],d=A.name,u=A.id,m=A.type,c=e.deferredNames(),e.isFinallyDeclaredCurrentlyTyped(d)?(malformed(e,t,""+d+" is already declared"),h=!0):(e.isCurrentlyDeclared(d)||e.declare(d,{id:u}),c.length>0?(s=m,e.addToDeferredBindings({name:scopedName(d,e.currentScopeIndex()),id:d,scopeIndex:e.currentScopeIndex(),type:s,constraints:o,polymorphic:r,deps:c}),e.isTyped(d)||e.assignType(d,new TempType(m))):(a=inferType(e,d,m,o,r),e.addToScopeConstraints(a)));return 1===l.length&&e.addDefinitionSource(_fst(l).name,n),{precs:null!=p?p:[],assigns:null!=i?i:[],isMalformed:h}},inferType=function(e,t,n,r,i,o){var s,a,l,c,u,h,d,p,f,m,g,v,y,b;if(null==o&&(o=e.currentScopeIndex()),a=n,e.isFinallyTyped(t,o)){if(!includesJsType(a.type)&&(l=e.type(t),u=copyOrigin(freshInstance(e,l),l.type),v=quantifyUnbound(e,u),unify(e,a.type,u.type),g=u,h=quantifyUnbound(e,g),typeEq(h,v)||declaredTypeTooGeneral(e,h,v,g,l),d=function(t){var n;return n=entail(e,g.constraints,t)},p=filter(__(_not,d),r),m=deferConstraints(e,p,a,o).success,m&&(c=m[0],f=m[1],_notEmpty(f))))for(y=0,b=f.length;b>y;y++)s=f[y],declaredTypeMissingConstraint(e,t,s)}else{if(!e.isAtNonDeferrableDefinition()){if(m=deferConstraints(e,r,a,o).success,!m)return[];c=m[0],f=m[1],a=n}e.assignTypeLate(t,o,i?quantifyUnbound(e,addConstraints(a,f)):toForAll(a))}return e.declareAsFinal(t,o),c||[]},declaredTypeTooGeneral=function(e,t,n,r,i){var o,s,a,l,c,u,h,d,p,f,m;return f=matchType(copyOrigin(t.type.type,r.type),copyOrigin(n.type.type,i.type.type)).fails[0],o=f.conflicts,p=f.types,l=p[0],a=p[1],m=sortBasedOnOriginPosition(l,a),h=m[0],d=m[1],s=originOf(a),s&&isFake(s)?s.inferredType=replaceQuantifiedByOrigin(l):(u="inferred "+prettyPrintForError(l),c="got "+highlightTypeForError(s),e.extendSubstitution(substitutionFail({message:"declared type is too general, "+(h===l?""+u+", "+c:""+c+", "+u),conflicts:o})))},declaredTypeMissingConstraint=function(e,t,n){return e.extendSubstitution(substitutionFail({message:""+t+"'s declared type is too weak, missing "+prettyPrintForError(replaceQuantifiedByOrigin(n)),conflicts:[n,n.types.types[0]]}))},replaceQuantifiedByOrigin=function(e){return e.QuantifiedVar?e.origin&&"typename"===e.origin.label?new TypeVariable(print(e.origin),star):new TypeVariable(e["var"],star):e.TypeVariable&&e.ref.val?replaceQuantifiedByOrigin(e.ref.val):e.TypeVariable&&e.origin&&"typename"===e.origin.label?new TypeVariable(print(e.origin),e.kind):e.TypeApp?new TypeApp(replaceQuantifiedByOrigin(e.op),replaceQuantifiedByOrigin(e.arg)):e.ClassConstraint?new ClassConstraint(e.className,new Types(function(){var t,n,r,i;for(r=e.types.types,i=[],t=0,n=r.length;n>t;t++)e=r[t],i.push(replaceQuantifiedByOrigin(e));return i}())):e},topLevelExpression=function(e,t){var n,r,i;return e.bareDefine(),n=expressionCompile(e,t),r=e.deferReason(),e.leaveDefinition(),r?(t=r[0],i=r[1],void malformed(e,t,""+i+" is not defined")):t.tea?irDefinition(t.tea,n,null,!0):jsNoop()},topLevel=function(e,t){return definitionList(e,spaceSeparatedPairs(t))},topLevelModule=function(e,t){return function(n,r){return[jsAssignStatement(jsAccess("Shem",validIdentifier(e)),exportAll(n,join(importAny(t),topLevel(n,r))))]}},topLevelExpressionInModule=function(e){return function(t,n){return iife(concat([toJsString("use strict;"),importAny(e),[jsReturn(topLevelExpression(t,n))]]))}},definitionList=function(e,t){return concat(definitionListCompile(e,t))},definitionListCompile=function(e,t){var n,r,i,o,s;for(r=function(){var r,s,a,l;for(l=[],r=0,s=t.length;s>r&&(a=t[r],i=a[0],o=a[1],o||(malformed(e,i,"missing value in definition"),o=fake_()),n=definitionPairCompile(e,i,o),!e.isRequesting());r++)l.push(n);return l}(),e.isRequesting(),s=!0;s;)r=join(r,compileDeferred(e)),s=_notEmpty(e.deferredBindings()),resolveDeferredTypes(e);return deferDeferred(e),filter(_is,r)},resolveDeferredTypes=function(e){var t,n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,C,w,A,x,E,_,T,S,F,D,k,M,R,L,B,O,N,I;if(_notEmpty(e.deferredBindings()))for(v=topologicallySortedGroups(e.deferredBindings()),i=newMap(),c=newSet(),A=0,T=v.length;T>A;A++){for(g=v[A],s=newMap(),b=!1,R=e.deferredBindings(),x=0,S=R.length;S>x;x++)if(o=R[x],inSet(g,o.name))for(t=lookupOrAdd(s,o.name,{types:[]}),t.id=o.id,t.scopeIndex=o.scopeIndex,t.types.push(o.type),t.constraints=o.constraints,t.polymorphic=o.polymorphic,t.deps=o.deps,L=o.deps,E=0,F=L.length;F>E;E++)h=L[E],n=lookupOrAdd(s,h.name,{types:[]}),null==n.id&&(n.id=h.id),null==n.scopeIndex&&(n.scopeIndex=h.scopeIndex),n.types.push(h.type),h.defining&&(f=lookupInMap(i,h.name),t.constraints=join(t.constraints,f||[]));w=newMap(),B=values(s);for(y in B)if(o=B[y],a=e.finalType(o.id,o.scopeIndex))for(O=o.types,_=0,D=O.length;D>_;_++)C=O[_],unify(e,C.type,mapOrigin(freshInstance(e,a).type,C.type.origin));else e.isDeclared(o.id)&&!e.isCurrentlyDeclared(o.id)&&!o.deps||inSet(c,y)?b=!0:addToMap(w,y,o);N=values(w);for(y in N){for(o=N[y],a=toConstrained(e.freshTypeVariable(star)),u=[],I=o.types,M=0,k=I.length;k>M;M++)C=I[M],unify(e,a.type,C.type);p=concat(function(){var t,n,r,i;for(r=o.deps||[],i=[],n=0,t=r.length;t>n;n++)h=r[n],!h.defining&&(d=e.finalType(h.id,h.scopeIndex))&&i.push(constraintsFromCanonicalType(e,d,h.type));return i}()),r=join(o.constraints||[],p),b?(e.addToParentDeferred({name:y,id:o.id,scopeIndex:o.scopeIndex,type:m=addConstraints(a,r),constraints:r,polymorphic:o.polymorphic,deps:o.deps}),e.addToDeferredNames({name:y,id:o.id,scopeIndex:o.scopeIndex,type:m,defining:!0}),addToSet(c,y)):(l=inferType(e,o.id,a,r,o.polymorphic,o.scopeIndex),addToMap(i,y,l),o.scopeIndex===e.currentScopeIndex()&&e.addToScopeConstraints(l||[]))}}return e.deferredBindings().length=0},compileDeferred=function(e){var t,n,r,i,o,s,a,l,c,u;if(t=[],_notEmpty(e.deferred()))for(r=0;_notEmpty(e.deferred())&&r<e.deferred().length;)a=e.deferred().length,u=n=e.deferred().shift(),o=u[0],i=u[1],c=u[2],s=u[3],l=u[4],c!==e.currentScopeIndex()&&e.isDeclared(i)||e.isTyped(i)?(t.push(definitionPairCompile(e,s,l)),r=0):(e.addDeferredDefinition(n),r++);return t},deferDeferred=function(e){var t,n,r,i,o,s,a,l,c;if(_notEmpty(e.deferred())){for(a=e.deferred(),c=[],o=0,s=a.length;s>o;o++)l=a[o],n=l[0],t=l[1],r=l[2],i=l[3],c.push(e.isInTopScope()?malformed(e,n,""+t+" is not defined"):e.isCurrentlyDeclared(t)?void 0:e.doDefer(n,t));return c}},definitionPairCompile=function(e,t,n){var r,i;return e.definePattern(t),r=expressionCompile(e,n),i=e.shouldDefer(),e.leaveDefinition(),i?void 0:r},importAny=function(e){var t,n;return concat(function(){var r,i;r=values(e),i=[];for(t in r)n=r[t],i.push(imports(t,n));return i}())},exportAll=function(e,t){var n,r,i,o;return o=function(e,t){return!t.virtual&&t.final},i=filterMap(o,e._scope()),r=subtractSets(i,builtInDefinitions()),n=map(validIdentifier,setToArray(r)),iife(concat([toJsString("use strict"),t,[jsReturn(jsDictionary(n,n))]]))},ms={},ms.fn=ms_fn=function(e,t){var n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,C,w,A,x,E,_,T,S;if(n=_arguments(t),v=n[0],l=2<=n.length?__slice.call(n,1):[],w=paramTupleIn(e,t,v),null==l&&(l=[]),0===l.length)return malformed(e,t,"Missing function result");for(T=partition(isComment,l),c=T[0],l=T[1],isTypeAnnotation(l[0])?(A=l[0],r=l[1],x=3<=l.length?__slice.call(l,2):[]):(r=l[0],x=2<=l.length?__slice.call(l,1):[]),y=_names(w),(d=e.isAtSimpleDefinition())&&(A?(o=typeConstrainedCompile(e,A),h=preDeclareExplicitlyTyped(e,o,c),e.assignArity(d,y)):(u=extractDocs(c),e.isFinallyCurrentlyDeclared(d)||e.preDeclare(d,{arity:y,id:e.definitionId(),type:e.preDeclaredType(d),docs:u}))),e.newLateScope(),p=function(t){return t.scope=e.currentScopeIndex(),withOrigin(e.freshTypeVariable(star),t)},b=map(p,w),C=map(__(toForAll,toConstrained),b),e.bindTypeVariables(b),e.declareTyped(y,C),E=0,_=w.length;_>E;E++)g=w[E],g.id=e.currentDeclarationId(_symbol(g));return preDeclarePatterns(e,_fst(unzip(pairs(x)))),s=definitionListCompile(e,pairs(x)),e.setAuxiliaryDefinitions(s),r&&(i=termCompile(e,r)),f=concat(findDefinitionsIncludingDeps(e,e.usedNames())),e.setUsedNames([]),a=e.currentScopeConstraints(),e.closeScope(),labelUsedParams(join(c,r?join([r],x):x),y),polymorphicAssignCompile(e,t,e.shouldDefer()?deferredExpression():(m=_operator(t),t.tea=m.tea=r&&r.tea?new Constrained(join(r.tea.constraints,a),mapOriginOnFunction(typeFn.apply(null,__slice.call(b).concat([null!=(S=r.tea)?S.type:void 0])),t)):h?copyOrigin(freshInstance(e,h),o):void 0,irFunction({name:d,params:y,body:join(f,[jsReturn(i)])})))},labelUsedParams=function(e,t){var n,r;return n=function(e){var n;return isName(e)&&"name"!==e.label&&(n=_symbol(e),__indexOf.call(t,n)>=0)},r=function(e){return map(function(e){return e.label="param"},filterAst(n,e))},map(r,e)},preDeclareExplicitlyTyped=function(e,t,n){var r,i,o;return r=quantifyUnbound(e,t),copyOrigin(r.type,t),o=e.definitionName(),i=e.definitionId(),e.isPreTyped(o)&&(r=e.preDeclaredType(o)),e.isFinallyCurrentlyDeclared(o)?malformed(e,e.definitionPattern(),"This name is already taken"):e.preDeclare(o,{id:i,type:r,docs:extractDocs(n)}),r},preDeclarePatterns=function(e,t){var n,r,i,o,s;for(s=[],i=0,o=t.length;o>i;i++)r=t[i],e.definePattern(r),e.doDefer(void 0,void 0),e.setAssignTo(!0),n=patternCompile(e,r),e.resetAssignTo(),s.push(e.leaveDefinition());return s},extractDocs=function(e){var t,n,r,i,o;if(map(labelComments,e),e=e[0],n=function(e){return function(t){return"indent"===t.label?{symbol:t.symbol.slice(e)}:t}},e&&isComment(e)){for(i=3;null!=(o=e[i].symbol)?o.match(/\s+/):void 0;)i++;return r=_fst(filter(function(e){var t;return t=e.label,"indent"===t},e)),t=e.slice(i,e.length-1),print(r?crawl(t,n(r.symbol.length)):t)}},ms.type=ms_type=function(e,t){var n,r,i;return r=requireName(e,"Name required to declare new type alias"),n=e.definitionName(),isCapital({symbol:n})||malformed(e,e.definitionPattern(),"Type aliases must start with a capital letter"),i=_arguments(t)[0],e.addTypeAlias(n,typeCompile(e,i)),jsNoop()},ms.data=ms_data=function(e,t){var n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,C,w,A,x,E,_,T,S,F,D,k,M,R;if(d=requireName(e,"Name required to declare new algebraic data"),r=_validArguments(t),isTuple(r[0])&&(D=r,x=D[0],r=2<=D.length?__slice.call(D,1):[],E=paramTupleIn(e,t,x)),null==E&&(E=[]),u=pairsLeft(isAtom,r),k=unzip(u),g=k[0],A=k[1],map(syntaxNewName(e,"Type constructor name required"),g),!d)return jsNoop();for(l=e.definitionName(),y=function(e){return null==e&&(e=[]),map(_labelName,filter(_is,map(_fst,_labeled(_validTerms(e)))))},M=findDataType(e,A,E,l),h=M.fieldTypes,c=M.dataType,p=_=0,S=u.length;S>_;p=++_)for(R=u[p],i=R[0],w=R[1],C=h[p],s=w?typeFn.apply(null,join(C,[c])):c,v=y(w),e.declare(i.symbol,{type:quantifyUnbound(e,toConstrained(s)),arity:w?v:void 0}),i.tea=s,p=T=0,F=v.length;F>T;p=++T)m=v[p],e.declare(""+i.symbol+"-"+m,{arity:[""+i.symbol[0].toLowerCase()+i.symbol.slice(1)],type:quantifyUnbound(e,toConstrained(typeFn(c,C[p])))});return e.addTypeName(c),concat(function(){var e,t,r,s;for(s=[],e=0,t=u.length;t>e;e++)r=u[e],i=r[0],w=r[1],f=validIdentifier(i.symbol),v=y(w),b=v.map(validIdentifier),a=jsAssignStatement(""+f+"._value",w?jsCall("λ"+b.length,[jsFunction({params:b,body:[jsReturn(jsNew(f,b))]})]):jsNew(f,[])),o=dictConstructorFunction(i.symbol,b),n=dictAccessors(i.symbol,f,b,u.length),s.push(concat([o,n,[a]]));return s}())},findDataType=function(e,t,n,r){var i,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b;for(v=map(_symbol,n),g=arrayToSet(v),c=newMap(),e.addTypeName(new TypeConstr(r,new TempKind)),o=function(){var n,r,i;for(i=[],n=0,r=t.length;r>n;n++)d=t[n],d?isRecord(d)?i.push(function(){var t,n,r,i,o;for(r=_snd(unzip(_labeled(_validTerms(d)))),o=[],t=0,n=r.length;n>t;t++)if(p=r[t]){h=typeCompile(e,p),i=values(findFree(h));for(u in i)l=i[u],inSet(g,u)?(s=lookupInMap(c,u))?kindsEq(s,l)||malformed(e,p,"Type variable "+u+" must have the same kind"):addToMap(c,u,l):malformed(e,p,"Type variable "+u+" not declared");o.push(h)}return o}()):(malformed(e,d,"Required a record of types"),i.push([])):i.push([]);return i}(),y=0,b=n.length;b>y;y++)f=n[y],lookupInMap(c,_symbol(f))||malformed(e,f,"Data type parameter not used");return a=mapMap(function(t){return e.freshTypeVariable(t)},c),i=kindFnOfArgs.apply(null,map(function(e){return lookupInMap(c,e)},v)),m=map(function(e){return new TypeVariable(e,lookupInMap(c,e))},v),{dataType:substitute(a,applyKindFn.apply(null,[new TypeConstr(r,i)].concat(__slice.call(m)))),fieldTypes:map(function(e){return substituteList(a,e)},o)}},ms.record=ms_record=function(e,t){var n,r,i,o,s,a,l,c,u,h;for(n=_validArguments(t),r=requireName(e,"Name required to declare new record"),isTuple(n[0])?(c=n,s=c[0],n=2<=c.length?__slice.call(c,1):[]):s=tuple_([]),u=_labeled(n),a=0,l=u.length;l>a;a++)h=u[a],i=h[0],o=h[1],i||malformed(e,o,"Label is required"),o||malformed(e,i,"Missing type");return 0===n.length&&malformed(e,t,"Missing field declarations"),r?replicate(t,call_(token_("data"),[s,token_(e.definitionName()),tuple_(n)])):"malformed"},ms[":"]=ms_typed=function(e,t){var n,r,i,o,s,a,l,c,u;return a=requireName(e,"Name required to declare typed values for now"),u=partition(isComment,_arguments(t)),s=u[0],o=u[1],c=o[0],r=o[1],l=3<=o.length?__slice.call(o,2):[],n=isSeq(r)?(i=typeConstraintsCompile(e,_terms(r)),c?new Constrained(i,typeCompile(e,c)):void 0):typeConstrainedCompile(e,filter(__(_not,isComment),t)),a&&preDeclareExplicitlyTyped(e,n,s),jsNoop()},ms["::"]=ms_typed_expression=function(e,t){var n,r,i,o,s,a,l,c;return c=partition(isComment,_arguments(t)),s=c[0],o=c[1],l=o[0],r=o[1],a=o[2],isSeq(r)?i=typeConstraintsCompile(e,_terms(r)):(i=[],a=r),n=new Constrained(i,typeCompile(e,l)),e.isAtSimpleDefinition()&&preDeclareExplicitlyTyped(e,n,s),t.tea=n,assignCompile(e,t,termCompile(e,a))},ms.global=ms_global=function(e,t){return t.tea=toConstrained(markOrigin(jsType,t)),assignCompile(e,t,jsValue("global"))},callJsMethodCompile=function(e,t){var n,r,i,o;return o=_validTerms(t),r=o[0],i=o[1],n=3<=o.length?__slice.call(o,2):[],labelOperator(r),t.tea=toConstrained(markOrigin(jsType,t)),assignCompile(e,t,i?/^.-/.test(r.symbol)?jsAccess(termCompile(e,i),r.symbol.slice(2)):jsMethod(termCompile(e,i),r.symbol.slice(1),termsCompile(e,n)):(malformed(e,t,"Missing an object"),jsNoop()))},ms["set!"]=ms_doset=function(e,t){var n,r,i,o,s;return s=_arguments(t),i=s[0],n=s[1],i&&(o=termCompile(e,i)),n&&(r=termCompile(e,n)),t.tea=toConstrained(markOrigin(jsType,t)),o&&r?jsAssign(o,r):jsNoop()},ms["class"]=ms_class=function(e,t){var n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,C,w,A,x,E,_;for(u=requireName(e,"Name required to declare a new class"),w=_validArguments(t),p=w[0],a=2<=w.length?__slice.call(w,1):[],m=paramTupleIn(e,t,p),f=_names(m),A=partition(isComment,a),l=A[0],a=A[1],r=a[0],y=2<=a.length?__slice.call(a,1):[],isSeq(r)?i=typeConstraintsCompile(e,_terms(r)):(y=a,i=[]),v=map(quantifyConstraintFor(f),i),g=map(function(e){var t;return t=e.className},i),h=pairs(y),e.newScope(),e.bindTypeVariableNames(f),definitionList(e,h),o=e.currentDeclarations(),e.closeScope(),b=0,C=h.length;C>b;b++)x=h[b],d=x[0],s=x[1],null!=(E=lookupInMap(o,d.symbol))&&(E.def=s);return u?(d=e.definitionName(),e.isClassDefined(d)?malformed(e,"class already defined",e.definitionPattern()):(_=findClassType(e,m,d,f,o,i),n=_.classConstraint,c=_.freshedDeclarations,n?(e.addClass(d,n,v,c),declareMethods(e,n,c),e.declare(d,{isClass:!0}),dictConstructorFunction(d,keysOfMap(c),g)):jsNoop())):jsNoop()},quantifyConstraintFor=function(e){return function(t){var n,r;return new ClassConstraint(t.className,new Types(function(){var i,o,s,a;for(s=t.types.types,a=[],i=0,o=s.length;o>i;i++)r=s[i],r.TypeVariable?(n=e.indexOf(r.name),a.push(new QuantifiedVar(n))):a.push(r);return a}()))}},findClassType=function(e,t,n,r,i,o){var s,a,l,c,u,h,d,p,f,m,g,v,y,b,C,w;for(h=mapMap(function(){return void 0},arrayToSet(r)),m=join(map(function(e){return{type:e}},o),map(function(e){var t,n;return n=e.type,t=e.def,{type:n.type,def:t}},mapToArray(i))),v=0,b=m.length;b>v;v++)for(w=m[v],f=w.type,a=w.def,g=findFree(f),y=0,C=r.length;C>y;y++)p=r[y],u=lookupInMap(h,p),l=lookupInMap(g,p),u&&l&&!kindsEq(l,u)&&malformed(e,a,"All methods must use the class paramater of the same kind"),l&&replaceInMap(h,p,l);return all(function(){var n,r,i;for(i=[],n=0,r=t.length;r>n;n++)p=t[n],lookupInMap(h,_symbol(p))||(malformed(e,p,"A class paramater must occur in at least one method's type"),i.push(!1));return i}())?(c=mapMap(function(t){return e.freshTypeVariable(t)},h),s=function(e){return substitute(c,new TypeVariable(e,lookupInMap(h,e)))},d=function(e){var t,n,r,i;return t=e.arity,i=e.type,r=e.docs,n=e.def,{arity:t,docs:r,def:n,type:substitute(c,i)}},{classConstraint:new ClassConstraint(n,new Types(map(s,r))),freshedDeclarations:mapMap(d,i)}):{}},declareMethods=function(e,t,n){var r,i,o,s,a,l;a=values(n);for(o in a)l=a[o],r=l.arity,i=l.docs,s=l.type,s=quantifyUnbound(e,addConstraints(freshInstance(e,s),[t])),e.declare(o,{arity:r,docs:i,type:s,virtual:!0})},ms.instance=ms_instance=function(e,t){var n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,C,w,A;return u=requireName(e,"Name required to declare a new instance"),A=_validArguments(t),d=A[0],a=2<=A.length?__slice.call(A,1):[],d&&isValidTypeConstraint(e,d)?(f=typeConstraintCompile(e,d),i=a[0],w=2<=a.length?__slice.call(a,1):[],isSeq(i)?o=typeConstraintsCompile(e,_terms(i)):(w=a,o=[]),r=f.className,(n=e.classNamed(r))?(C=findSuperClassInstances(e,f.types,n),u?(p=e.definitionName(),c=freshInstance(e,quantifyUnbound(e,new Constrained(o,f.types))),c?(l=c.constraints,h=quantifyAll(new Constrained(l,new ClassConstraint(f.className,c.type))),e.addInstance(p,h),e.newScope(),assignMethodTypes(e,d,c,p,n),s=pairs(w),y=definitionList(e,prefixWithInstanceName(e,s,p)),e.closeScope(),e.shouldDefer()?deferCurrentDefinition(e,t):(v=map(function(e){var t;return t=e.rhs},y),g=function(){var e,t,n,r;for(r=[],e=0,t=s.length;t>e;e++)n=s[e],m=n[0],b=n[1],r.push(null!=b?b.tea:void 0);return r}(),all(g)?(e.declare(p,{virtual:!1}),jsVarDeclaration(validIdentifier(p),irDefinition(new Constrained(l,tupleOfTypes(g).type),jsNew(validIdentifier(r),join(C,v))))):(malformed(e,t,"missing type of a method"),jsNoop()))):jsNoop()):malformed(e,t,"An instance requires a name")):malformed(e,_operator(d),"Class doesn't exist")):malformed(e,t,"Requiring the instance type")},assignMethodTypes=function(e,t,n,r,i){var o,s,a,l,c,u,h,d,p,f,m,g,v;if(a=findFree(i.constraint),u=mapMap(function(t){return e.freshTypeVariable(t)},a),c=mapOrigin(substitute(u,i.constraint.types),_operator(t)),isFailed(s=mostGeneralUnifier(c,n.type)))return e.extendSubstitution(s),null;e.bindTypeVariableNames(setToArray(findFree(n))),g=values(i.declarations);for(d in g)v=g[d],o=v.arity,m=v.type,l=freshInstance(e,m),h=substitute(u,l),f=quantifyUnbound(e,addConstraints(h,n.constraints)),p=instancePrefix(r,d),e.preDeclare(p,{arity:o,type:f});return n},prefixWithInstanceName=function(e,t,n){var r,i,o,s,a,l,c;for(c=[],s=0,a=t.length;a>s;s++)l=t[s],r=l[0],o=l[1],syntaxNewName(e,"Method name required",r)===!0?(i=instancePrefix(n,r.symbol),r.tea=e.type(i),c.push([token_(i),o])):c.push([r,o]);return c},instancePrefix=function(e,t){return""+e+"_"+t},findSuperClassInstances=function(e,t,n){var r,i,o,s,a;for(i=substituteList(t.types,n.supers),a=[],o=0,s=i.length;s>o;o++)r=i[o],a.push(instanceDictFor(e,r));return a},ms.match=ms_match=function(e,t){var n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,C,w,A,x,E,_,T,S;return e.assignTo()?malformed(e,t,"not a valid pattern"):(T=_arguments(t),C=T[0],i=2<=T.length?__slice.call(T,1):[],C?(i.length%2!==0&&malformed(e,t,"match missing result for last pattern"),w=termCompile(e,C),b=e.freshTypeVariable(star),e.setAssignTo(w),e.cacheAssignTo(),_=[],c=map(id,(null!=(S=C.tea)?S.constraints:void 0)||[]),u=null!=e.definitionName()?" in "+e.definitionName():"",m=e.usedNames(),a=function(){var t,o,a,l,u,h;for(a=pairs(i),h=[],t=0,o=a.length;o>t;t++)l=a[t],g=l[0],y=l[1],e.setUsedNames([]),e.newScope(),e.defineNonDeferrablePattern(g),u=patternCompile(e,g,C,!1),v=u.precs,n=u.assigns,y&&(e.setAssignTo(void 0),s=termCompile(e,y),e.resetAssignTo()),e.leaveDefinition(),e.closeScope(),r=e.usedNames(),e.shouldDefer()||(y&&(unify(e,b,y.tea.type),c.push.apply(c,y.tea.constraints),_.push.apply(_,findDeclarables(v))),h.push([r,v,n,s]));return h}(),E=unzip(a)[0],f=map(findDeps(e),E),d=addSiblingDefines(e,intersectSets(f)),o=conditional(function(){var t,r,i,o,c;for(c=[],h=t=0,r=a.length;r>t;h=++t)i=a[h],x=i[0],v=i[1],n=i[2],s=i[3],s&&(p=f[h],o=matchBranchTranslate(v,n,s),l=o[0],n=o[1],c.push([l,join(findDefinitions(e,setToArray(subtractSets(p,d))),n)]));return c}(),"throw new Error("+toMultilineJsString("match failed to match "+print(C)+u)+");"),e.setUsedNames(join(m,setToArray(d))),A=e.resetAssignTo(),t.tea=new Constrained(c,b),assignCompile(e,t,iife(concat(filter(_is,[map(compileVariableAssignment,A),varList(_),o]))))):malformed(e,t,"match `subject` missing"))},matchBranchTranslate=function(e,t,n){var r,i,o;return o=constructCond(e),r=o.conds,i=o.preassigns,[r,concat([map(compileVariableAssignment,join(i,t)),[jsReturn(n)]])]},varList=function(e){return e.length>0?jsVarDeclarations(e):null},conditional=function(e,t){var n,r,i;return 1===e.length&&(i=e[0],r=i[0],n=i[1],"true"===r)?n:jsConditional(e,t)},ms.req=ms_req=function(e,t){var n,r,i,o,s,a,l,c,u;if(s=e.definitionPattern(),a=_validTerms(s),!isTuple(s)||_empty(a))return malformed(e,s,"req requires a tuple of names to be required");if(map(syntaxNewName(e,"definition name to be imported required"),a),i=_validArguments(t)[0],!i||!isName(i))return malformed(e,t,"req requires a module name to require from");if(i.label="module",r=i.symbol,l=arrayToSet(filter(_is,map(_symbol,a))),e.req(r,l),e.isModuleLoaded(r))for(c=0,u=a.length;u>c;c++)n=a[c],isName(n)?(o=n.symbol,e.isFinallyTyped(o,e.currentScopeIndex())?malformed(e,n,""+o+" already declared"):e.isCurrentlyDeclared(n.symbol)?(n.id=e.currentDeclarationId(o),n.imported={module:r,name:o},declareImported(e,o)):malformed(e,n,""+o+" was not declared in "+r)):malformed(e,n,"Name required");return imports(r,setToArray(l))},declareImportedByDefault=function(e,t){var n,r,i,o,s;o=values(t),s=[];for(n in o)i=o[n],s.push(e.isModuleLoaded(n)?function(){var t,n,o;for(o=[],t=0,n=i.length;n>t;t++)r=i[t],o.push(declareImported(e,r));return o}():void 0);return s},declareImported=function(e,t){return e.assignType(t,e.tempType(t)),e.declareAsFinal(t,e.currentScopeIndex())},imports=function(e,t){var n,r,i,o,s,a;for(r=validIdentifier(e),a=[],o=0,s=t.length;s>o;o++)n=t[o],i=validIdentifier(n),a.push(jsVarDeclaration(i,jsAccess(jsAccess("Shem",r),i)));return a},ms.format=ms_format=function(e,t){var n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,v;if(m={n:numType,i:numType,s:stringType,c:charType},v=_arguments(t),s=v[0],n=2<=v.length?__slice.call(v,1):[],!s)return malformed(e,t,"Format string required.");if(i=termsCompile(e,n),e.shouldDefer())return jsNoop();if(!all(map(_tea,n)))return t.tea=toConstrained(stringType),malformed(e,t,"Argument not typed");t.tea=new Constrained(concatMap(__(_constraints,_tea),n),markOrigin(stringType,t)),g=[],o=_stringValue(s);for(h in m)f=m[h],markOrigin(f,s);for(;o.length>0&&(c=o.match(/^(.*?(?:^|[^\\]|\\\\))\%(.)/));)u=c[0],d=c[1],p=c[2],p in m?g.push({type:m[p],symbol:p,prefix:d}):malformed(e,o,"Found an unsupported control character "+p),o=o.slice(u.length);return n.length>g.length&&malformed(e,t,"Too many arguments to format"),a=function(){var t,o,s,a;for(a=[],l=t=0,o=g.length;o>t;l=++t)s=g[l],f=s.type,p=s.symbol,d=s.prefix,n[l]&&(r=i[l],unify(e,f,n[l].tea.type),a.push([string_(d),function(){switch(p){case"s":return r;case"c":return r;case"n":return r;case"i":return jsUnary("~",jsUnary("~",r))}}()]));return a}(),assignCompile(e,t,jsBinaryMulti("+",join(concat(a),[string_(o)])))},ms.cond=ms_cond=function(e,t){var n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,C,w;
return n=_arguments(t),w=unzip(pairs(n)),s=w[0],y=w[1],v=filter(_is,y),a=termsCompileExpectingType(e,markOrigin(boolType,t),s),f=e.usedNames(),o=function(){var t,n,r;for(r=[],t=0,n=v.length;n>t;t++)g=v[t],e.setUsedNames([]),i=termCompile(e,g),r.push([e.usedNames(),i]);return r}(),l=unifyTypesOfTerms(e,v),C=unzip(o)[0],p=map(findDeps(e),C),h=intersectSets(p),r=function(){var t,n,r,i;for(i=[],u=t=0,n=o.length;n>t;u=++t)r=o[u],b=r[0],m=r[1],d=p[u],i.push(join(findDefinitions(e,setToArray(subtractSets(d,h))),[jsReturn(m)]));return i}(),e.setUsedNames(join(f,setToArray(h))),c=null!=e.definitionName()?" in "+e.definitionName():"",t.tea=new Constrained(join(a.constraints,l.constraints),l.itemType),assignCompile(e,t,r.length>0?iife([jsConditional(zip(a.compiled.slice(0,r.length),r),"throw new Error('cond failed to match"+c+"');")]):jsNoop())},findDefinitionsIncludingDeps=function(e,t){return findDefinitions(e,setToArray(findDeps(e)(unique(t))))},findDefinitions=function(e,t){var n,r,i,o;return i=e.auxiliaries(),n=newSet(),concat(function(){var e,s,a;for(a=[],e=0,s=t.length;s>e;e++)o=t[e],r=lookupInMap(i,o),r&&!inSet(n,o)?(addAllToSet(n,r.defines),a.push(r.definition)):a.push([]);return a}())},addSiblingDefines=function(e,t){var n,r;return n=e.auxiliaries(),arrayToSet(concat(function(){var e,i;i=[];for(r in values(t))i.push(null!=(e=lookupInMap(n,r))?e.defines:void 0);return i}()))},findDeps=function(e){return function(t){var n;return n=e.auxiliaries(),arrayToSet(auxiliaryDependencies(n,t))}},auxiliaryDependencies=function(e,t){var n,r,i,o,s;for(r=newSet(),i=map(id,t),s=[];n=i.pop();)inSet(r,n)||(addToSet(r,n),(o=lookupInMap(e,n))&&(s.push({name:n,deps:map(function(e){return{name:e}},o.deps)}),i.push.apply(i,o.deps)));return concat(map(setToArray,topologicallySortedGroups(s)))},ms.syntax=ms_syntax=function(ctx,call){var compiledMacro,doDeclare,docs,hasName,macroCompiled,macroFn,macroName,macroSource,maybeType,param,paramTuple,params,rest,splatted,typed,_ref;return hasName=requireName(ctx,"Name required to declare a new syntax macro"),_ref=_arguments(call),paramTuple=_ref[0],rest=2<=_ref.length?__slice.call(_ref,1):[],maybeType=rest[0],doDeclare=isTypeAnnotation(maybeType),docs=partition(isComment,rest)[0],typed=isTypeAnnotation(maybeType),hasName&&(macroName=ctx.definitionName(),param=_terms(paramTuple)[0],isSplat(param)&&(splatted=!0,param.label="name",paramTuple=tuple_(splatToName(param))),macroSource=call_(token_("fn"),join([paramTuple],rest)),macroCompiled=termCompile(ctx,macroSource),compiledMacro=translateToJs(translateIr(ctx,macroCompiled)),retrieve(call,macroSource),macroFn=eval(compiledMacro),macroFn?ctx.declareMacro(ctx.definitionPattern(),function(e,t){var n,r;return n=_arguments(t),typed&&operatorCompile(e,t),splatted?constantToSource(macroFn(Immutable.List(n))):(macroFn.length!==n.length&&(n=join(n,function(){var e,t,i,o;for(o=[],r=e=t=n.length,i=macroFn.length;i>=t?i>e:e>i;r=i>=t?++e:--e)o.push(fake_());return o}())),constantToSource(macroFn.apply(null,n)))},extractDocs(docs)):malformed(ctx,ctx.definitionPattern(),"Macro failed to compile")),typed?(params=map(token_,map(_symbol,_terms(paramTuple))),fn_(params,concat([[maybeType],docs,[call_(token_(macroName),params)]]))):jsNoop()},ms["`"]=ms_quote=function(e,t){var n,r,i,o;return r=firstOrCall(t),_arguments(t).length>1&&labelDelimeters(t,"const"),n=function(t,n){var r,i,o;return","===_symbol(t)[0]?(o=".."===_symbol(t).slice(1,3),i=token_(_symbol(t).slice(o?3:1)),r=termCompile(e,i),retrieve(t,i),e.assignTo()?r:o?jsMethod(r,"toArray",[]):jsArray([r])):n()},e.assignTo()?(i=function(t){var r,o,s,a,l,c;return o=e.assignTo(),isForm(t)?","===(null!=(c=_operator(t))?c.symbol:void 0)?termCompile(e,t):(labelDelimeters(t,"const"),combinePatterns(function(){var n,c,u,h;for(u=_terms(t),h=[],r=n=0,c=u.length;c>n;r=++n)a=u[r],e.setAssignTo(jsAccess(jsCall("_terms",[o]),r)),s=i(a),e.resetAssignTo(),l={precs:[cond_(jsAccess(o,"length"))]},h.push(combinePatterns([l,s]));return h}())):n(t,function(){return t.label="const",{precs:[cond_(jsBinary("===",jsAccess(o,"symbol"),toJsString(t.symbol)))]}})})(r):(t.tea=toConstrained(markOrigin(expressionType,t)),o=function(t){var r,i;return isForm(t)?jsArray([","===(null!=(i=_operator(t))?i.symbol:void 0)?termCompile(e,t):(labelDelimeters(t,"const"),r=map(o,t),_empty(r)?jsArray([]):jsMethod(_fst(r),"concat",r.slice(1)))]):n(t,function(){var e;return e=jsValue(JSON.stringify(t)),isExpression(t)&&(t.label="const"),jsArray([e])})},_fst(o(r).elems))},ms[","]=ms_comma=function(e,t){var n,r;return n=firstOrCall(_arguments(t)),(r=e.assignTo())?expressionCompile(e,n):jsCall("constantToSource",[expressionCompile(e,n)])},firstOrCall=function(e){var t,n;return t=_arguments(e),t.length>1?(n=e.indexOf(t[0]),call_(e[n],e.slice(n+1,-1))):t[0]},constantToSource=function(e){var t;switch(typeof e){case"boolean":return tokenize(e?"True":"False")[0];case"number":return tokenize(0>e?"-"+Math.abs(e):""+e)[0];case"string":return tokenize(JSON.stringify(e))[0];case"object":switch(t=Object.prototype.toString.call(e).slice(8,-1)){case"RegExp":return tokenize(""+e.source)[0];default:return Immutable.Iterable.isIterable(e)?concat([tokenize("{")[0],map(constantToSource,e.toJS()),tokenize("}")[0]]):e}}},ms.macro=ms_macro=function(ctx,call){var body,compiledMacro,defs,docs,hasName,macroBody,macroName,paramNames,paramTuple,params,type,typeList,_ref,_ref1;return hasName=requireName(ctx,"Name required to declare a new instance"),_ref=_arguments(call),paramTuple=_ref[0],body=2<=_ref.length?__slice.call(_ref,1):[],_ref1=partition(isComment,body),docs=_ref1[0],defs=_ref1[1],type=defs[0],macroBody=2<=defs.length?__slice.call(defs,1):[],hasName?(macroName=ctx.definitionName(),params=_terms(paramTuple),paramNames=map(_symbol,params),type&&isTypeAnnotation(type)?typeList=[type]:(ctx.isPreTyped(macroName)||malformed(ctx,call,"Type annotation required"),macroBody=join([type],macroBody),typeList=[]),compiledMacro=translateToJs(translateIr(ctx,termCompile(ctx,call_(token_("fn"),join([paramTuple],macroBody))))),params=map(token_,paramNames),ctx.isMacroDeclared(macroName)?malformed(ctx,ctx.definitionPattern(),"Macro with this name already defined"):(ctx.declareMacro(ctx.definitionPattern(),simpleMacro(eval(compiledMacro))),fn_(params,concat([typeList,docs,[call_(token_(macroName),params)]])))):void 0},simpleMacro=function(e){return function(t,n){var r;return operatorCompile(t,n),r=termsCompile(t,_arguments(n).slice(0,+e.length+1||9e9)),callTyping(t,n),assignCompile(t,n,e.apply(null,r))}},_ref=["binary","ternary","unary","access","call","method","assign","new"],_fn=function(e){return ms["Js."+e]=function(t,n){var r,i,o,s,a;return n.tea=toConstrained(jsType),a=_arguments(n),r=function(){var e,n,r;for(r=[],o=e=0,n=a.length;n>e;o=++e)s=a[o],i=termCompile(t,s),r.push(irJsCompatible(s.tea,i));return r}(),jsCall("js"+e[0].toUpperCase()+e.slice(1),r)}};for(_i=0,_len=_ref.length;_len>_i;_i++)jsMethod=_ref[_i],_fn(jsMethod);ms.log=ms_log=function(e,t){var n,r,i,o;return n=_validArguments(t),i=n[n.length-1],r=termsCompile(e,n),e.shouldDefer()?jsNoop():(t.tea=new Constrained(concatMap(__(_constraints,_tea),n),i.tea.type),o=map(__(__(toMultilineJsString,collapse),toHtml),n),assignCompile(e,t,jsCall("debugLog",concat([e.logId++,o,r]))))},ms["=="]=ms_eq=function(e,t){var n,r,i,o,s;return s=_arguments(t),n=s[0],r=s[1],operatorCompile(e,t),i=termCompile(e,n),o=termCompile(e,r),callTyping(e,t),assignCompile(e,t,jsBinary("===",i,o))},ms.Set=ms_Set=function(e,t){var n,r;if(e.assignTo())throw new Error("matching on sets not supported yet");return r=_arguments(t),n=uniformCollectionCompile(e,t,r,hashsetType),assignCompile(e,t,irSet(n))},ms.List=ms_List=function(e,t){var n,r;if(e.assignTo())throw new Error("matching on lists not supported yet");return r=_arguments(t),n=uniformCollectionCompile(e,t,r,listType),assignCompile(e,t,irList(n))},ms.Map=ms_Map=function(e,t){var n,r,i,o,s,a,l;if(e.assignTo())throw new Error("matching on maps not supported yet");return n=_arguments(t),n.length%2!==0?malformed(e,n[n.length-1],"Missing value for key"):(l=unzip(pairs(n)),a=l[0],o=l[1],i=termsCompileExpectingSameType(e,t,a),s=applyKindFn(hashmapType,i.itemType),r=uniformCollectionCompile(e,t,o,s,i.constraints),assignCompile(e,t,irMap(i.compiled,r)))},builtInMacros=function(){return objectToMap(ms)},iife=function(e){return jsWrap(jsCall(jsFunction({params:[],body:e}),[]))},paramTupleIn=function(e,t,n){var r;return n&&isTuple(n)?(r=_validTerms(n),map(syntaxNewName(e,"Parameter name expected"),r)):(malformed(e,t,"Missing paramater list"),r=[]),r},quantifyUnbound=function(e,t){var n;return n=subtractSets(findFree(t),e.allBoundTypeVariables()),quantify(n,t)},substituteVarNames=function(e,t){var n,r;return concatSets.apply(null,function(){var e,i;e=values(t),i=[];for(n in e)r=e[n],i.push(r.val?findFree(r.val):newSetWith(n));return i}())},substituteVarNames_pure=function(e,t){var n;return n=function(){return function(t){return inSub(e.substitution,t)||new TypeVariable(t)}}(this),findFreeInList(map(n,setToArray(t)))},deferConstraints=function(e,t,n,r){var i;return i=tryDeferConstraints(e,t,n,r),i.error&&e.extendSubstitution(i.error),i},tryDeferConstraints=function(e,t,n,r){var i,o,s,a,l,c,u,h,d,p,f,m,g,v;return p=reduceConstraints(e,t),p.success?(a=e.allBoundTypeVariablesAt(r),l=p.success,h=function(e){return isSubset(a,findUnconstrained(e))},g=partition(h,l),o=g[0],f=g[1],d=findFree(s=n),c=concatSets.apply(null,map(findConstrained,l)),m=concatSets(d,c),u=function(e){return!isSubset(m,findUnconstrained(e))},v=partition(u,f),i=v[0],f=v[1],_notEmpty(i)?{error:substitutionFail({message:"Constraint "+prettyPrintForError(i[0])+" is ambiguous for inferred type "+prettyPrintForError(s),conflicts:[n.type,i[0]]})}:{success:[o,f]}):p},reduceConstraints=function(e,t){var n;return n=normalizeConstraints(e,t),n.success?simplifyConstraints(e,n.success):n},normalizeConstraints=function(e,t){var n,r,i,o,s,a;for(a=map(id,t),s=[];_notEmpty(a);)if(i=a.shift(),isNormalizedConstraint(i))s.push(i);else{if(r=subLimit(e.substitution),o=constraintsFromInstance(e,i),!o)return{error:instanceLookupFailed(i)};a.push.apply(a,o),n=subLimit(e.substitution),n!==r&&(a.push.apply(a,s),s=[])}return all(s)?{success:s}:{error:"??Not all normalized??"}},simplifyConstraints=function(e,t){var n,r,i,o,s;for(i=[],r=o=0,s=t.length;s>o;r=++o)n=t[r],entailedBySuperClasses(e,join(i,t.slice(r+1)),n)||i.push(n);return{success:i}},entail=function(e,t,n){var r;return entailedBySuperClasses(e,t,n)?!0:(r=constraintsFromInstance(e,n),r?allMap(function(n){return entail(e,t,n)},r):!1)},entailedBySuperClasses=function(e,t,n){var r,i,o,s,a,l,c,u;for(s=0,l=t.length;l>s;s++)for(r=t[s],u=constraintsFromSuperClasses(e,r),a=0,c=u.length;c>a;a++)if(o=u[a],i=constraintsEqual(o,n))return!0;return!1},constraintsEqual=function(e,t){return e.className===t.className&&typeEq(e.types.types[0],t.types.types[0])&&unifyImpliedParams(e.types,t.types)},constraintsFromSuperClasses=function(e,t){var n,r,i;return n=t.className,i=t.types,join([t],concat(function(){var t,o,s,a;for(s=e.classNamed(n).supers,a=[],t=0,o=s.length;o>t;t++)r=s[t],a.push(constraintsFromSuperClasses(e,substitute(i.types,r)));return a}()))},constraintsFromInstance=function(e,t){var n,r,i,o,s,a,l,c;for(n=t.className,s=t.type,c=e.classNamed(n).instances,a=0,l=c.length;l>a;a++)if(i=c[a],r=freshInstance(e,i.type),o=toMatchTypes(r.type.types,t.types))return e.extendSubstitution(o),r.constraints;return null},instanceLookupFailed=function(e){var t,n,r;return r=sortBasedOnOriginPosition(e,e.types.types[0]),t=r[0],n=r[1],substitutionFail({message:"No instance found to satisfy "+prettyPrintForError(e),conflicts:[t,n]})},_names=function(e){return map(_symbol,e)},findDeclarables=function(e){return map(__(_fst,_cache),filter(_cache,e))},combinePatterns=function(e){return{precs:concat(map(_precs,filter(_precs,e))),assigns:concat(map(_assigns,filter(_assigns,e)))}},_precs=function(e){var t;return t=e.precs},_assigns=function(e){var t;return t=e.assigns},_cache=function(e){var t;return t=e.cache},cache_=function(e){return{cache:e}},cond_=function(e){return{cond:e}},malformed=function(e,t,n){return e.markMalformed(),t.malformed=n,jsNoop()},dictConstructorFunction=function(e,t,n){var r,i,o;return null==n&&(n=[]),r=join(n,t),o=r.map(function(e){return jsAssignStatement(jsAccess("this",e),validIdentifier(e))}),i=jsFunction({name:validIdentifier(e),params:map(validIdentifier,r),body:o}),[i]},dictAccessors=function(e,t,n,r){var i;return i=n.map(function(n){var i,o;return i=""+t+"-"+n,o="throw new Error('Expected "+e+", got ' + dict.constructor.name + ' instead in "+i+"')",jsVarDeclaration(validIdentifier(i),jsFunction({name:validIdentifier(i),params:["dict"],body:[r>1?jsConditional([["dict instanceof "+validIdentifier(e),[jsReturn(jsAccess("dict",n))]]],o):jsReturn(jsAccess("dict",n))]}))})},requireName=function(e,t){return e.isAtDefinition()?syntaxNewName(e,t,e.definitionPattern()):(malformed(e,call,t),!1)},fakeCompile=function(e,t){return t.tea=toConstrained(e.freshTypeVariable(star)),t.scope=e.currentScopeIndex(),e.markMalformed(),e.assignTo()?(t.assignable={top:e.isAtDeferrableDefinition()},{precs:[],assigns:[]}):(e.isAtDeferrableDefinition()&&e.doDefer(t,t.symbol),assignCompile(e,t,jsNoop()))},atomCompile=function(e,t){var n,r,i,o,s,a,l;return o=t.symbol,r=t.label,l=function(){switch(r){case"numerical":return numericalCompile;case"regex":return regexCompile;case"char":return charCompile;case"string":return stringCompile;default:return isModuleAccess(t)?namespacedNameCompile:nameCompile}}()(e,t,o),a=l.type,n=l.id,s=l.translation,i=l.pattern,a&&(t.tea=a),null!=n&&(t.id=n),t.scope=e.currentScopeIndex(),e.assignTo()?i:assignCompile(e,t,s)},nameCompile=function(e,t,n){var r,i,o,s,a,l;return r=e.type(n),(i=e.assignTo())?isConst(t)?(t.label="const",r?{type:mapOrigin(freshInstance(e,e.type(n)),t),pattern:constPattern(e,n)}:(e.doDefer(t,n),{pattern:[]})):(t.label="name",o=null!=(a=null!=(l=e.definitionName()&&e.definitionId())?l:e.currentDeclarationId(n))?a:e.freshId(),s=toConstrained(withOrigin(e.freshTypeVariable(star),t)),"_"!==n&&e.addToDefinedNames({name:n,id:o,type:s}),{type:s,id:o,pattern:{assigns:[[validIdentifier(n),i]]}}):!r||r instanceof TempType?!e.isCurrentlyDeclared(n)&&e.isDeclared(n)||r instanceof TempType?(s=toConstrained(e.freshTypeVariable(star)),e.addToDeferredNames({name:scopedName(n,e.scopeIndexOfDeclaration(n)),id:n,type:mapOrigin(s,t),scopeIndex:e.currentScopeIndex()}),nameTranslate(e,t,n,s)):(e.doDefer(t,n),{translation:deferredExpression()}):(s=mapOrigin(freshInstance(e,r),t),nameTranslate(e,t,n,s))},scopedName=function(e,t){return""+e+"_"+t},constPattern=function(e,t){var n;return n=e.assignTo(),{precs:[cond_(function(){switch(t){case"True":return n;case"False":return jsUnary("!",n);default:return jsBinary("instanceof",n,validIdentifier(t))}}())]}},nameTranslate=function(e,t,n,r){var i,o;return i=e.declarationId(n),e.addToUsedNames(n),o=function(){if(!isConst(t))return irReference(n,r,e.currentScopeIndex());switch(t.label="const",n){case"True":return"true";case"False":return"false";default:return jsAccess(validIdentifier(n),"_value")}}(),{id:i,type:r,translation:o}},namespacedNameCompile=function(e,t,n){return e.assignTo()&&malformed(e,t,"Matching on namespaced not supported"),{translation:/^global./.test(n)?"global."+n.slice("global.".length):n,type:toConstrained(markOrigin(jsType,t)),pattern:{precs:[]}}},numericalCompile=function(e,t,n){var r;return r=n,{type:toConstrained(markOrigin(numType,t)),translation:r,pattern:literalPattern(e,r)}},regexCompile=function(e,t,n){return{type:toConstrained(markOrigin(regexType,t)),translation:n,pattern:e.assignTo()?{precs:[cond_(jsBinary("===",jsAccess(e.assignTo(),"string"),""+n+".string"))]}:void 0}},specialCharacters="\\newline \\tab \\formfeed \\backspace \\return".split(" "),charCompile=function(e,t,n){var r;return r=2===n.length?'"'===n[1]?"'"+n[1]+"'":'"'+n[1]+'"':"\\space"===n?'" "':__indexOf.call(specialCharacters,n)>=0?'"\\'+n[1]+'"':/^\\x[a-fA-F0-9]{2}/.test(n)?'"'+n+'"':/^\\u[a-fA-F0-9]{4}/.test(n)?'"'+n+'"':(malformed(e,t,"Unrecognized character"),""),{type:toConstrained(markOrigin(charType,t)),translation:r,pattern:literalPattern(e,r)}},stringCompile=function(e,t,n){return{type:toConstrained(markOrigin(stringType,t)),translation:n,pattern:literalPattern(e,n)}},literalPattern=function(e,t){return e.assignTo()?{precs:[cond_(jsBinary("===",e.assignTo(),t))]}:void 0},deferredExpression=function(){return jsNoop()},syntaxType=function(e){return isName(e)?e.label="typename":isTuple(e)?map(syntaxType,_terms(e)):isCall(e)?(_operator(e).label="typecons",map(syntaxType,_arguments(e))):void 0},syntaxNewName=function(e,t,n){var r;return r=function(n){return syntaxNameAs(e,t,"name",n)},n?r(n):r},syntaxNameAs=function(e,t,n,r){var i;return i=function(r){return isName(r)?(r.label=n,!0):malformed(e,r,t)},r?i(r):i},call_=function(e,t){return concat([tokenize("("),[e],t,tokenize(")")])},tuple_=function(e){return concat([tokenize("["),e,tokenize("]")])},fn_=function(e,t){return call_(token_("fn"),join([tuple_(e)],t))},token_=function(e){return tokenize(e)[0]},fake_=function(){return{fake:!0}},string_=function(e){return'"'+e+'"'},ps=function(e){return"("+e+")"},translateIr=function(e,t){return walkIr(t,function(t){var n,r,i;if(t.ir)return t.ir(e,t);i={};for(n in t)r=t[n],"js"!==n&&(i[n]=r&&translateIr(e,r));return i.js=t.js,i})},irDefinition=function(e,t,n,r){return{ir:irDefinitionTranslate,type:e,expression:t,reference:n,bare:r}},irDefinitionTranslate=function(e,t){var n,r,i,o,s,a,l,c,u,h,d,p,f,m;return f=t.type,c=t.expression,p=t.reference,n=t.bare,u=f,(d=p?constraintsFromReference(e,{type:f,name:p.name,scopeIndex:p.scopeIndex}):reduceConstraints(e,u.constraints).success)?n&&_notEmpty(d)?(e.extendSubstitution(substitutionFail({message:"Ambiguous class constraints: "+map(prettyPrintForError,d),conflicts:d})),"null"):(e.updateClassParams(),a={},o=newMap(),i=function(){var t,n,i;for(i=[],t=0,n=d.length;n>t;t++)s=d[t],isAlreadyParametrized(e,s)||(r=s.className,h=typeNamesOfNormalized(s),m=nestedLookupInMap(o,h),m||nestedAddToMap(o,h,m=newMap()),l="_"+validIdentifier(r)+"_"+(null!=a[r]?a[r]:a[r]=0,++a[r]),addToMap(m,r,l),i.push(l));return i}(),e.addClassParams(o),_notEmpty(i)?c.ir===irFunctionTranslate?irFunctionTranslate(e,{name:c.name,params:join(i,c.params),body:c.body}):jsFunction({params:i,body:[jsReturn(translateIr(e,c))]}):translateIr(e,c)):jsNoop()},irCall=function(e,t,n){return{ir:irCallTranslate,type:e,op:t,args:n}},irCallTranslate=function(e,t){var n,r,i,o,s;return s=t.type,o=t.op,n=t.args,i=addConstraintsFrom(e,o,s),r=o.ir===irReferenceTranslate&&e.isMethod(o.name,o.type)?[]:dictsForConstraint(e,i.constraints),o=o.ir!==irReferenceTranslate||e.isMethod(o.name,o.type)?translateIr(e,o):validIdentifier(o.name),jsCall(o,join(r,translateIr(e,n)))},addConstraintsFrom=function(e,t,n){var r,i,o,s;return r=t.name,o=t.type,i=t.scopeIndex,null!=i&&(s=e.savedDeclaration(r,i))&&s.type&&_empty(n.constraints)&&_notEmpty(s.type.type.constraints)?addConstraints(n,constraintsFromCanonicalType(e,s.type,o)):n},constraintsFromReference=function(e,t){var n,r,i,o;return n=t.name,i=t.type,r=t.scopeIndex,null!=r&&(o=e.savedDeclaration(n,r))&&o.type&&_notEmpty(o.type.type.constraints)?constraintsFromCanonicalType(e,o.type,i):[]},constraintsFromCanonicalType=function(e,t,n){var r,i,o,s,a,l,c,u,h;for(o=freshInstance(e,t),matchType(o.type,n.type),reduceConstraints(e,o.constraints),u=o.constraints,s=0,l=u.length;l>s;s++)for(r=u[s],h=n.constraints,a=0,c=h.length;c>a;a++)i=h[a],constraintsEqual(r,i);return o.constraints},irReference=function(e,t,n){return{ir:irReferenceTranslate,name:e,type:t,scopeIndex:n}},irReferenceTranslate=function(e,t){var n,r,i,o,s,a,l;return o=t.name,l=t.type,a=t.scopeIndex,e.isMethod(o,l)?translateIr(e,irMethod(l,o)):(i=addConstraintsFrom(e,{type:l,name:o,scopeIndex:a},l),r=dictsForConstraint(e,i.constraints),r.length>0?(n=e.savedDeclaration(o,a).arity,s=map(validIdentifier,n),irFunctionTranslate(e,{params:s,body:[jsReturn(jsCall(validIdentifier(o),join(r,s)))]})):validIdentifier(o))},irMethod=function(e,t){return{ir:irMethodTranslate,type:e,name:t}},irMethodTranslate=function(e,t){var n,r,i,o,s;if(s=t.type,i=t.name,r=s,o=function(){var t,o,s,a;for(s=dictsForConstraint(e,r.constraints),a=[],t=0,o=s.length;o>t;t++)n=s[t],a.push(jsAccess(n,i));return a}(),o.length>1)throw new Error("expected one constraint on a method");return 1===o.length?o[0]:method},dictsForConstraint=function(e,t){var n,r,i,o;for(o=[],r=0,i=t.length;i>r;r++)n=t[r],o.push(dictForConstraint(e,n));return o},dictForConstraint=function(e,t){var n;return isNormalizedConstraint(t)?e.classParamNameFor(t)||findSubClassParam(e,t):_notEmpty(n=constraintsFromInstance(e,t)||[])?jsCall(instanceDictFor(e,t),dictsForConstraint(e,n)):instanceDictFor(e,t)},findSubClassParam=function(e,t){var n,r,i,o,s,a;if(s=function(e){return e.className},i=e.classParamsForType(t),!i)return e.extendSubstitution(substitutionFail({message:"Constraint "+prettyPrintForError(t)+" is ambiguous",conflicts:[t]})),{};a=values(i);for(r in a)if(o=a[r],n=findSuperClassChain(e,r,t.className))return accessList(o,n);throw new Error("Couldn't find dict for "+prettyPrintForError(t))},findSuperClassChain=function(e,t,n){var r,i,o,s,a,l;for(l=e.classNamed(t).supers,s=0,a=l.length;a>s;s++){if(o=l[s],i=o.className,i===n)return[i];if(r=findSuperClassChain(e,i,n))return join([i],r)}return void 0},typeNamesOfNormalized=function(e){return[printType(e.types.types[0])]},accessList=function(e,t){var n,r;return n=t[0],r=2<=t.length?__slice.call(t,1):[],n?accessList(jsAccess(e,n),r):e},isAlreadyParametrized=function(e,t){return!!e.classParamNameFor(t)},instanceDictFor=function(e,t){var n,r,i,o,s,a;for(s=e.classNamed(t.className).instances,i=0,o=s.length;o>i;i++)if(a=s[i],n=a.name,r=a.type,toMatchTypes(freshInstance(e,r).type.types,t.types))return validIdentifier(n);return e.extendSubstitution(instanceLookupFailed(t)),"undefined"},irFunction=function(e){var t,n,r;return n=e.name,r=e.params,t=e.body,{ir:irFunctionTranslate,name:n,params:r,body:t}},irFunctionTranslate=function(e,t){var n,r,i;return r=t.name,i=t.params,n=t.body,jsCall("λ"+i.length,[jsFunction({name:r?validIdentifier(r):void 0,params:map(validIdentifier,i),body:translateIr(e,n)})])},irArray=function(e){return{ir:irArrayTranslate,items:e}},irArrayTranslate=function(e,t){var n;return n=t.items,jsCall("Immutable.List.of",translateIr(e,n))},irList=function(e){return{ir:irListTranslate,items:e}},irListTranslate=function(e,t){var n;return n=t.items,jsCall("Immutable.Stack.of",translateIr(e,n))},irMap=function(e,t){return{ir:irMapTranslate,keys:e,elems:t}},irMapTranslate=function(e,t){var n,r;return r=t.keys,n=t.elems,jsCall("Immutable.Map",[jsArray(map(jsArray,zip(translateIr(e,r),translateIr(e,n))))])},irSet=function(e){return{ir:irSetTranslate,items:e}},irSetTranslate=function(e,t){var n;return n=t.items,jsCall("Immutable.Set.of",translateIr(e,n))},irJsCompatible=function(e,t){return{ir:irJsCompatibleTranslate,type:e,expression:t}},irJsCompatibleTranslate=function(e,t){var n,r,i,o;return o=t.type,n=t.expression,r=o,i=translateIr(e,n),isCustomCollectionType(r)?jsCall(jsAccess(i,"toArray"),[]):i},isCustomCollectionType=function(e){var t,n,r;return r=e.type,t=new Context,n=function(){return t.freshTypeVariable(star)},toMatchTypes(applyKindFn(arrayType,n()),r)||toMatchTypes(applyKindFn(hashmapType,n(),n()),r)||toMatchTypes(applyKindFn(hashsetType,n()),r)},isTypeAnnotation=function(e){return isCall(e)&&":"===_symbol(_operator(e))},isComment=function(e){return isCall(e)&&"#"===_symbol(_operator(e))},isCall=function(e){return isForm(e)&&isNotEmptyForm(e)&&"("===e[0].symbol},isRecord=function(e){return isTuple(e)&&isLabel(_fst(_terms(e)))},isSeq=function(e){return isForm(e)&&"{"===e[0].symbol},isTuple=function(e){return isForm(e)&&"["===e[0].symbol},isNotEmptyForm=function(e){return _terms(e).length>0},isForm=function(e){return Array.isArray(e)},isModuleAccess=function(e){return/^\w+\.\w/.test(e.symbol)},isDotAccess=function(e){return/^\.-?\w+/.test(e.symbol)},isConst=function(e){return/^[A-Z]([^\s\.-]|-(?=[A-Z]))*$/.test(e.symbol)},isLabel=function(e){return/[^\\]:$/.test(e.symbol)},isCapital=function(e){return/^[A-Z]/.test(e.symbol)},isNotCapital=function(e){return/^[a-z]/.test(e.symbol)},isName=function(e){var t;if(!e)throw new Error("Nothing passed to isName");return isAtom(e)&&("~"===(t=e.symbol)||"/"===t||"//"===t||/[^~"'\/].*/.test(e.symbol))},isAtom=function(e){return!Array.isArray(e)},isExpressionOrFake=function(e){return isFake(e)||isExpression(e)},isFake=function(e){return e.fake},isExpression=function(e){var t,n;return"whitespace"!==(t=e.label)&&"indent"!==t&&(!e.symbol||(n=e.symbol,__indexOf.call(allDelims,n)<0))},_labeled=function(e){return pairsLeft(isLabel,e)},spaceSeparatedPairs=function(e){var t,n,r,i,o,s,a,l,c;for(n=function(e){return"\n"===e.symbol},s=[],l=0,c=e.length;c>l;l++)o=e[l],i=n(o),t=isExpressionOrFake(o),r||!t||i?r&&(t&&!i||a&&i)?(s.push([r,o]),r=!1):r&&i?(s.push([r,fake_()]),r=!1):t||(a=!0):(r=o,a=!1);return r&&s.push([r,fake_()]),s},pairsLeft=function(e,t){return listToPairsWith(t,function(t,n){return e(t)?[t,n&&!e(n)?n:null]:e(t)?[t,null]:[null,t]})},pairsRight=function(e,t){return pairsLeft(function(t){return!e(t)},t)},listToPairsWith=function(e,t){var n,r;return filter(_is,function(){var i;for(n=0,i=[];n<e.length;)r=t(e[n],e[n+1]),r[0]&&r[1]&&n++,n++,i.push(r);return i}())},pairs=function(e){var t,n,r,i,o;for(o=[],n=r=0,i=e.length;i>r;n=r+=2)t=e[n],o.push([t,e[n+1]]);return o},tuplize=function(e,t){var n,r,i,o,s;for(s=[],e>0?(r=i=0,o=t.length):r=i=t.length-1;e>0?o>i:i>=0;r=i+=e)n=t[r],s.push(t.slice(r,r+e));return s},unzip=function(e){return[map(_fst,e),map(_snd,e)]},zip=function(e,t){return zipWith(function(e,t){return[e,t]},e,t)},zipWith=function(e,t,n){var r,i,o,s,a;for(a=[],i=o=0,s=t.length;s>o;i=++o)r=t[i],a.push(e(r,n[i]));return a},replicate=function(e,t){return t},retrieve=function(e,t){return e.tea=t.tea,e.malformed=t.malformed,t.label&&(e.label=t.label),trackTransformation(e,t)},trackTransformation=function(e,t){return t.transformed=e},filterAst=function(e,t){var n;return join(filter(e,[t]),isForm(t)?concat(function(){var r,i,o,s;for(o=_terms(t),s=[],r=0,i=o.length;i>r;r++)n=o[r],s.push(filterAst(e,n));return s}()):[])},translateStatementsToJs=function(e){return listOfLines(translateToJs(e))},translateToJs=function(e){return walkIr(e,function(e){var t,n,r;t={};for(n in e)r=e[n],"js"!==n&&(t[n]=r&&translateToJs(r));return e.js(t)})},walkIr=function(e,t){var n,r,i,o;if(Array.isArray(e)){for(o=[],r=0,i=e.length;i>r;r++)n=e[r],o.push(walkIr(n,t));return o}return e.ir||e.js?t(e):e},printIr=function(e){return walkIr(e,function(e){var t,n,r;t={};for(n in e)r=e[n],"js"!==n&&"ir"!==n&&(t[n]=null!=r?"type"===n?printType(r):printIr(r):void 0);return t})},jsCallMethod=function(e,t,n){return jsCall(jsAccess(e,t),n)},jsAccess=function(e,t){return{js:jsAccessTranslate,lhs:e,name:t}},jsAccessTranslate=function(e){var t,n;return t=e.lhs,n=e.name,/^\d/.test(n)?""+t+"["+n+"]":validIdentifier(n)!==n?""+t+"['"+n+"']":""+t+"."+n},jsArray=function(e){return{js:jsArrayTranslate,elems:e}},jsArrayTranslate=function(e){var t;return t=e.elems,"["+listOf(t)+"]"},jsAssign=function(e,t){return{js:jsAssignTranslate,lhs:e,rhs:t}},jsAssignTranslate=function(e){var t,n;return t=e.lhs,n=e.rhs,"("+t+" = "+n+")"},jsAssignStatement=function(e,t){return{js:jsAssignStatementTranslate,lhs:e,rhs:t}},jsAssignStatementTranslate=function(e){var t,n;return t=e.lhs,n=e.rhs,""+t+" = "+n+";"},jsBinary=function(e,t,n){return{js:jsBinaryTranslate,op:e,lhs:t,rhs:n}},jsBinaryTranslate=function(e){var t,n,r;return n=e.op,t=e.lhs,r=e.rhs,jsBinaryMultiTranslate({op:n,args:[t,r]})},jsBinaryMulti=function(e,t){return{js:jsBinaryMultiTranslate,op:e,args:t}},jsBinaryMultiTranslate=function(e){var t,n;return n=e.op,t=e.args,"("+t.join(" "+n+" ")+")"},jsCall=function(e,t){return{js:jsCallTranslate,fun:e,args:t}},jsCallTranslate=function(e){var t,n;return n=e.fun,t=e.args,""+n+"("+listOf(t)+")"},jsConditional=function(e,t){return{js:jsConditionalTranslate,condCasePairs:e,elseCase:t}},jsConditionalTranslate=function(e){var t,n,r,i,o,s;return r=e.condCasePairs,o=e.elseCase,function(){var e,o,a,l;for(l=[],s=e=0,o=r.length;o>e;s=++e)a=r[s],n=a[0],t=a[1],i=0===s?"if":" else if",l.push(""+i+" ("+n+") {\n  "+listOfLines(t)+"\n}");return l}().join("")+(" else {\n  "+o+"\n}")},jsDictionary=function(e,t){return{js:jsDictionaryTranslate,keys:e,values:t}},jsDictionaryTranslate=function(e){var t,n,r;return n=e.keys,r=e.values,t=zipWith(function(e,t){return'"'+e+'": '+t},n,r),"{"+listOf(t)+"}"},jsExprList=function(e){return{js:jsExprListTranslate,elems:e}},jsExprListTranslate=function(e){var t;return t=e.elems,"("+listOf(t)+")"},jsFunction=function(e){var t,n,r;if(n=e.name,r=e.params,t=e.body,!Array.isArray(t))throw new Error("body of jsFunction must be a list");return{js:jsFunctionTranslate,name:n,params:r,body:t}},jsFunctionTranslate=function(e){var t,n,r;return n=e.name,r=e.params,t=e.body,"function "+(n||"")+"("+listOf(r)+"){"+blockOfLines(t)+"}"},jsMalformed=function(e){return{js:jsMalformedTranslate,message:e}},jsMalformedTranslate=function(e){var t;return t=e.message},jsMethod=function(e,t,n){return{js:jsMethodTranslate,object:e,method:t,args:n}},jsMethodTranslate=function(e){var t,n,r;return r=e.object,n=e.method,t=e.args,translateToJs(jsCall(jsAccess(r,n),t))},jsNew=function(e,t){return{js:jsNewTranslate,classFun:e,args:t}},jsNewTranslate=function(e){var t,n;return n=e.classFun,t=e.args,"new "+n+"("+listOf(t)+")"},jsNoop=function(){return{js:jsNoopTranslate}},jsNoopTranslate=function(){return"null"},jsReturn=function(e){return{js:jsReturnTranslate,result:e}},jsReturnTranslate=function(e){var t;return t=e.result,"return "+t+";"},jsTernary=function(e,t,n){return{js:jsTernaryTranslate,cond:e,thenExp:t,elseExp:n}},jsTernaryTranslate=function(e){var t,n,r;return t=e.cond,r=e.thenExp,n=e.elseExp,""+t+" ? "+r+" : "+n},jsUnary=function(e,t){return{js:jsUnaryTranslate,op:e,arg:t}},jsUnaryTranslate=function(e){var t,n;return n=e.op,t=e.arg,""+n+t},jsValue=function(e){return{js:jsValueTranslate,value:e}},jsValueTranslate=function(e){var t;return t=e.value},jsVarDeclaration=function(e,t){return{js:jsVarDeclarationTranslate,name:e,rhs:t}},jsVarDeclarationTranslate=function(e){var t,n;return t=e.name,n=e.rhs,"var "+t+" = "+n+";"},jsVarDeclarations=function(e){return{js:jsVarDeclarationsTranslate,names:e}},jsVarDeclarationsTranslate=function(e){var t;return t=e.names,"var "+listOf(t)+";"},jsWrap=function(e){return{js:jsWrapTranslate,value:e}},jsWrapTranslate=function(e){var t;return t=e.value,"("+t+")"},blockOfLines=function(e){return 0===e.length?"":"\n"+listOfLines(e)+"\n"},listOfLines=function(e){return e.join("\n")},indentLines=function(e,t){return blockOfLines(map(function(t){return e+t},filter(_notEmpty,t)))},listOf=function(e){return e.join(", ")},theme={keyword:"red",numerical:"#FEDF6B","const":"#FEDF6B",typename:"#FEDF6B",typecons:"#67B3DD",label:"#9C49B6",string:"#FEDF6B","char":"#FEDF6B",paren:"#444",name:"#9EE062",recurse:"#67B3DD",param:"#FDA947",comment:"grey",operator:"#67B3DD",malformed:"#880000",normal:"white"},colorize=function(e,t){var n;return n=e?' style="color: '+e+'"':"","<span"+n+">"+t+"</span>"},themize=function(e,t){return colorize(theme[e],t)},labelComments=function(e){var t,n,r,i,o;for(i=_validTerms(e),o=[],n=0,r=i.length;r>n;n++)t=i[n],o.push(t.label="comment");return o},toHtml=function(e){return crawl(e,function(e,t,n){return themize(labelOf(e,n),"string"===e.label?"“"+t.slice(1,-1)+"”":t)})},print=function(e){return e?collapse(crawl(e,function(e,t){return t})):e},labelOf=function(e,t){var n;return e.malformed&&"malformed"||(null!=t?t.malformed:void 0)&&(n=e.symbol,__indexOf.call(allDelims,n)>=0)&&"malformed"||e.label||"normal"
},collapse=function(e){var t,n,r,i;for(t="",r=0,i=e.length;i>r;r++)n=e[r],crawl(n,function(e){return t+=e});return t},parentize=function(e){return walk(e,function(e){var t,n,r,i;for(i=[],n=0,r=e.length;r>n;n++)t=e[n],i.push(t.parent=e);return i})},walk=function(e,t){var n,r,i;if(Array.isArray(e))for(t(e),r=0,i=e.length;i>r;r++)n=e[r],walk(n,t);return e},validIdentifier=function(e){return inSet(reservedInJs,e)?""+e+"_":(isModuleAccess({symbol:e})?e:e.replace(/\./g,"dot_")).replace(/\+/g,"plus_").replace(/\-/g,"__").replace(/\*/g,"times_").replace(/\//g,"over_").replace(/\!/g,"not_").replace(/\=/g,"eq_").replace(/\</g,"lt_").replace(/\>/g,"gt_").replace(/\~/g,"neg_").replace(/\^/g,"pow_").replace(/\&/g,"and_").replace(/\@/g,"at_").replace(/\|/g,"or_").replace(/\?/g,"p_")},topologicallySortedGroups=function(e){return toNameSets(sortedStronglyConnectedComponents(dependentToGraph(e)))},dependentToGraph=function(e){var t,n,r,i,o,s,a,l,c,u,h;for(s=newMap(),r=function(e){return lookupOrAdd(s,e,{name:e,edges:[]})},a=0,c=e.length;c>a;a++)for(h=e[a],i=h.name,n=h.deps,o=r(i),l=0,u=n.length;u>l;l++)t=n[l],o.edges.push(r(t.name));return mapToArray(s)},toNameSets=function(e){var t,n,r,i,o;for(o=[],r=0,i=e.length;i>r;r++)t=e[r],o.push(arrayToSet(function(){var e,r,i;for(i=[],e=0,r=t.length;r>e;e++)n=t[e].name,i.push(n);return i}()));return o},sortedStronglyConnectedComponents=function(e){var t,n,r,i,o,s,a;for(r=0,t=[],n=[],o=function(e){var i,s,a,l,c;for(e.index=r,e.lowlink=r,r+=1,t.push(e),e.onStack=!0,c=e.edges,a=0,l=c.length;l>a;a++)s=c[a],void 0===s.index?(o(s),e.lowlink=Math.min(e.lowlink,s.lowlink)):s.onStack&&(e.lowlink=Math.min(e.lowlink,s.index));if(e.lowlink===e.index){for(i=[];;)if(s=t.pop(),s.onStack=!1,i.push(s),s===e)break;return n.push(i)}},s=0,a=e.length;a>s;s++)i=e[s],void 0===i.index&&o(i);return n},hoistWheres=function(e,t){var n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,v;for(r=addAllToSet(newSet(),function(){var e,n,r,i;for(i=[],e=0,n=t.length;n>e;e++)r=t[e],a=r[0],m=r[1],i.push(a);return i}()),o=newSet(),i=[],u=[],g=0,v=e.length;v>g;g++)f=e[g],s=f.missing,c=f.names,n=f.def,h=f.set,p=addAllToSet(newSet(),function(){var e,t,n,i;for(n=setToArray(s),i=[],e=0,t=n.length;t>e;e++)l=n[e],inSet(r,l)||i.push(l);return i}()),d=removeAllFromSet(cloneSet(h),setToArray(o)),0===p.size&&0===d.size?(i.push(n),addAllToSet(o,c)):u.push({def:n,names:c,missing:p,set:d});return[i,u]},toMultilineJsString=function(e){return"('"+e.replace(/\n/g,"\\n' + '")+"')"},toJsString=function(e){return"'"+e+"'"},compileVariableAssignment=function(e){var t,n;return n=e[0],t=e[1],jsVarDeclaration(n,t)},constructCond=function(e){var t,n,r,i,o,s,a,l,c,u;if(0===e.length)return{conds:"true",preassigns:[]};for(r=!1,t=[],a=[],l=function(e){var t,n;return n=e.cond,t=e.cache,n?n:jsAssign(t[0],t[1])},s=function(){var e;return e=map(l,a),t.push(1===e.length?e[0]:jsExprList(e)),a=[]},n=c=0,u=e.length;u>c;n=++c)o=e[n],r&&s(),a.push(o),r=o.cond;return i=r?(s(),[]):map(_cache,a),{conds:jsBinaryMulti("&&",t),preassigns:i}},builtInTypeNames=function(){return arrayToMap(map(function(e){var t,n;return n=e.name,t=e.kind,[n,t]},[arrowType,arrayType,listType,hashmapType,hashsetType,stringType,charType,boolType,numType,regexType,jsType,expressionType]))},builtInDefinitions=function(){return newMapWith("True",{type:quantifyAll(toConstrained(boolType)),arity:[]},"False",{type:quantifyAll(toConstrained(boolType)),arity:[]},"==",{type:quantifyAll(toConstrained(typeFn(atomicType("a",star),atomicType("a",star),boolType))),arity:["x","y"]},"is-null-or-undefined",{type:quantifyAll(toConstrained(typeFn(atomicType("a",star),boolType))),arity:["x"]})},newSet=newMap=function(){return{size:0,values:{}}},addToSet=function(e,t){return addToMap(e,t,!0)},addToMap=function(e,t,n){return e.values[t]?void 0:(e.size++,e.values[t]=n,e)},replaceInMap=function(e,t,n){return e.values[t]=n},replaceOrAddToMap=function(e,t,n){return e.values[t]||e.size++,e.values[t]=n,e},lookupOrAdd=function(e,t,n){var r;return(r=e.values[t])?r:(e.size++,e.values[t]=n,n)},removeFromSet=removeFromMap=function(e,t){return null!=e.values[t]?(e.size-=1,delete e.values[t]):void 0},addAllToSet=function(e,t){var n,r,i;for(r=0,i=t.length;i>r;r++)n=t[r],addToSet(e,n);return e},removeAllFromSet=function(e,t){var n,r,i;for(r=0,i=t.length;i>r;r++)n=t[r],removeFromSet(e,n);return e},keysOfMap=setToArray=function(e){var t,n;n=[];for(t in e.values)n.push(t);return n},mapToArray=function(e){var t,n,r,i;r=e.values,i=[];for(t in r)n=r[t],i.push(n);return i},mapToArrayVia=function(e,t){var n,r,i,o;i=t.values,o=[];for(n in i)r=i[n],o.push(e(n,r));return o},cloneSet=cloneMap=function(e){var t,n,r,i;t=newSet(),i=e.values;for(n in i)r=i[n],addToMap(t,n,r);return t},lookupInMap=inSet=function(e,t){return e.values[t]},isSetEmpty=isMapEmpty=function(e){return 0===e.size},mapMap=function(e,t){var n,r,i,o;n=newMap(),o=t.values;for(r in o)i=o[r],addToMap(n,r,e(i,r));return n},mapKeys=function(e,t){var n,r,i,o;n=newMap(),o=t.values;for(r in o)i=o[r],addToMap(n,r,e(r));return n},mapSet=rehashMap=function(e,t){var n,r,i,o;n=newMap(),o=t.values;for(r in o)i=o[r],addToMap(n,e(r),i);return n},filterSet=filterMap=function(e,t){var n,r,i,o;n=newMap(),o=t.values;for(r in o)i=o[r],e(r,i)&&addToMap(n,r,i);return n},partitionMap=function(e,t){var n,r,i,o,s;n=newMap(),r=newMap(),s=t.values;for(i in s)o=s[i],addToMap(e(o,i)?n:r,i,o);return[n,r]},reduceSet=function(e,t,n){return setToArray(n).reduce(function(t,n){return e(n,t)},t)},newSetWith=function(){var e,t,n,r,i;for(e=1<=arguments.length?__slice.call(arguments,0):[],t=newSet(),r=0,i=e.length;i>r;r++)n=e[r],addToSet(t,n);return t},newMapWith=function(){var e,t,n,r,i,o;for(e=1<=arguments.length?__slice.call(arguments,0):[],n=newMap(),t=i=0,o=e.length;o>i;t=i+=2)r=e[t],addToMap(n,r,e[t+1]);return n},newMapKeysVals=function(e,t){var n,r,i,o,s;for(r=newMap(),n=o=0,s=t.length;s>o;n=++o)i=t[n],addToMap(r,e[n],i);return r},concatSets=concatMaps=function(){var e,t,n,r,i,o,s,a;for(r=1<=arguments.length?__slice.call(arguments,0):[],e=newMap(),o=0,s=r.length;s>o;o++){n=r[o],a=n.values;for(t in a)i=a[t],addToMap(e,t,i)}return e},concatConcatMaps=function(e){var t,n,r,i,o,s,a,l;for(t=newMap(),s=0,a=e.length;a>s;s++){i=e[s],l=i.values;for(n in l)o=l[n],(r=lookupInMap(t,n))?r.push(o):addToMap(t,n,[o])}return t},subtractSets=subtractMaps=function(e,t){var n,r,i,o;r=newMap(),o=e.values;for(n in o)i=o[n],n in t.values||addToMap(r,n,i);return r},arrayToSet=function(e){return addAllToSet(newSet(),e)},arrayToMap=function(e){var t,n,r,i,o,s;for(t=newMap(),i=0,o=e.length;o>i;i++)s=e[i],n=s[0],r=s[1],addToMap(t,n,r);return t},objectToMap=function(e){var t,n,r;t=newMap();for(n in e)r=e[n],addToMap(t,n,r);return t},values=function(e){return e.values},doIntersect=function(e,t){return subtractSets(e,t).size!==e.size},isSubset=function(e,t){return 0===subtractSets(t,e).size},intersectRight=function(e,t){var n,r,i,o;n=newMap(),o=t.values;for(r in o)i=o[r],r in e.values&&addToMap(n,r,i);return n},intersectMaps=intersectSets=function(e){var t,n;return t=e[0],n=2<=e.length?__slice.call(e,1):[],_empty(e)?newMap():_empty(n)?t:intersectRight(t,intersectMaps(n))},nestedAddToMap=function(e,t,n){var r,i,o,s,a,l;for(o=2<=t.length?__slice.call(t,0,s=t.length-1):(s=0,[]),r=t[s++],a=0,l=o.length;l>a;a++)i=o[a],e=lookupInMap(e,i),e||(e=addToMap(e,i,newMap()));return addToMap(e,r,n)},nestedLookupInMap=function(e,t){var n,r,i;for(r=0,i=t.length;i>r;r++){if(n=t[r],null==(null!=e?e.size:void 0))return null;e=lookupInMap(e,n)}return e},unify=function(e,t,n){if(!(e instanceof Context&&t&&n))throw new Error("invalid args to unify");return e.extendSubstitution(mostGeneralUnifier(t,n))},mostGeneralUnifier=function(e,t){var n,r;return e.TypeVariable&&t.TypeVariable&&e.name===t.name?emptySubstitution():e.TypeVariable&&e.ref.val?mostGeneralUnifier(e.ref.val,t):t.TypeVariable&&t.ref.val?mostGeneralUnifier(e,t.ref.val):e.TypeVariable?bindVariable(e,t):t.TypeVariable?mostGeneralUnifier(t,e):e.TypeConstr&&t.TypeConstr&&e.name===t.name?emptySubstitution():e.TypeApp&&t.TypeApp?(n=mostGeneralUnifier(e.op,t.op),r=mostGeneralUnifier(e.arg,t.arg),joinSubs(n,r)):e.Types&&t.Types?e.types.length!==t.types.length?unifyFail(e,t):_notEmpty(e.types)?(n=mostGeneralUnifier(e.types[0],t.types[0]),r=mostGeneralUnifier(new Types(e.types.slice(1)),new Types(t.types.slice(1))),joinSubs(n,r)):emptySubstitution():unifyFail(e,t)},bindVariable=function(e,t){var n,r,i,o;return inSet(findFree(t),e.name)?typeFail("Types cannot match: ",e,t):kindsEq(kind(e),kind(t))?(e.ref.val=t,newSubstitution()):(o=sortBasedOnOriginPosition(e,t),r=o[0],i=o[1],n=function(t){return""+prettyPrintForError(t)+" which "+(t===e?"should be":"is")+" a "+printKind(kind(t))},substitutionFail({message:"Cannot match "+n(r)+" with "+n(i),conflicts:[r,i]}))},toMatchTypes=function(e,t){var n;return n=matchType(e,t),_notEmpty(n.fails)?null:n},matchType=function(e,t){var n,r;return e.TypeVariable&&e.ref.val?typeEq(e.ref.val,t)?emptySubstitution():unifyFail(e,t):t.TypeVariable&&t.ref.val?matchType(e,t.ref.val):e.TypeVariable&&t.TypeVariable&&e.name===t.name?emptySubstitution():e.TypeVariable&&kindsEq(kind(e),kind(t))?(e.ref.val=t,newSubstitution()):e.QuantifiedVar&&t.QuantifiedVar?e["var"]!==t["var"]?unifyFail(e,t):emptySubstitution():e.TypeConstr&&t.TypeConstr&&e.name===t.name?emptySubstitution():e.TypeApp&&t.TypeApp?(n=matchType(e.op,t.op),r=matchType(e.arg,t.arg),subUnion(n,r)):e.Types&&t.Types?e.types.length!==t.types.length?unifyFail(e,t):_notEmpty(e.types)?(n=matchType(e.types[0],t.types[0]),isFailed(n)?n:unifyImpliedParams(e,t)):emptySubstitution():unifyFail(e,t)},unifyImpliedParams=function(e,t){var n,r,i,o,s,a;return s=new Types(e.types.slice(1)),a=new Types(t.types.slice(1)),n=function(e){return mapMap(function(e,t){return new TypeVariable(t,e,{})},findFree(e))},i=substitute(n(s),s),o=substitute(n(a),a),isFailed(r=mostGeneralUnifier(i,o))?r:mostGeneralUnifier(s,a)},substitute=function(e,t){return t.TypeVariable?t.ref.val?substitute(e,t.ref.val):e.values&&lookupInMap(e,t.name)||t:t.QuantifiedVar?e[t["var"]]||t:t.TypeConstr?withOrigin(new TypeConstr(t.name,t.kind),t.origin):t.TypeApp?withOrigin(new TypeApp(substitute(e,t.op),substitute(e,t.arg)),t.origin):t.ForAll?new ForAll(t.kinds,substitute(e,t.type)):t.Constrained?new Constrained(substituteList(e,t.constraints),substitute(e,t.type)):t.ClassConstraint?withOrigin(new ClassConstraint(t.className,substitute(e,t.types)),t.origin):t.Types?new Types(substituteList(e,t.types)):t},findFree=function(e){return e.TypeVariable?e.ref.val?findFree(e.ref.val):newMapWith(e.name,e.kind):e.TypeApp?concatMaps(findFree(e.op),findFree(e.arg)):e.Constrained?concatMaps(findFree(e.type),findFreeInList(e.constraints)):e.ClassConstraint?findFree(e.types):e.Types?findFreeInList(e.types):newMap()},freshenType=function(e){return e.TypeVariable?e.ref.val?freshenType(e.ref.val):new TypeVariable(e.name,e.kind):e.TypeApp?new TypeApp(freshenType(e.op),freshenType(e.arg)):e},unify_pure=function(e,t,n){var r;if(!(e instanceof Context&&t&&n))throw new Error("invalid args to unify");return r=e.substitution,e.extendSubstitution(mostGeneralUnifier(substitute(r,t),substitute(r,n)))},mostGeneralUnifier_pure=function(e,t){var n,r;return e.TypeVariable?bindVariable(e,t):t.TypeVariable?bindVariable(t,e):e.TypeConstr&&t.TypeConstr&&e.name===t.name?emptySubstitution():e.TypeApp&&t.TypeApp?(n=mostGeneralUnifier(e.op,t.op),r=mostGeneralUnifier(substitute(n,e.arg),substitute(n,t.arg)),joinSubs(r,n)):e.Types&&t.Types?e.types.length!==t.types.length?unifyFail(e,t):_notEmpty(e.types)?(n=mostGeneralUnifier(e.types[0],t.types[0]),r=mostGeneralUnifier(new Types(e.types.slice(1)),new Types(t.types.slice(1))),joinSubs(r,n)):emptySubstitution():unifyFail(e,t)},unifyFail=function(e,t){return typeFail("Types don't match: ",e,t)},bindVariable_pure=function(e,t){return t.TypeVariable&&e.name===t.name?emptySubstitution():inSet(findFree(t),e.name)?typeFail("Types cannot match: ",e,t):kindsEq(kind(e),kind(t))?newSubstitution(e.name,t):typeFail("Kinds of types don't match: ",e,t)},typeFail=function(e,t,n){var r,i,o;return o=sortBasedOnOriginPosition(t,n),r=o[0],i=o[1],substitutionFail({message:""+e+" "+prettyPrintForError(r)+", "+prettyPrintForError(i),conflicts:[r,i],types:[t,n]})},sortBasedOnOriginPosition=function(e,t){var n,r;return(null!=(n=originOf(e))?n.start:void 0)>(null!=(r=originOf(t))?r.start:void 0)?[t,e]:[e,t]},originOf=function(e){return e.TypeVariable&&e.ref.val?originOf(e.ref.val):e.origin},toMatchTypes_pure=function(e,t){var n;return n=matchType(e,t),_notEmpty(n.fails)?null:n},matchType_pure=function(e,t){var n,r,i;return e.TypeVariable&&kindsEq(kind(e),kind(t))?newSubstitution(e.name,t):e.TypeConstr&&t.TypeConstr&&e.name===t.name?emptySubstitution():e.TypeApp&&t.TypeApp?(n=matchType(e.op,t.op),r=matchType(e.arg,t.arg),i=mergeSubs(n,r),i||unifyFail(e,t)):e.Types&&t.Types?e.types.length!==t.types.length?unifyFail(e,t):_notEmpty(e.types)?(n=matchType(e.types[0],t.types[0]),r=unifyImpliedParams(substitute(n,e),t),i=mergeSubs(n,r),i||unifyFail(e,t)):emptySubstitution():unifyFail(e,t)},unifyImpliedParams_pure=function(e,t){return mostGeneralUnifier(new Types(e.types.slice(1)),new Types(t.types.slice(1)))},joinSubs=function(e,t){return subUnion(e,t)},joinSubs_pure=function(e,t){return subUnion(e,mapSub(function(t){return substitute(e,t)},t))},mergeSubs=function(e,t){var n;return n=function(n){var r;return r=new TypeVariable(n,star),typeEq(substitute(e,r),substitute(t,r))},allMap(n,subIntersection(e,t))?subUnion(e,t):null},mapSub=function(e,t){var n,r,i,o,s,a;for(n=emptySubstitution(),n.start=subStart(t),n.fails=t.fails,r=o=s=subStart(t),a=subLimit(t);a>o;r=o+=1)(i=inSub(t,r))&&setInSub(n,r,e(i));return n},subIntersection=function(e,t){var n,r,i,o,s;for(s=[],n=r=i=subStart(t),o=subLimit(t);o>r;n=r+=1)inSub(t,n)&&inSub(e,n)&&s.push(n);return s},subUnion=function(e,t){var n;return n=emptySubstitution(),n.start=e.start+t.start,n.fails=[].concat(t.fails,e.fails),n},subUnion_pure=function(e,t){var n,r,i,o,s,a;for(s=emptySubstitution(),i=Math.min(subStart(e),subStart(t)),n=Math.max(subLimit(e),subLimit(t)),s.start=i,r=a=i;n>a;r=a+=1)o=inSub(e,r)||inSub(t,r),o&&setInSub(s,r,o);return s.fails=[].concat(t.fails,e.fails),s},newSubstitution=function(){var e;return e=emptySubstitution(),e.start=0,e},newSubstitution_pure=function(e,t){var n;return n=emptySubstitution(),n.vars[0]=t,n.start=e,n},isFailed=function(e){return e.fails.length>0},substitutionFail=function(e){var t;return t=emptySubstitution(),t.fails.push(e),t},subLimit=function(e){return 1/0===e.start?-1/0:e.start},subLimit_pure=function(e){return 1/0===e.start?-1/0:e.start+e.vars.length},subStart=function(e){return e.start},setInSub=function(e,t,n){return e.vars[t-e.start]=n},inSub=function(e,t){return e.vars[t-e.start]},emptySubstitution=function(){return{start:1/0,fails:[]}},substitute_pure=function(e,t){return t.TypeVariable?e.vars&&inSub(e,t.name)||e.values&&lookupInMap(e,t.name)||t:t.QuantifiedVar?e[t["var"]]||t:t.TypeApp?withOrigin(new TypeApp(substitute(e,t.op),substitute(e,t.arg)),t.origin):t.ForAll?new ForAll(t.kinds,substitute(e,t.type)):t.Constrained?new Constrained(substituteList(e,t.constraints),substitute(e,t.type)):t.ClassConstraint?withOrigin(new ClassConstraint(t.className,substitute(e,t.types)),t.origin):t.Types?new Types(substituteList(e,t.types)):t},substituteList=function(e,t){return map(function(t){return substitute(e,t)},t)},findFree_pure=function(e){return e.TypeVariable?newMapWith(e.name,e.kind):e.TypeApp?concatMaps(findFree(e.op),findFree(e.arg)):e.Constrained?concatMaps(findFree(e.type),findFreeInList(e.constraints)):e.ClassConstraint?findFree(e.types):e.Types?findFreeInList(e.types):newMap()},findFreeInList=function(e){return concatMaps.apply(null,map(findFree,e))},findUnconstrained=function(e){return findFree(e.types.types[0])},findConstrained=function(e){return findFreeInList(e.types.types.slice(1))},freshInstance=function(e,t){var n;if(!t||!t.ForAll)throw new Error("not a forall in freshInstance "+safePrintType(t));return n=map(function(t){return e.freshTypeVariable(t)},t.kinds),substitute(n,t).type},freshName=function(e){return e},niceName=function(e){var t;return t=e>=25?niceName(Math.floor(e/25)-1):"",String.fromCharCode(97+e%25)+t},copyOrigin=function(e,t){var n,r,i,o,s;if(e.Constrained)for(copyOrigin(e.type,t.type),s=e.constraints,r=i=0,o=s.length;o>i;r=++i)n=s[r],copyOrigin(n,t.constraints[r]);else t.TypeVariable&&t.ref.val?copyOrigin(e,t.ref.val):(e.TypeApp&&(copyOrigin(e.op,t.op),copyOrigin(e.arg,t.arg)),mutateMarkingOrigin(e,t.origin));return e},mapOriginOnFunction=function(e,t){return isFunctionType(e)&&(withOrigin(e,t),withOrigin(e.op,t),e.op.op&&withOrigin(e.op.op,t),mapOriginOnFunction(e.arg,t)),e},mapOrigin=function(e,t){return mutateMappingOrigin(e,t),e},mutateMappingOrigin=function(e,t){var n,r,i,o,s,a,l,c,u,h;if(e.Constrained){for(mutateMappingOrigin(e.type,t),l=e.constraints,u=[],i=0,s=l.length;s>i;i++)n=l[i],u.push(mutateMarkingOrigin(n,t));return u}if(e.Types){for(c=e.types,h=[],o=0,a=c.length;a>o;o++)r=c[o],h.push(mutateMappingOrigin(r,t));return h}return e.TypeApp&&(mutateMappingOrigin(e.op,t),mutateMappingOrigin(e.arg,t)),mutateMarkingOrigin(e,t)},mapWithOrigin=function(e,t){var n;return n=cloneType(e),mapOrigin(n,t),n},markOrigin=function(e,t){var n;return n=cloneType(e),mutateMarkingOrigin(n,t),n},withOrigin=function(e,t){return mutateMarkingOrigin(e,t),e},mutateMarkingOrigin=function(e,t){return e.origin=t},cloneType=function(e){return substitute(newMap(),e)},isNormalizedConstraint=function(e){return isNormalizedConstraintArgument(e.types.types[0])},isNormalizedConstraintArgument=function(e){if(e){if(e.TypeVariable)return e.ref.val?isNormalizedConstraintArgument(e.ref.val):!0;if(e.TypeConstr)return!1;if(e.TypeApp)return isNormalizedConstraintArgument(e.op)}},isNormalizedConstraintArgument_pure=function(e){if(e){if(e.TypeVariable)return!0;if(e.TypeConstr)return!1;if(e.TypeApp)return isNormalizedConstraintArgument(e.op)}},includesJsType=function(e){return e.TypeVariable&&e.ref.val?includesJsType(e.ref.val):e.TypeConstr?typeEq(e,jsType):e.TypeApp?includesJsType(e.op)||includesJsType(e.arg):void 0},typeEq=function(e,t){return e.TypeVariable&&t.TypeVariable&&e.name===t.name?!0:e.TypeVariable&&e.ref.val?typeEq(e.ref.val,t):t.TypeVariable&&t.ref.val?typeEq(e,t.ref.val):e.TypeConstr&&t.TypeConstr?e.name===t.name:e.QuantifiedVar&&t.QuantifiedVar?e["var"]===t["var"]:e.TypeApp&&t.TypeApp?typeEq(e.op,t.op)&&typeEq(e.arg,t.arg):e.ForAll&&t.ForAll?typeEq(e.type,t.type):e.Constrained&&t.Constrained?all(zipWith(typeEq,e.constraints,t.constraints))&&typeEq(e.type,t.type):e.ClassConstraint&&t.ClassConstraint?e.className===t.className&&typeEq(e.types,t.types):e.Types&&t.Types?all(zipWith(typeEq,e.types,t.types)):!1},typeConstant=function(e){return new TypeConstr(e,star)},atomicType=function(e,t){return isNotCapital({symbol:e})?new TypeVariable(e,t):new TypeConstr(e,t)},tupleType=function(e){return new TypeConstr("["+e+"]",kindFn(e))},tupleOfTypes=function(e){return new Constrained(concatMap(_constraints,e),applyKindFn.apply(null,[tupleType(e.length)].concat(__slice.call(map(_type,e)))))},_constraints=function(e){return e.constraints},kindFn=function(e){return 0===e?star:new KindFn(star,kindFn(e-1))},kindFnOfArgs=function(){var e,t;return e=arguments[0],t=2<=arguments.length?__slice.call(arguments,1):[],e?new KindFn(e,kindFnOfArgs.apply(null,t)):star},typeFn=function(){var e,t;return e=arguments[0],t=2<=arguments.length?__slice.call(arguments,1):[],_empty(t)?new TypeApp(cloneType(zeroArrowType),e):properTypeFn.apply(null,[e].concat(__slice.call(t)))},properTypeFn=function(){var e,t,n;return t=arguments[0],n=arguments[1],e=3<=arguments.length?__slice.call(arguments,2):[],0===e.length?n?new TypeApp(new TypeApp(cloneType(arrowType),t),n):t:properTypeFn(t,properTypeFn.apply(null,[n].concat(__slice.call(e))))},applyKindFn=function(){var e,t,n;return n=arguments[0],e=arguments[1],t=3<=arguments.length?__slice.call(arguments,2):[],e?0===t.length?new TypeApp(n,e):applyKindFn.apply(null,[applyKindFn(n,e)].concat(__slice.call(t))):n},isConstructor=function(e){return e.TypeApp},kind=function(e){if(e.kind)return e.kind;if(e.TypeApp)return kind(e.op).to;throw new Error("Invalid type in kind")},kindsEq=function(e,t){return e===t||e&&t&&e.from&&t.from&&kindsEq(e.from,t.from)&&kindsEq(e.to,t.to)},printKind=function(e){var t;return e instanceof KindFn?(t=arityOfKind(e),"type constructor taking "+t+" argument"+(t>1?"s":"")):"type"},arityOfKind=function(e){return e instanceof KindFn?1+arityOfKind(e.to):0},KindFn=function(){function e(e,t){this.from=e,this.to=t}return e}(),TempKind=function(){function e(){}return e}(),TypeVariable=function(){function e(e,t,n){this.name=e,this.kind=t,this.ref=null!=n?n:{},this.TypeVariable=!0}return e}(),TypeConstr=function(){function e(e,t){this.name=e,this.kind=t,this.TypeConstr=!0}return e}(),TypeApp=function(){function e(e,t){this.op=e,this.arg=t,this.TypeApp=!0}return e}(),QuantifiedVar=function(){function e(e){this["var"]=e,this.QuantifiedVar=!0}return e}(),ForAll=function(){function e(e,t){this.kinds=e,this.type=t,this.ForAll=!0}return e}(),TempType=function(){function e(e){this.type=e,this.TempType=!0}return e}(),Types=function(){function e(e){this.types=e,this.Types=!0}return e}(),Constrained=function(){function e(e,t){this.constraints=e,this.type=t,this.Constrained=!0}return e}(),ClassConstraint=function(){function e(e,t){this.className=e,this.types=t,this.ClassConstraint=!0}return e}(),addConstraints=function(e,t){var n,r;return n=e.constraints,r=e.type,new Constrained(join(n,t),r)},replaceConstraints=function(e,t){var n;return n=e.type,new Constrained(t,n)},toConstrained=function(e){return new Constrained([],e)},toForAll=function(e){return new ForAll([],substitute(newMap(),e))},quantifyAll=function(e){return quantify(findFree(e),e)},quantify=function(e,t){var n,r,i,o;return r=filterMap(function(t){return inSet(e,t)},findFree(t)),n=mapToArray(r),o=0,i=mapMap(function(){return new QuantifiedVar(o++)},r),new ForAll(n,substitute(i,t))},star="*",arrowType=new TypeConstr("Fn",kindFn(2)),zeroArrowType=new TypeConstr("Fn0",kindFn(1)),arrayType=new TypeConstr("Array",kindFn(1)),listType=new TypeConstr("List",kindFn(1)),hashmapType=new TypeConstr("Map",kindFn(2)),hashsetType=new TypeConstr("Set",kindFn(1)),stringType=typeConstant("String"),charType=typeConstant("Char"),boolType=typeConstant("Bool"),numType=typeConstant("Num"),regexType=typeConstant("Regex"),jsType=typeConstant("Js"),expressionType=typeConstant("Expression"),safePrintType=function(e){var t;try{return printType(e)}catch(n){return t=n,""+e}},prettyPrintForError=function(e){var t;try{return"<code>"+prettyPrint(e)+"</code>"}catch(n){return t=n,""+e}},highlightTypeForError=function(e){return"<code>"+collapse(toHtml(e))+"</code>"},prettyPrint=function(e){return prettyPrintWith(printTypeToHtml,e)},plainPrettyPrint=function(e){return prettyPrintWith(printType,e)},prettyPrintWith=function(e,t){return t.ForAll?prettyPrintWith(e,forallToHumanReadable(t)):t.Constrained?_notEmpty(t.constraints)?map(e,join([t.type],t.constraints)).join(" "):e(t.type):e(t)},_fakeContext=void 0,fakeContext=function(){return _fakeContext||(_fakeContext=new Context)},forallToHumanReadable=function(e){var t,n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,C;for(p=function(e){return e.Types&&e.types.length>1?mapMap(function(){return findFreeInList(e.types.slice(1))},p(e.types[0])):e.TypeVariable?newSetWith(e.name):e.TypeApp?p(e.op):newSet()},b=function(e){var t;return t=e.name},g=function(e,t){return{name:e,deps:map(function(e){return{name:e}},setToArray(t))}},r=freshInstance(fakeContext(),e),t=findFree(r),s=concatMaps.apply(null,function(){var e,t,i,o;for(i=r.constraints,o=[],e=0,t=i.length;t>e;e++)n=i[e],o.push(p(n.types));return o}()),o=topologicallySortedGroups(mapToArrayVia(g,s)),C=partitionMap(function(e,t){return inSet(s,t)},t),i=C[0],f=C[1],c=0,u=function(e){return new TypeVariable(e,star)},d=function(){return String.fromCharCode(97+c++%25)},m=mapKeys(__(u,d),f),h=function(e){var t,n;return"undefined"!==e?(t=setToArray(lookupInMap(s,e)),n=map(function(e){return lookupInMap(m,e).name},t).join(""),d()+(n?"-"+n:"")):void 0},v=0,y=o.length;y>v;v++)l=o[v],a=filterSet(function(e){return inSet(s,e)},l),m=concatMaps(m,mapKeys(__(u,h),a));return substitute(m,r)},printType=function(e){if(e.TypeVariable)return e.ref.val?printType(e.ref.val):/^[0-9]/.test(e.name)?niceName(e.name):""+e.name;if(e.QuantifiedVar)return niceName(e["var"]);if(e.TypeConstr)return""+e.name;if(e.TypeApp)return flattenType(collectArgs(e));if(e.ForAll)return"(∀ "+printType(e.type)+")";if(e.ClassConstraint)return"("+e.className+" "+map(printType,e.types.types).join(" ")+")";if(e.Constrained)return"(: "+map(printType,join([e.type],e.constraints)).join(" ")+")";if(e.TempType)return"(. "+printType(e.type)+")";if(e.Types)return map(printType,e.types).join(" ");if(Array.isArray(e))return'"'+listOf(e)+'"';if(void 0===e)return"undefined";throw new Error("Unrecognized type in printType")},printTypeToHtml=function(e){var t;if(e.TypeVariable)return e.ref.val?printTypeToHtml(e.ref.val):kindedToHtml(e,/^[0-9]/.test(e.name)?niceName(e.name):""+e.name);if(e.QuantifiedVar)return themize(e.error?"malformed":"typename",niceName(e["var"]));if(e.TypeConstr)return kindedToHtml(e,e.name);if(e.TypeApp)return t=flatten(e),printFlattenedToHtml(t);if(e.ClassConstraint)return htmlCalled(e,""+opNameToHtml(e.className)+" "+map(printTypeToHtml,e.types.types).join(" "));if(e.Constrained)return htmlCalled(e,": "+map(printTypeToHtml,join([e.type],e.constraints)).join(" "));if(e.args)return printFlattenedToHtml(e);throw new Error("Unrecognized type in printTypeToHtml")},printFlattenedToHtml=function(e){var t,n;return n=printType(e.op),printType(e.op).match(/^\[\d+\]$/)?htmlDelimited(e,"[","]",""+map(printTypeToHtml,e.args).join(" ")):(t="Fn0"===n?opNameToHtml("Fn"):printTypeToHtml(e.op),htmlCalled(e,""+t+" "+map(printTypeToHtml,e.args).join(" ")))},htmlCalled=function(e,t){return htmlDelimited(e,"(",")",t)},htmlDelimited=function(e,t,n,r){var i;return i=e.error?"malformed":"paren",themize(i,t)+r+themize(i,n)},flatten=function(e){var t,n;return e.TypeApp?(n=flatten(e.op),t=flatten(e.arg),n.args&&t.op&&"Fn"===n.op.name&&"Fn"===t.op.name?{op:n.op,args:join(n.args,t.args),error:e.error||t.error}:n.args?{op:n.op,args:join(n.args,[t]),error:e.error||n.error}:{op:n,args:[t],error:e.error}):e},kindedToHtml=function(e,t){return themize(e.error?"malformed":kind(e).from?"operator":"typename",t)},opNameToHtml=function(e){return themize("operator",""+e)},collectArgs=function(e){var t,n;return e.TypeVariable&&e.ref.val?collectArgs(e.ref.val):e.TypeApp?(n=collectArgs(e.op),t=collectArgs(e.arg),Array.isArray(n)&&Array.isArray(t)&&"Fn"===n[0]&&"Fn"===t[0]?join(n,t.slice(1)):join(Array.isArray(n)?n:[n],[Array.isArray(t)?flattenType(t):t])):printType(e)},flattenType=function(e){return e[0].match(/^\[\d+\]$/)?"["+e.slice(1).join(" ")+"]":"Fn0"===e[0]?"(Fn "+e.slice(1).join(" ")+")":"("+e.join(" ")+")"},library="var $listize = function (list) {\n  if (list.length === 0) {\n   return {length: 0};\n  }\n  return and_(list[0], $listize(list.slice(1)));\n};\n\nvar and_ = function (x, xs) {\n  if (typeof xs === \"undefined\" || xs === null) {\n    throw new Error('Second argument to & must be a sequence');\n  }\n  if (Immutable.List.isList(xs)) {\n    return xs.unshift(x);\n  }\n  if (Immutable.Set.isSet(xs)) {\n    return xs.add(x);\n  }\n  if (typeof xs == 'string' || xs instanceof String) {\n    if (xs === '' && !(typeof x == 'string' || x instanceof String)) {\n      return [x];\n    } else {\n      return x + xs;\n    }\n  }\n  if (xs.unshift) {\n    return [x].concat(xs);\n  }// cases for other sequences\n  return {\n    head: x,\n    tail: xs\n  };\n};\n\nvar seq_size = function (xs) {\n  if (typeof xs === \"undefined\" || xs === null) {\n    throw new Error('Pattern matching on size of undefined');\n  }\n  if (xs.size !== null) {\n    return xs.size;\n  }\n  if (xs.length !== null) {\n    return xs.length;\n  }\n  return 1 + seq_size(xs.tail);\n};\n\nvar seq_at = function (i, xs) {\n  if (typeof xs === \"undefined\" || xs === null) {\n    throw new Error('Pattern matching required sequence got undefined');\n  }\n  if (Immutable.Iterable.isIterable(xs)) {\n    if (i >= xs.size) {\n      throw new Error('Pattern matching required a list of size at least ' + (i + 1));\n    }\n    return xs.get(i);\n  }\n  if (xs.length !== null) {\n    if (i >= xs.length) {\n      throw new Error('Pattern matching required a list of size at least ' + (i + 1));\n    }\n    return xs[i];\n  }\n  if (i === 0) {\n    return xs.head;\n  }\n  return seq_at(i - 1, xs.tail);\n};\n\nvar seq_splat = function (from, leave, xs) {\n  if (xs.slice) {\n    return xs.slice(from, (xs.size || xs.length) - leave);\n  }\n  return $listSlice(from, seq_size(xs) - leave - from, xs);\n};\n\n// temporary, will be replaced by typed 0-argument function\nvar $empty = function (xs) {\n  if (typeof xs === \"undefined\" || xs === null) {\n    throw new Error('Empty needs a sequence');\n  }\n  if (typeof xs == 'string' || xs instanceof String) {\n    return \"\";\n  }\n  if (xs.unshift) {\n    return [];\n  }\n  if ('length' in xs) {\n    return $listize([]);\n  } // cases for other sequences\n  return {};\n};\n\nvar $listSlice = function (from, n, xs) {\n  if (n === 0) {\n    return $listize([]);\n  }\n  if (from === 0) {\n    return and_(xs.head, $listSlice(from, n - 1, xs.tail));\n  }\n  return $listSlice(from - 1, n, xs.tail);\n};\n\nvar show__list = function (x) {\n  var t = [];\n  while (x.length !== 0) {\n    t.push(x.head);\n    x = x.tail;\n  }\n  return t;\n};\n\nvar is__null__or__undefined = function (jsValue) {\n  return typeof jsValue === \"undefined\" || jsValue === null;\n};"+function(){var e,t;for(t=[],i=e=1;9>=e;i=++e)varNames="abcdefghi".split(""),first=function(e){return varNames.slice(0,e).join(", ")},t.push("var _"+i+" = function (fn, "+first(i)+") {\n  if (fn._ === "+i+" || !fn._ && fn.length === "+i+") {\n    return fn("+first(i)+");\n  } else if (fn._ > "+i+" || !fn._ && fn.length > "+i+") {\n    return function ("+varNames[i]+") {\n      return _"+(i+1)+"(fn, "+first(i+1)+");\n    };\n  } else {\n    return _1("+(1===i?"fn()":"_"+(i-1)+"(fn, "+first(i-1)+")")+", "+varNames[i-1]+");\n  }\n};");return t}().join("\n\n")+function(){var e,t;for(t=[],i=e=0;9>=e;i=++e)t.push("var λ"+i+" = function (fn) {\n  fn._ = "+i+";\n  return fn;\n};");return t}().join("\n\n")+"var _0 = function (fn) {\n  if (fn._ === 0 || !fn._ && fn.length === 0) {\n    return fn();\n  } else if (fn._ > 0 || !fn._ && fn.length > 0) {\n    return function (a) {\n      return _1(fn, a);\n    };\n  }\n}\n;\nvar global = (1,eval)('this');\nvar Shem = Shem || {};",eval(library),immutable='/**\n *  Copyright (c) 2014-2015, Facebook, Inc.\n *  All rights reserved.\n *\n *  This source code is licensed under the BSD-style license found in the\n *  LICENSE file in the root directory of this source tree. An additional grant\n *  of patent rights can be found in the PATENTS file in the same directory.\n *\n * I removed the loader code for nodejs and amd because it was clashing with require js for now\n * I also changed context to window, to make sure it registers when evaling\n */\n!function(t,e){global.Immutable=e()}(this,function(){"use strict";function t(t,e){e&&(t.prototype=Object.create(e.prototype)),t.prototype.constructor=t}function e(t){return t.value=!1,t}function r(t){t&&(t.value=!0)}function n(){}function i(t,e){e=e||0;for(var r=Math.max(0,t.length-e),n=Array(r),i=0;r>i;i++)n[i]=t[i+e];return n}function o(t){return void 0===t.size&&(t.size=t.__iterate(s)),t.size}function u(t,e){return e>=0?+e:o(t)+ +e}function s(){return!0}function a(t,e,r){return(0===t||void 0!==r&&-r>=t)&&(void 0===e||void 0!==r&&e>=r)}function h(t,e){return c(t,e,0)}function f(t,e){return c(t,e,e)}function c(t,e,r){return void 0===t?r:0>t?Math.max(0,e+t):void 0===e?t:Math.min(e,t)}function _(t){return y(t)?t:O(t)}function p(t){return d(t)?t:x(t)}function v(t){return m(t)?t:k(t)}function l(t){return y(t)&&!g(t)?t:A(t)}function y(t){return!(!t||!t[vr])}function d(t){return!(!t||!t[lr])}function m(t){return!(!t||!t[yr])}function g(t){return d(t)||m(t)}function w(t){return!(!t||!t[dr])}function S(t){this.next=t}function z(t,e,r,n){var i=0===t?e:1===t?r:[e,r];return n?n.value=i:n={value:i,done:!1},n}function I(){return{value:void 0,done:!0}}function b(t){return!!M(t)}function q(t){return t&&"function"==typeof t.next}function D(t){var e=M(t);return e&&e.call(t)}function M(t){var e=t&&(Sr&&t[Sr]||t[zr]);return"function"==typeof e?e:void 0}function E(t){return t&&"number"==typeof t.length}function O(t){return null===t||void 0===t?T():y(t)?t.toSeq():C(t)}function x(t){return null===t||void 0===t?T().toKeyedSeq():y(t)?d(t)?t.toSeq():t.fromEntrySeq():W(t)}function k(t){return null===t||void 0===t?T():y(t)?d(t)?t.entrySeq():t.toIndexedSeq():B(t)}function A(t){return(null===t||void 0===t?T():y(t)?d(t)?t.entrySeq():t:B(t)).toSetSeq()}function j(t){this._array=t,this.size=t.length}function R(t){var e=Object.keys(t);this._object=t,this._keys=e,this.size=e.length}function U(t){this._iterable=t,this.size=t.length||t.size;}function K(t){this._iterator=t,this._iteratorCache=[]}function L(t){return!(!t||!t[br])}function T(){return qr||(qr=new j([]))}function W(t){var e=Array.isArray(t)?new j(t).fromEntrySeq():q(t)?new K(t).fromEntrySeq():b(t)?new U(t).fromEntrySeq():"object"==typeof t?new R(t):void 0;if(!e)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+t);return e}function B(t){var e=J(t);if(!e)throw new TypeError("Expected Array or iterable object of values: "+t);return e}function C(t){var e=J(t)||"object"==typeof t&&new R(t);if(!e)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+t);return e}function J(t){return E(t)?new j(t):q(t)?new K(t):b(t)?new U(t):void 0}function P(t,e,r,n){var i=t._cache;if(i){for(var o=i.length-1,u=0;o>=u;u++){var s=i[r?o-u:u];if(e(s[1],n?s[0]:u,t)===!1)return u+1}return u}return t.__iterateUncached(e,r)}function H(t,e,r,n){var i=t._cache;if(i){var o=i.length-1,u=0;return new S(function(){var t=i[r?o-u:u];return u++>o?I():z(e,n?t[0]:u-1,t[1])})}return t.__iteratorUncached(e,r)}function N(){throw TypeError("Abstract")}function V(){}function Y(){}function Q(){}function X(t,e){if(t===e||t!==t&&e!==e)return!0;if(!t||!e)return!1;if("function"==typeof t.valueOf&&"function"==typeof e.valueOf){if(t=t.valueOf(),e=e.valueOf(),t===e||t!==t&&e!==e)return!0;if(!t||!e)return!1}return"function"==typeof t.equals&&"function"==typeof e.equals&&t.equals(e)?!0:!1}function F(t,e){return e?G(e,t,"",{"":t}):Z(t)}function G(t,e,r,n){return Array.isArray(e)?t.call(n,r,k(e).map(function(r,n){return G(t,r,n,e)})):$(e)?t.call(n,r,x(e).map(function(r,n){return G(t,r,n,e)})):e}function Z(t){return Array.isArray(t)?k(t).map(Z).toList():$(t)?x(t).map(Z).toMap():t}function $(t){return t&&(t.constructor===Object||void 0===t.constructor)}function tt(t){return t>>>1&1073741824|3221225471&t}function et(t){if(t===!1||null===t||void 0===t)return 0;if("function"==typeof t.valueOf&&(t=t.valueOf(),t===!1||null===t||void 0===t))return 0;if(t===!0)return 1;var e=typeof t;if("number"===e){var r=0|t;for(r!==t&&(r^=4294967295*t);t>4294967295;)t/=4294967295,r^=t;return tt(r)}return"string"===e?t.length>jr?rt(t):nt(t):"function"==typeof t.hashCode?t.hashCode():it(t)}function rt(t){var e=Kr[t];return void 0===e&&(e=nt(t),Ur===Rr&&(Ur=0,Kr={}),Ur++,Kr[t]=e),e}function nt(t){for(var e=0,r=0;t.length>r;r++)e=31*e+t.charCodeAt(r)|0;return tt(e)}function it(t){var e;if(xr&&(e=Dr.get(t),void 0!==e))return e;if(e=t[Ar],void 0!==e)return e;if(!Or){if(e=t.propertyIsEnumerable&&t.propertyIsEnumerable[Ar],void 0!==e)return e;if(e=ot(t),void 0!==e)return e}if(e=++kr,1073741824&kr&&(kr=0),xr)Dr.set(t,e);else{if(void 0!==Er&&Er(t)===!1)throw Error("Non-extensible objects are not allowed as keys.");if(Or)Object.defineProperty(t,Ar,{enumerable:!1,configurable:!1,writable:!1,value:e});else if(void 0!==t.propertyIsEnumerable&&t.propertyIsEnumerable===t.constructor.prototype.propertyIsEnumerable)t.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},t.propertyIsEnumerable[Ar]=e;else{if(void 0===t.nodeType)throw Error("Unable to set a non-enumerable property on object.");t[Ar]=e}}return e}function ot(t){if(t&&t.nodeType>0)switch(t.nodeType){case 1:return t.uniqueID;case 9:return t.documentElement&&t.documentElement.uniqueID}}function ut(t,e){if(!t)throw Error(e)}function st(t){ut(t!==1/0,"Cannot perform this action with an infinite size.")}function at(t,e){this._iter=t,this._useKeys=e,this.size=t.size}function ht(t){this._iter=t,this.size=t.size}function ft(t){this._iter=t,this.size=t.size}function ct(t){this._iter=t,this.size=t.size}function _t(t){var e=jt(t);return e._iter=t,e.size=t.size,e.flip=function(){return t},e.reverse=function(){var e=t.reverse.apply(this);return e.flip=function(){return t.reverse()},e},e.has=function(e){return t.includes(e)},e.includes=function(e){return t.has(e)},e.cacheResult=Rt,e.__iterateUncached=function(e,r){var n=this;return t.__iterate(function(t,r){return e(r,t,n)!==!1},r)},e.__iteratorUncached=function(e,r){if(e===wr){\nvar n=t.__iterator(e,r);return new S(function(){var t=n.next();if(!t.done){var e=t.value[0];t.value[0]=t.value[1],t.value[1]=e}return t})}return t.__iterator(e===gr?mr:gr,r)},e}function pt(t,e,r){var n=jt(t);return n.size=t.size,n.has=function(e){return t.has(e)},n.get=function(n,i){var o=t.get(n,cr);return o===cr?i:e.call(r,o,n,t)},n.__iterateUncached=function(n,i){var o=this;return t.__iterate(function(t,i,u){return n(e.call(r,t,i,u),i,o)!==!1},i)},n.__iteratorUncached=function(n,i){var o=t.__iterator(wr,i);return new S(function(){var i=o.next();if(i.done)return i;var u=i.value,s=u[0];return z(n,s,e.call(r,u[1],s,t),i)})},n}function vt(t,e){var r=jt(t);return r._iter=t,r.size=t.size,r.reverse=function(){return t},t.flip&&(r.flip=function(){var e=_t(t);return e.reverse=function(){return t.flip()},e}),r.get=function(r,n){return t.get(e?r:-1-r,n)},r.has=function(r){return t.has(e?r:-1-r)},r.includes=function(e){return t.includes(e)},r.cacheResult=Rt,r.__iterate=function(e,r){var n=this;return t.__iterate(function(t,r){return e(t,r,n)},!r)},r.__iterator=function(e,r){return t.__iterator(e,!r)},r}function lt(t,e,r,n){var i=jt(t);return n&&(i.has=function(n){var i=t.get(n,cr);return i!==cr&&!!e.call(r,i,n,t)},i.get=function(n,i){var o=t.get(n,cr);return o!==cr&&e.call(r,o,n,t)?o:i}),i.__iterateUncached=function(i,o){var u=this,s=0;return t.__iterate(function(t,o,a){return e.call(r,t,o,a)?(s++,i(t,n?o:s-1,u)):void 0},o),s},i.__iteratorUncached=function(i,o){var u=t.__iterator(wr,o),s=0;return new S(function(){for(;;){var o=u.next();if(o.done)return o;var a=o.value,h=a[0],f=a[1];if(e.call(r,f,h,t))return z(i,n?h:s++,f,o)}})},i}function yt(t,e,r){var n=Lt().asMutable();return t.__iterate(function(i,o){n.update(e.call(r,i,o,t),0,function(t){return t+1})}),n.asImmutable()}function dt(t,e,r){var n=d(t),i=(w(t)?Ie():Lt()).asMutable();t.__iterate(function(o,u){i.update(e.call(r,o,u,t),function(t){return t=t||[],t.push(n?[u,o]:o),t})});var o=At(t);return i.map(function(e){return Ot(t,o(e))})}function mt(t,e,r,n){var i=t.size;if(a(e,r,i))return t;var o=h(e,i),s=f(r,i);if(o!==o||s!==s)return mt(t.toSeq().cacheResult(),e,r,n);var c=s-o;0>c&&(c=0);var _=jt(t);return _.size=0===c?c:t.size&&c||void 0,!n&&L(t)&&c>=0&&(_.get=function(e,r){return e=u(this,e),e>=0&&c>e?t.get(e+o,r):r}),_.__iterateUncached=function(e,r){var i=this;if(0===c)return 0;if(r)return this.cacheResult().__iterate(e,r);var u=0,s=!0,a=0;return t.__iterate(function(t,r){return s&&(s=u++<o)?void 0:(a++,e(t,n?r:a-1,i)!==!1&&a!==c)}),a},_.__iteratorUncached=function(e,r){if(c&&r)return this.cacheResult().__iterator(e,r);var i=c&&t.__iterator(e,r),u=0,s=0;return new S(function(){for(;u++<o;)i.next();if(++s>c)return I();var t=i.next();return n||e===gr?t:e===mr?z(e,s-1,void 0,t):z(e,s-1,t.value[1],t)})},_}function gt(t,e,r){var n=jt(t);return n.__iterateUncached=function(n,i){var o=this;if(i)return this.cacheResult().__iterate(n,i);var u=0;return t.__iterate(function(t,i,s){return e.call(r,t,i,s)&&++u&&n(t,i,o)}),u},n.__iteratorUncached=function(n,i){var o=this;if(i)return this.cacheResult().__iterator(n,i);var u=t.__iterator(wr,i),s=!0;return new S(function(){if(!s)return I();var t=u.next();if(t.done)return t;var i=t.value,a=i[0],h=i[1];return e.call(r,h,a,o)?n===wr?t:z(n,a,h,t):(s=!1,I())})},n}function wt(t,e,r,n){var i=jt(t);return i.__iterateUncached=function(i,o){var u=this;if(o)return this.cacheResult().__iterate(i,o);var s=!0,a=0;return t.__iterate(function(t,o,h){return s&&(s=e.call(r,t,o,h))?void 0:(a++,i(t,n?o:a-1,u))}),a},i.__iteratorUncached=function(i,o){var u=this;if(o)return this.cacheResult().__iterator(i,o);var s=t.__iterator(wr,o),a=!0,h=0;return new S(function(){var t,o,f;do{if(t=s.next(),t.done)return n||i===gr?t:i===mr?z(i,h++,void 0,t):z(i,h++,t.value[1],t);var c=t.value;o=c[0],f=c[1],a&&(a=e.call(r,f,o,u))}while(a);return i===wr?t:z(i,o,f,t)})},i}function St(t,e){var r=d(t),n=[t].concat(e).map(function(t){return y(t)?r&&(t=p(t)):t=r?W(t):B(Array.isArray(t)?t:[t]),t}).filter(function(t){return 0!==t.size});if(0===n.length)return t;if(1===n.length){var i=n[0];if(i===t||r&&d(i)||m(t)&&m(i))return i;}var o=new j(n);return r?o=o.toKeyedSeq():m(t)||(o=o.toSetSeq()),o=o.flatten(!0),o.size=n.reduce(function(t,e){if(void 0!==t){var r=e.size;if(void 0!==r)return t+r}},0),o}function zt(t,e,r){var n=jt(t);return n.__iterateUncached=function(n,i){function o(t,a){var h=this;t.__iterate(function(t,i){return(!e||e>a)&&y(t)?o(t,a+1):n(t,r?i:u++,h)===!1&&(s=!0),!s},i)}var u=0,s=!1;return o(t,0),u},n.__iteratorUncached=function(n,i){var o=t.__iterator(n,i),u=[],s=0;return new S(function(){for(;o;){var t=o.next();if(t.done===!1){var a=t.value;if(n===wr&&(a=a[1]),e&&!(e>u.length)||!y(a))return r?t:z(n,s++,a,t);u.push(o),o=a.__iterator(n,i)}else o=u.pop()}return I()})},n}function It(t,e,r){var n=At(t);return t.toSeq().map(function(i,o){return n(e.call(r,i,o,t))}).flatten(!0)}function bt(t,e){var r=jt(t);return r.size=t.size&&2*t.size-1,r.__iterateUncached=function(r,n){var i=this,o=0;return t.__iterate(function(t){return(!o||r(e,o++,i)!==!1)&&r(t,o++,i)!==!1},n),o},r.__iteratorUncached=function(r,n){var i,o=t.__iterator(gr,n),u=0;return new S(function(){return(!i||u%2)&&(i=o.next(),i.done)?i:u%2?z(r,u++,e):z(r,u++,i.value,i)})},r}function qt(t,e,r){e||(e=Ut);var n=d(t),i=0,o=t.toSeq().map(function(e,n){return[n,e,i++,r?r(e,n,t):e]}).toArray();return o.sort(function(t,r){return e(t[3],r[3])||t[2]-r[2]}).forEach(n?function(t,e){o[e].length=2}:function(t,e){o[e]=t[1]}),n?x(o):m(t)?k(o):A(o)}function Dt(t,e,r){if(e||(e=Ut),r){var n=t.toSeq().map(function(e,n){return[e,r(e,n,t)]}).reduce(function(t,r){return Mt(e,t[1],r[1])?r:t});return n&&n[0]}return t.reduce(function(t,r){return Mt(e,t,r)?r:t})}function Mt(t,e,r){var n=t(r,e);return 0===n&&r!==e&&(void 0===r||null===r||r!==r)||n>0}function Et(t,e,r){var n=jt(t);return n.size=new j(r).map(function(t){return t.size}).min(),n.__iterate=function(t,e){for(var r,n=this.__iterator(gr,e),i=0;!(r=n.next()).done&&t(r.value,i++,this)!==!1;);return i},n.__iteratorUncached=function(t,n){var i=r.map(function(t){return t=_(t),D(n?t.reverse():t)}),o=0,u=!1;return new S(function(){var r;return u||(r=i.map(function(t){\nreturn t.next()}),u=r.some(function(t){return t.done})),u?I():z(t,o++,e.apply(null,r.map(function(t){return t.value})))})},n}function Ot(t,e){return L(t)?e:t.constructor(e)}function xt(t){if(t!==Object(t))throw new TypeError("Expected [K, V] tuple: "+t)}function kt(t){return st(t.size),o(t)}function At(t){return d(t)?p:m(t)?v:l}function jt(t){return Object.create((d(t)?x:m(t)?k:A).prototype)}function Rt(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):O.prototype.cacheResult.call(this)}function Ut(t,e){return t>e?1:e>t?-1:0}function Kt(t){var e=D(t);if(!e){if(!E(t))throw new TypeError("Expected iterable or array-like: "+t);e=D(_(t))}return e}function Lt(t){return null===t||void 0===t?Qt():Tt(t)?t:Qt().withMutations(function(e){var r=p(t);st(r.size),r.forEach(function(t,r){return e.set(r,t)})})}function Tt(t){return!(!t||!t[Lr])}function Wt(t,e){this.ownerID=t,this.entries=e}function Bt(t,e,r){this.ownerID=t,this.bitmap=e,this.nodes=r}function Ct(t,e,r){this.ownerID=t,this.count=e,this.nodes=r}function Jt(t,e,r){this.ownerID=t,this.keyHash=e,this.entries=r}function Pt(t,e,r){this.ownerID=t,this.keyHash=e,this.entry=r}function Ht(t,e,r){this._type=e,this._reverse=r,this._stack=t._root&&Vt(t._root)}function Nt(t,e){return z(t,e[0],e[1])}function Vt(t,e){return{node:t,index:0,__prev:e}}function Yt(t,e,r,n){var i=Object.create(Tr);return i.size=t,i._root=e,i.__ownerID=r,i.__hash=n,i.__altered=!1,i}function Qt(){return Wr||(Wr=Yt(0))}function Xt(t,r,n){var i,o;if(t._root){var u=e(_r),s=e(pr);if(i=Ft(t._root,t.__ownerID,0,void 0,r,n,u,s),!s.value)return t;o=t.size+(u.value?n===cr?-1:1:0)}else{if(n===cr)return t;o=1,i=new Wt(t.__ownerID,[[r,n]])}return t.__ownerID?(t.size=o,t._root=i,t.__hash=void 0,t.__altered=!0,t):i?Yt(o,i):Qt()}function Ft(t,e,n,i,o,u,s,a){return t?t.update(e,n,i,o,u,s,a):u===cr?t:(r(a),r(s),new Pt(e,i,[o,u]))}function Gt(t){return t.constructor===Pt||t.constructor===Jt}function Zt(t,e,r,n,i){if(t.keyHash===n)return new Jt(e,n,[t.entry,i]);var o,u=(0===r?t.keyHash:t.keyHash>>>r)&fr,s=(0===r?n:n>>>r)&fr,a=u===s?[Zt(t,e,r+ar,n,i)]:(o=new Pt(e,n,i),\ns>u?[t,o]:[o,t]);return new Bt(e,1<<u|1<<s,a)}function $t(t,e,r,i){t||(t=new n);for(var o=new Pt(t,et(r),[r,i]),u=0;e.length>u;u++){var s=e[u];o=o.update(t,0,void 0,s[0],s[1])}return o}function te(t,e,r,n){for(var i=0,o=0,u=Array(r),s=0,a=1,h=e.length;h>s;s++,a<<=1){var f=e[s];void 0!==f&&s!==n&&(i|=a,u[o++]=f)}return new Bt(t,i,u)}function ee(t,e,r,n,i){for(var o=0,u=Array(hr),s=0;0!==r;s++,r>>>=1)u[s]=1&r?e[o++]:void 0;return u[n]=i,new Ct(t,o+1,u)}function re(t,e,r){for(var n=[],i=0;r.length>i;i++){var o=r[i],u=p(o);y(o)||(u=u.map(function(t){return F(t)})),n.push(u)}return ie(t,e,n)}function ne(t){return function(e,r,n){return e&&e.mergeDeepWith&&y(r)?e.mergeDeepWith(t,r):t?t(e,r,n):r}}function ie(t,e,r){return r=r.filter(function(t){return 0!==t.size}),0===r.length?t:0!==t.size||t.__ownerID||1!==r.length?t.withMutations(function(t){for(var n=e?function(r,n){t.update(n,cr,function(t){return t===cr?r:e(t,r,n)})}:function(e,r){t.set(r,e)},i=0;r.length>i;i++)r[i].forEach(n)}):t.constructor(r[0])}function oe(t,e,r,n){var i=t===cr,o=e.next();if(o.done){var u=i?r:t,s=n(u);return s===u?t:s}ut(i||t&&t.set,"invalid keyPath");var a=o.value,h=i?cr:t.get(a,cr),f=oe(h,e,r,n);return f===h?t:f===cr?t.remove(a):(i?Qt():t).set(a,f)}function ue(t){return t-=t>>1&1431655765,t=(858993459&t)+(t>>2&858993459),t=t+(t>>4)&252645135,t+=t>>8,t+=t>>16,127&t}function se(t,e,r,n){var o=n?t:i(t);return o[e]=r,o}function ae(t,e,r,n){var i=t.length+1;if(n&&e+1===i)return t[e]=r,t;for(var o=Array(i),u=0,s=0;i>s;s++)s===e?(o[s]=r,u=-1):o[s]=t[s+u];return o}function he(t,e,r){var n=t.length-1;if(r&&e===n)return t.pop(),t;for(var i=Array(n),o=0,u=0;n>u;u++)u===e&&(o=1),i[u]=t[u+o];return i}function fe(t){var e=le();if(null===t||void 0===t)return e;if(ce(t))return t;var r=v(t),n=r.size;return 0===n?e:(st(n),n>0&&hr>n?ve(0,n,ar,null,new _e(r.toArray())):e.withMutations(function(t){t.setSize(n),r.forEach(function(e,r){return t.set(r,e)})}))}function ce(t){return!(!t||!t[Pr])}function _e(t,e){this.array=t,this.ownerID=e}function pe(t,e){function r(t,e,r){\nreturn 0===e?n(t,r):i(t,e,r)}function n(t,r){var n=r===s?a&&a.array:t&&t.array,i=r>o?0:o-r,h=u-r;return h>hr&&(h=hr),function(){if(i===h)return Vr;var t=e?--h:i++;return n&&n[t]}}function i(t,n,i){var s,a=t&&t.array,h=i>o?0:o-i>>n,f=(u-i>>n)+1;return f>hr&&(f=hr),function(){for(;;){if(s){var t=s();if(t!==Vr)return t;s=null}if(h===f)return Vr;var o=e?--f:h++;s=r(a&&a[o],n-ar,i+(o<<n))}}}var o=t._origin,u=t._capacity,s=ze(u),a=t._tail;return r(t._root,t._level,0)}function ve(t,e,r,n,i,o,u){var s=Object.create(Hr);return s.size=e-t,s._origin=t,s._capacity=e,s._level=r,s._root=n,s._tail=i,s.__ownerID=o,s.__hash=u,s.__altered=!1,s}function le(){return Nr||(Nr=ve(0,0,ar))}function ye(t,r,n){if(r=u(t,r),r>=t.size||0>r)return t.withMutations(function(t){0>r?we(t,r).set(0,n):we(t,0,r+1).set(r,n)});r+=t._origin;var i=t._tail,o=t._root,s=e(pr);return r>=ze(t._capacity)?i=de(i,t.__ownerID,0,r,n,s):o=de(o,t.__ownerID,t._level,r,n,s),s.value?t.__ownerID?(t._root=o,t._tail=i,t.__hash=void 0,t.__altered=!0,t):ve(t._origin,t._capacity,t._level,o,i):t}function de(t,e,n,i,o,u){var s=i>>>n&fr,a=t&&t.array.length>s;if(!a&&void 0===o)return t;var h;if(n>0){var f=t&&t.array[s],c=de(f,e,n-ar,i,o,u);return c===f?t:(h=me(t,e),h.array[s]=c,h)}return a&&t.array[s]===o?t:(r(u),h=me(t,e),void 0===o&&s===h.array.length-1?h.array.pop():h.array[s]=o,h)}function me(t,e){return e&&t&&e===t.ownerID?t:new _e(t?t.array.slice():[],e)}function ge(t,e){if(e>=ze(t._capacity))return t._tail;if(1<<t._level+ar>e){for(var r=t._root,n=t._level;r&&n>0;)r=r.array[e>>>n&fr],n-=ar;return r}}function we(t,e,r){var i=t.__ownerID||new n,o=t._origin,u=t._capacity,s=o+e,a=void 0===r?u:0>r?u+r:o+r;if(s===o&&a===u)return t;if(s>=a)return t.clear();for(var h=t._level,f=t._root,c=0;0>s+c;)f=new _e(f&&f.array.length?[void 0,f]:[],i),h+=ar,c+=1<<h;c&&(s+=c,o+=c,a+=c,u+=c);for(var _=ze(u),p=ze(a);p>=1<<h+ar;)f=new _e(f&&f.array.length?[f]:[],i),h+=ar;var v=t._tail,l=_>p?ge(t,a-1):p>_?new _e([],i):v;if(v&&p>_&&u>s&&v.array.length){f=me(f,i);for(var y=f,d=h;d>ar;d-=ar){var m=_>>>d&fr;y=y.array[m]=me(y.array[m],i)}y.array[_>>>ar&fr]=v}if(u>a&&(l=l&&l.removeAfter(i,0,a)),s>=p)s-=p,a-=p,h=ar,f=null,l=l&&l.removeBefore(i,0,s);else if(s>o||_>p){for(c=0;f;){var g=s>>>h&fr;if(g!==p>>>h&fr)break;g&&(c+=(1<<h)*g),h-=ar,f=f.array[g]}f&&s>o&&(f=f.removeBefore(i,h,s-c)),f&&_>p&&(f=f.removeAfter(i,h,p-c)),c&&(s-=c,a-=c)}return t.__ownerID?(t.size=a-s,t._origin=s,t._capacity=a,t._level=h,t._root=f,t._tail=l,t.__hash=void 0,t.__altered=!0,t):ve(s,a,h,f,l)}function Se(t,e,r){for(var n=[],i=0,o=0;r.length>o;o++){var u=r[o],s=v(u);s.size>i&&(i=s.size),y(u)||(s=s.map(function(t){return F(t)})),n.push(s)}return i>t.size&&(t=t.setSize(i)),ie(t,e,n)}function ze(t){return hr>t?0:t-1>>>ar<<ar}function Ie(t){return null===t||void 0===t?De():be(t)?t:De().withMutations(function(e){var r=p(t);st(r.size),r.forEach(function(t,r){return e.set(r,t)})})}function be(t){return Tt(t)&&w(t)}function qe(t,e,r,n){var i=Object.create(Ie.prototype);return i.size=t?t.size:0,i._map=t,i._list=e,i.__ownerID=r,i.__hash=n,i}function De(){return Yr||(Yr=qe(Qt(),le()))}function Me(t,e,r){var n,i,o=t._map,u=t._list,s=o.get(e),a=void 0!==s;if(r===cr){if(!a)return t;u.size>=hr&&u.size>=2*o.size?(i=u.filter(function(t,e){return void 0!==t&&s!==e}),n=i.toKeyedSeq().map(function(t){return t[0]}).flip().toMap(),t.__ownerID&&(n.__ownerID=i.__ownerID=t.__ownerID)):(n=o.remove(e),i=s===u.size-1?u.pop():u.set(s,void 0))}else if(a){if(r===u.get(s)[1])return t;n=o,i=u.set(s,[e,r])}else n=o.set(e,u.size),i=u.set(u.size,[e,r]);return t.__ownerID?(t.size=n.size,t._map=n,t._list=i,t.__hash=void 0,t):qe(n,i)}function Ee(t){return null===t||void 0===t?ke():Oe(t)?t:ke().unshiftAll(t)}function Oe(t){return!(!t||!t[Qr])}function xe(t,e,r,n){var i=Object.create(Xr);return i.size=t,i._head=e,i.__ownerID=r,i.__hash=n,i.__altered=!1,i}function ke(){return Fr||(Fr=xe(0))}function Ae(t){return null===t||void 0===t?Ke():je(t)?t:Ke().withMutations(function(e){var r=l(t);st(r.size),r.forEach(function(t){return e.add(t)})})}function je(t){return!(!t||!t[Gr])}function Re(t,e){\nreturn t.__ownerID?(t.size=e.size,t._map=e,t):e===t._map?t:0===e.size?t.__empty():t.__make(e)}function Ue(t,e){var r=Object.create(Zr);return r.size=t?t.size:0,r._map=t,r.__ownerID=e,r}function Ke(){return $r||($r=Ue(Qt()))}function Le(t){return null===t||void 0===t?Be():Te(t)?t:Be().withMutations(function(e){var r=l(t);st(r.size),r.forEach(function(t){return e.add(t)})})}function Te(t){return je(t)&&w(t)}function We(t,e){var r=Object.create(tn);return r.size=t?t.size:0,r._map=t,r.__ownerID=e,r}function Be(){return en||(en=We(De()))}function Ce(t,e){var r,n=function(o){if(o instanceof n)return o;if(!(this instanceof n))return new n(o);if(!r){r=!0;var u=Object.keys(t);He(i,u),i.size=u.length,i._name=e,i._keys=u,i._defaultValues=t}this._map=Lt(o)},i=n.prototype=Object.create(rn);return i.constructor=n,n}function Je(t,e,r){var n=Object.create(Object.getPrototypeOf(t));return n._map=e,n.__ownerID=r,n}function Pe(t){return t._name||t.constructor.name||"Record"}function He(t,e){try{e.forEach(Ne.bind(void 0,t))}catch(r){}}function Ne(t,e){Object.defineProperty(t,e,{get:function(){return this.get(e)},set:function(t){ut(this.__ownerID,"Cannot set on an immutable record."),this.set(e,t)}})}function Ve(t,e){if(t===e)return!0;if(!y(e)||void 0!==t.size&&void 0!==e.size&&t.size!==e.size||void 0!==t.__hash&&void 0!==e.__hash&&t.__hash!==e.__hash||d(t)!==d(e)||m(t)!==m(e)||w(t)!==w(e))return!1;if(0===t.size&&0===e.size)return!0;var r=!g(t);if(w(t)){var n=t.entries();return e.every(function(t,e){var i=n.next().value;return i&&X(i[1],t)&&(r||X(i[0],e))})&&n.next().done}var i=!1;if(void 0===t.size)if(void 0===e.size)"function"==typeof t.cacheResult&&t.cacheResult();else{i=!0;var o=t;t=e,e=o}var u=!0,s=e.__iterate(function(e,n){return(r?t.has(e):i?X(e,t.get(n,cr)):X(t.get(n,cr),e))?void 0:(u=!1,!1)});return u&&t.size===s}function Ye(t,e,r){if(!(this instanceof Ye))return new Ye(t,e,r);if(ut(0!==r,"Cannot step a Range by 0"),t=t||0,void 0===e&&(e=1/0),r=void 0===r?1:Math.abs(r),t>e&&(r=-r),this._start=t,this._end=e,this._step=r,this.size=Math.max(0,Math.ceil((e-t)/r-1)+1),\n0===this.size){if(nn)return nn;nn=this}}function Qe(t,e){if(!(this instanceof Qe))return new Qe(t,e);if(this._value=t,this.size=void 0===e?1/0:Math.max(0,e),0===this.size){if(on)return on;on=this}}function Xe(t,e){var r=function(r){t.prototype[r]=e[r]};return Object.keys(e).forEach(r),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(e).forEach(r),t}function Fe(t,e){return e}function Ge(t,e){return[e,t]}function Ze(t){return function(){return!t.apply(this,arguments)}}function $e(t){return function(){return-t.apply(this,arguments)}}function tr(t){return"string"==typeof t?JSON.stringify(t):t}function er(){return i(arguments)}function rr(t,e){return e>t?1:t>e?-1:0}function nr(t){if(t.size===1/0)return 0;var e=w(t),r=d(t),n=e?1:0,i=t.__iterate(r?e?function(t,e){n=31*n+or(et(t),et(e))|0}:function(t,e){n=n+or(et(t),et(e))|0}:e?function(t){n=31*n+et(t)|0}:function(t){n=n+et(t)|0});return ir(i,n)}function ir(t,e){return e=Mr(e,3432918353),e=Mr(e<<15|e>>>-15,461845907),e=Mr(e<<13|e>>>-13,5),e=(e+3864292196|0)^t,e=Mr(e^e>>>16,2246822507),e=Mr(e^e>>>13,3266489909),e=tt(e^e>>>16)}function or(t,e){return t^e+2654435769+(t<<6)+(t>>2)|0}var ur=Array.prototype.slice,sr="delete",ar=5,hr=1<<ar,fr=hr-1,cr={},_r={value:!1},pr={value:!1};t(p,_),t(v,_),t(l,_),_.isIterable=y,_.isKeyed=d,_.isIndexed=m,_.isAssociative=g,_.isOrdered=w,_.Keyed=p,_.Indexed=v,_.Set=l;var vr="@@__IMMUTABLE_ITERABLE__@@",lr="@@__IMMUTABLE_KEYED__@@",yr="@@__IMMUTABLE_INDEXED__@@",dr="@@__IMMUTABLE_ORDERED__@@",mr=0,gr=1,wr=2,Sr="function"==typeof Symbol&&Symbol.iterator,zr="@@iterator",Ir=Sr||zr;S.prototype.toString=function(){return"[Iterator]"},S.KEYS=mr,S.VALUES=gr,S.ENTRIES=wr,S.prototype.inspect=S.prototype.toSource=function(){return""+this},S.prototype[Ir]=function(){return this},t(O,_),O.of=function(){return O(arguments)},O.prototype.toSeq=function(){return this},O.prototype.toString=function(){return this.__toString("Seq {","}")},O.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),\nthis.size=this._cache.length),this},O.prototype.__iterate=function(t,e){return P(this,t,e,!0)},O.prototype.__iterator=function(t,e){return H(this,t,e,!0)},t(x,O),x.prototype.toKeyedSeq=function(){return this},t(k,O),k.of=function(){return k(arguments)},k.prototype.toIndexedSeq=function(){return this},k.prototype.toString=function(){return this.__toString("Seq [","]")},k.prototype.__iterate=function(t,e){return P(this,t,e,!1)},k.prototype.__iterator=function(t,e){return H(this,t,e,!1)},t(A,O),A.of=function(){return A(arguments)},A.prototype.toSetSeq=function(){return this},O.isSeq=L,O.Keyed=x,O.Set=A,O.Indexed=k;var br="@@__IMMUTABLE_SEQ__@@";O.prototype[br]=!0,t(j,k),j.prototype.get=function(t,e){return this.has(t)?this._array[u(this,t)]:e},j.prototype.__iterate=function(t,e){for(var r=this._array,n=r.length-1,i=0;n>=i;i++)if(t(r[e?n-i:i],i,this)===!1)return i+1;return i},j.prototype.__iterator=function(t,e){var r=this._array,n=r.length-1,i=0;return new S(function(){return i>n?I():z(t,i,r[e?n-i++:i++])})},t(R,x),R.prototype.get=function(t,e){return void 0===e||this.has(t)?this._object[t]:e},R.prototype.has=function(t){return this._object.hasOwnProperty(t)},R.prototype.__iterate=function(t,e){for(var r=this._object,n=this._keys,i=n.length-1,o=0;i>=o;o++){var u=n[e?i-o:o];if(t(r[u],u,this)===!1)return o+1}return o},R.prototype.__iterator=function(t,e){var r=this._object,n=this._keys,i=n.length-1,o=0;return new S(function(){var u=n[e?i-o:o];return o++>i?I():z(t,u,r[u])})},R.prototype[dr]=!0,t(U,k),U.prototype.__iterateUncached=function(t,e){if(e)return this.cacheResult().__iterate(t,e);var r=this._iterable,n=D(r),i=0;if(q(n))for(var o;!(o=n.next()).done&&t(o.value,i++,this)!==!1;);return i},U.prototype.__iteratorUncached=function(t,e){if(e)return this.cacheResult().__iterator(t,e);var r=this._iterable,n=D(r);if(!q(n))return new S(I);var i=0;return new S(function(){var e=n.next();return e.done?e:z(t,i++,e.value)})},t(K,k),K.prototype.__iterateUncached=function(t,e){if(e)return this.cacheResult().__iterate(t,e);for(var r=this._iterator,n=this._iteratorCache,i=0;n.length>i;)if(t(n[i],i++,this)===!1)return i;for(var o;!(o=r.next()).done;){var u=o.value;if(n[i]=u,t(u,i++,this)===!1)break}return i},K.prototype.__iteratorUncached=function(t,e){if(e)return this.cacheResult().__iterator(t,e);var r=this._iterator,n=this._iteratorCache,i=0;return new S(function(){if(i>=n.length){var e=r.next();if(e.done)return e;n[i]=e.value}return z(t,i,n[i++])})};var qr;t(N,_),t(V,N),t(Y,N),t(Q,N),N.Keyed=V,N.Indexed=Y,N.Set=Q;var Dr,Mr="function"==typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function(t,e){t=0|t,e=0|e;var r=65535&t,n=65535&e;return r*n+((t>>>16)*n+r*(e>>>16)<<16>>>0)|0},Er=Object.isExtensible,Or=function(){try{return Object.defineProperty({},"@",{}),!0}catch(t){return!1}}(),xr="function"==typeof WeakMap;xr&&(Dr=new WeakMap);var kr=0,Ar="__immutablehash__";"function"==typeof Symbol&&(Ar=Symbol(Ar));var jr=16,Rr=255,Ur=0,Kr={};t(at,x),at.prototype.get=function(t,e){return this._iter.get(t,e)},at.prototype.has=function(t){return this._iter.has(t)},at.prototype.valueSeq=function(){return this._iter.valueSeq()},at.prototype.reverse=function(){var t=this,e=vt(this,!0);return this._useKeys||(e.valueSeq=function(){return t._iter.toSeq().reverse()}),e},at.prototype.map=function(t,e){var r=this,n=pt(this,t,e);return this._useKeys||(n.valueSeq=function(){return r._iter.toSeq().map(t,e)}),n},at.prototype.__iterate=function(t,e){var r,n=this;return this._iter.__iterate(this._useKeys?function(e,r){return t(e,r,n)}:(r=e?kt(this):0,function(i){return t(i,e?--r:r++,n)}),e)},at.prototype.__iterator=function(t,e){if(this._useKeys)return this._iter.__iterator(t,e);var r=this._iter.__iterator(gr,e),n=e?kt(this):0;return new S(function(){var i=r.next();return i.done?i:z(t,e?--n:n++,i.value,i)})},at.prototype[dr]=!0,t(ht,k),ht.prototype.includes=function(t){return this._iter.includes(t)},ht.prototype.__iterate=function(t,e){var r=this,n=0;return this._iter.__iterate(function(e){return t(e,n++,r)},e)},ht.prototype.__iterator=function(t,e){var r=this._iter.__iterator(gr,e),n=0;return new S(function(){var e=r.next();return e.done?e:z(t,n++,e.value,e);})},t(ft,A),ft.prototype.has=function(t){return this._iter.includes(t)},ft.prototype.__iterate=function(t,e){var r=this;return this._iter.__iterate(function(e){return t(e,e,r)},e)},ft.prototype.__iterator=function(t,e){var r=this._iter.__iterator(gr,e);return new S(function(){var e=r.next();return e.done?e:z(t,e.value,e.value,e)})},t(ct,x),ct.prototype.entrySeq=function(){return this._iter.toSeq()},ct.prototype.__iterate=function(t,e){var r=this;return this._iter.__iterate(function(e){if(e){xt(e);var n=y(e);return t(n?e.get(1):e[1],n?e.get(0):e[0],r)}},e)},ct.prototype.__iterator=function(t,e){var r=this._iter.__iterator(gr,e);return new S(function(){for(;;){var e=r.next();if(e.done)return e;var n=e.value;if(n){xt(n);var i=y(n);return z(t,i?n.get(0):n[0],i?n.get(1):n[1],e)}}})},ht.prototype.cacheResult=at.prototype.cacheResult=ft.prototype.cacheResult=ct.prototype.cacheResult=Rt,t(Lt,V),Lt.prototype.toString=function(){return this.__toString("Map {","}")},Lt.prototype.get=function(t,e){return this._root?this._root.get(0,void 0,t,e):e},Lt.prototype.set=function(t,e){return Xt(this,t,e)},Lt.prototype.setIn=function(t,e){return this.updateIn(t,cr,function(){return e})},Lt.prototype.remove=function(t){return Xt(this,t,cr)},Lt.prototype.deleteIn=function(t){return this.updateIn(t,function(){return cr})},Lt.prototype.update=function(t,e,r){return 1===arguments.length?t(this):this.updateIn([t],e,r)},Lt.prototype.updateIn=function(t,e,r){r||(r=e,e=void 0);var n=oe(this,Kt(t),e,r);return n===cr?void 0:n},Lt.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Qt()},Lt.prototype.merge=function(){return re(this,void 0,arguments)},Lt.prototype.mergeWith=function(t){var e=ur.call(arguments,1);return re(this,t,e)},Lt.prototype.mergeIn=function(t){var e=ur.call(arguments,1);return this.updateIn(t,Qt(),function(t){return t.merge.apply(t,e)})},Lt.prototype.mergeDeep=function(){return re(this,ne(void 0),arguments)},Lt.prototype.mergeDeepWith=function(t){\nvar e=ur.call(arguments,1);return re(this,ne(t),e)},Lt.prototype.mergeDeepIn=function(t){var e=ur.call(arguments,1);return this.updateIn(t,Qt(),function(t){return t.mergeDeep.apply(t,e)})},Lt.prototype.sort=function(t){return Ie(qt(this,t))},Lt.prototype.sortBy=function(t,e){return Ie(qt(this,e,t))},Lt.prototype.withMutations=function(t){var e=this.asMutable();return t(e),e.wasAltered()?e.__ensureOwner(this.__ownerID):this},Lt.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new n)},Lt.prototype.asImmutable=function(){return this.__ensureOwner()},Lt.prototype.wasAltered=function(){return this.__altered},Lt.prototype.__iterator=function(t,e){return new Ht(this,t,e)},Lt.prototype.__iterate=function(t,e){var r=this,n=0;return this._root&&this._root.iterate(function(e){return n++,t(e[1],e[0],r)},e),n},Lt.prototype.__ensureOwner=function(t){return t===this.__ownerID?this:t?Yt(this.size,this._root,t,this.__hash):(this.__ownerID=t,this.__altered=!1,this)},Lt.isMap=Tt;var Lr="@@__IMMUTABLE_MAP__@@",Tr=Lt.prototype;Tr[Lr]=!0,Tr[sr]=Tr.remove,Tr.removeIn=Tr.deleteIn,Wt.prototype.get=function(t,e,r,n){for(var i=this.entries,o=0,u=i.length;u>o;o++)if(X(r,i[o][0]))return i[o][1];return n},Wt.prototype.update=function(t,e,n,o,u,s,a){for(var h=u===cr,f=this.entries,c=0,_=f.length;_>c&&!X(o,f[c][0]);c++);var p=_>c;if(p?f[c][1]===u:h)return this;if(r(a),(h||!p)&&r(s),!h||1!==f.length){if(!p&&!h&&f.length>=Br)return $t(t,f,o,u);var v=t&&t===this.ownerID,l=v?f:i(f);return p?h?c===_-1?l.pop():l[c]=l.pop():l[c]=[o,u]:l.push([o,u]),v?(this.entries=l,this):new Wt(t,l)}},Bt.prototype.get=function(t,e,r,n){void 0===e&&(e=et(r));var i=1<<((0===t?e:e>>>t)&fr),o=this.bitmap;return 0===(o&i)?n:this.nodes[ue(o&i-1)].get(t+ar,e,r,n)},Bt.prototype.update=function(t,e,r,n,i,o,u){void 0===r&&(r=et(n));var s=(0===e?r:r>>>e)&fr,a=1<<s,h=this.bitmap,f=0!==(h&a);if(!f&&i===cr)return this;var c=ue(h&a-1),_=this.nodes,p=f?_[c]:void 0,v=Ft(p,t,e+ar,r,n,i,o,u);if(v===p)return this;if(!f&&v&&_.length>=Cr)return ee(t,_,h,s,v);if(f&&!v&&2===_.length&&Gt(_[1^c]))return _[1^c];if(f&&v&&1===_.length&&Gt(v))return v;var l=t&&t===this.ownerID,y=f?v?h:h^a:h|a,d=f?v?se(_,c,v,l):he(_,c,l):ae(_,c,v,l);return l?(this.bitmap=y,this.nodes=d,this):new Bt(t,y,d)},Ct.prototype.get=function(t,e,r,n){void 0===e&&(e=et(r));var i=(0===t?e:e>>>t)&fr,o=this.nodes[i];return o?o.get(t+ar,e,r,n):n},Ct.prototype.update=function(t,e,r,n,i,o,u){void 0===r&&(r=et(n));var s=(0===e?r:r>>>e)&fr,a=i===cr,h=this.nodes,f=h[s];if(a&&!f)return this;var c=Ft(f,t,e+ar,r,n,i,o,u);if(c===f)return this;var _=this.count;if(f){if(!c&&(_--,Jr>_))return te(t,h,_,s)}else _++;var p=t&&t===this.ownerID,v=se(h,s,c,p);return p?(this.count=_,this.nodes=v,this):new Ct(t,_,v)},Jt.prototype.get=function(t,e,r,n){for(var i=this.entries,o=0,u=i.length;u>o;o++)if(X(r,i[o][0]))return i[o][1];return n},Jt.prototype.update=function(t,e,n,o,u,s,a){void 0===n&&(n=et(o));var h=u===cr;if(n!==this.keyHash)return h?this:(r(a),r(s),Zt(this,t,e,n,[o,u]));for(var f=this.entries,c=0,_=f.length;_>c&&!X(o,f[c][0]);c++);var p=_>c;if(p?f[c][1]===u:h)return this;if(r(a),(h||!p)&&r(s),h&&2===_)return new Pt(t,this.keyHash,f[1^c]);var v=t&&t===this.ownerID,l=v?f:i(f);return p?h?c===_-1?l.pop():l[c]=l.pop():l[c]=[o,u]:l.push([o,u]),v?(this.entries=l,this):new Jt(t,this.keyHash,l)},Pt.prototype.get=function(t,e,r,n){return X(r,this.entry[0])?this.entry[1]:n},Pt.prototype.update=function(t,e,n,i,o,u,s){var a=o===cr,h=X(i,this.entry[0]);return(h?o===this.entry[1]:a)?this:(r(s),a?void r(u):h?t&&t===this.ownerID?(this.entry[1]=o,this):new Pt(t,this.keyHash,[i,o]):(r(u),Zt(this,t,e,et(i),[i,o])))},Wt.prototype.iterate=Jt.prototype.iterate=function(t,e){for(var r=this.entries,n=0,i=r.length-1;i>=n;n++)if(t(r[e?i-n:n])===!1)return!1},Bt.prototype.iterate=Ct.prototype.iterate=function(t,e){for(var r=this.nodes,n=0,i=r.length-1;i>=n;n++){var o=r[e?i-n:n];if(o&&o.iterate(t,e)===!1)return!1}},Pt.prototype.iterate=function(t){return t(this.entry)},t(Ht,S),Ht.prototype.next=function(){for(var t=this._type,e=this._stack;e;){var r,n=e.node,i=e.index++;if(n.entry){if(0===i)return Nt(t,n.entry);}else if(n.entries){if(r=n.entries.length-1,r>=i)return Nt(t,n.entries[this._reverse?r-i:i])}else if(r=n.nodes.length-1,r>=i){var o=n.nodes[this._reverse?r-i:i];if(o){if(o.entry)return Nt(t,o.entry);e=this._stack=Vt(o,e)}continue}e=this._stack=this._stack.__prev}return I()};var Wr,Br=hr/4,Cr=hr/2,Jr=hr/4;t(fe,Y),fe.of=function(){return this(arguments)},fe.prototype.toString=function(){return this.__toString("List [","]")},fe.prototype.get=function(t,e){if(t=u(this,t),0>t||t>=this.size)return e;t+=this._origin;var r=ge(this,t);return r&&r.array[t&fr]},fe.prototype.set=function(t,e){return ye(this,t,e)},fe.prototype.remove=function(t){return this.has(t)?0===t?this.shift():t===this.size-1?this.pop():this.splice(t,1):this},fe.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=ar,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):le()},fe.prototype.push=function(){var t=arguments,e=this.size;return this.withMutations(function(r){we(r,0,e+t.length);for(var n=0;t.length>n;n++)r.set(e+n,t[n])})},fe.prototype.pop=function(){return we(this,0,-1)},fe.prototype.unshift=function(){var t=arguments;return this.withMutations(function(e){we(e,-t.length);for(var r=0;t.length>r;r++)e.set(r,t[r])})},fe.prototype.shift=function(){return we(this,1)},fe.prototype.merge=function(){return Se(this,void 0,arguments)},fe.prototype.mergeWith=function(t){var e=ur.call(arguments,1);return Se(this,t,e)},fe.prototype.mergeDeep=function(){return Se(this,ne(void 0),arguments)},fe.prototype.mergeDeepWith=function(t){var e=ur.call(arguments,1);return Se(this,ne(t),e)},fe.prototype.setSize=function(t){return we(this,0,t)},fe.prototype.slice=function(t,e){var r=this.size;return a(t,e,r)?this:we(this,h(t,r),f(e,r))},fe.prototype.__iterator=function(t,e){var r=0,n=pe(this,e);return new S(function(){var e=n();return e===Vr?I():z(t,r++,e)})},fe.prototype.__iterate=function(t,e){for(var r,n=0,i=pe(this,e);(r=i())!==Vr&&t(r,n++,this)!==!1;);return n},fe.prototype.__ensureOwner=function(t){\nreturn t===this.__ownerID?this:t?ve(this._origin,this._capacity,this._level,this._root,this._tail,t,this.__hash):(this.__ownerID=t,this)},fe.isList=ce;var Pr="@@__IMMUTABLE_LIST__@@",Hr=fe.prototype;Hr[Pr]=!0,Hr[sr]=Hr.remove,Hr.setIn=Tr.setIn,Hr.deleteIn=Hr.removeIn=Tr.removeIn,Hr.update=Tr.update,Hr.updateIn=Tr.updateIn,Hr.mergeIn=Tr.mergeIn,Hr.mergeDeepIn=Tr.mergeDeepIn,Hr.withMutations=Tr.withMutations,Hr.asMutable=Tr.asMutable,Hr.asImmutable=Tr.asImmutable,Hr.wasAltered=Tr.wasAltered,_e.prototype.removeBefore=function(t,e,r){if(r===e?1<<e:0||0===this.array.length)return this;var n=r>>>e&fr;if(n>=this.array.length)return new _e([],t);var i,o=0===n;if(e>0){var u=this.array[n];if(i=u&&u.removeBefore(t,e-ar,r),i===u&&o)return this}if(o&&!i)return this;var s=me(this,t);if(!o)for(var a=0;n>a;a++)s.array[a]=void 0;return i&&(s.array[n]=i),s},_e.prototype.removeAfter=function(t,e,r){if(r===e?1<<e:0||0===this.array.length)return this;var n=r-1>>>e&fr;if(n>=this.array.length)return this;var i,o=n===this.array.length-1;if(e>0){var u=this.array[n];if(i=u&&u.removeAfter(t,e-ar,r),i===u&&o)return this}if(o&&!i)return this;var s=me(this,t);return o||s.array.pop(),i&&(s.array[n]=i),s};var Nr,Vr={};t(Ie,Lt),Ie.of=function(){return this(arguments)},Ie.prototype.toString=function(){return this.__toString("OrderedMap {","}")},Ie.prototype.get=function(t,e){var r=this._map.get(t);return void 0!==r?this._list.get(r)[1]:e},Ie.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):De()},Ie.prototype.set=function(t,e){return Me(this,t,e)},Ie.prototype.remove=function(t){return Me(this,t,cr)},Ie.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},Ie.prototype.__iterate=function(t,e){var r=this;return this._list.__iterate(function(e){return e&&t(e[1],e[0],r)},e)},Ie.prototype.__iterator=function(t,e){return this._list.fromEntrySeq().__iterator(t,e)},Ie.prototype.__ensureOwner=function(t){if(t===this.__ownerID)return this;var e=this._map.__ensureOwner(t),r=this._list.__ensureOwner(t);return t?qe(e,r,t,this.__hash):(this.__ownerID=t,this._map=e,this._list=r,this)},Ie.isOrderedMap=be,Ie.prototype[dr]=!0,Ie.prototype[sr]=Ie.prototype.remove;var Yr;t(Ee,Y),Ee.of=function(){return this(arguments)},Ee.prototype.toString=function(){return this.__toString("Stack [","]")},Ee.prototype.get=function(t,e){var r=this._head;for(t=u(this,t);r&&t--;)r=r.next;return r?r.value:e},Ee.prototype.peek=function(){return this._head&&this._head.value},Ee.prototype.push=function(){if(0===arguments.length)return this;for(var t=this.size+arguments.length,e=this._head,r=arguments.length-1;r>=0;r--)e={value:arguments[r],next:e};return this.__ownerID?(this.size=t,this._head=e,this.__hash=void 0,this.__altered=!0,this):xe(t,e)},Ee.prototype.pushAll=function(t){if(t=v(t),0===t.size)return this;st(t.size);var e=this.size,r=this._head;return t.reverse().forEach(function(t){e++,r={value:t,next:r}}),this.__ownerID?(this.size=e,this._head=r,this.__hash=void 0,this.__altered=!0,this):xe(e,r)},Ee.prototype.pop=function(){return this.slice(1)},Ee.prototype.unshift=function(){return this.push.apply(this,arguments)},Ee.prototype.unshiftAll=function(t){return this.pushAll(t)},Ee.prototype.shift=function(){return this.pop.apply(this,arguments)},Ee.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):ke()},Ee.prototype.slice=function(t,e){if(a(t,e,this.size))return this;var r=h(t,this.size),n=f(e,this.size);if(n!==this.size)return Y.prototype.slice.call(this,t,e);for(var i=this.size-r,o=this._head;r--;)o=o.next;return this.__ownerID?(this.size=i,this._head=o,this.__hash=void 0,this.__altered=!0,this):xe(i,o)},Ee.prototype.__ensureOwner=function(t){return t===this.__ownerID?this:t?xe(this.size,this._head,t,this.__hash):(this.__ownerID=t,this.__altered=!1,this)},Ee.prototype.__iterate=function(t,e){if(e)return this.reverse().__iterate(t);for(var r=0,n=this._head;n&&t(n.value,r++,this)!==!1;)n=n.next;return r},Ee.prototype.__iterator=function(t,e){if(e)return this.reverse().__iterator(t);var r=0,n=this._head;return new S(function(){if(n){var e=n.value;return n=n.next,z(t,r++,e)}return I()})},Ee.isStack=Oe;var Qr="@@__IMMUTABLE_STACK__@@",Xr=Ee.prototype;Xr[Qr]=!0,Xr.withMutations=Tr.withMutations,Xr.asMutable=Tr.asMutable,Xr.asImmutable=Tr.asImmutable,Xr.wasAltered=Tr.wasAltered;var Fr;t(Ae,Q),Ae.of=function(){return this(arguments)},Ae.fromKeys=function(t){return this(p(t).keySeq())},Ae.prototype.toString=function(){return this.__toString("Set {","}")},Ae.prototype.has=function(t){return this._map.has(t)},Ae.prototype.add=function(t){return Re(this,this._map.set(t,!0))},Ae.prototype.remove=function(t){return Re(this,this._map.remove(t))},Ae.prototype.clear=function(){return Re(this,this._map.clear())},Ae.prototype.union=function(){var t=ur.call(arguments,0);return t=t.filter(function(t){return 0!==t.size}),0===t.length?this:0!==this.size||this.__ownerID||1!==t.length?this.withMutations(function(e){for(var r=0;t.length>r;r++)l(t[r]).forEach(function(t){return e.add(t)})}):this.constructor(t[0])},Ae.prototype.intersect=function(){var t=ur.call(arguments,0);if(0===t.length)return this;t=t.map(function(t){return l(t)});var e=this;return this.withMutations(function(r){e.forEach(function(e){t.every(function(t){return t.includes(e)})||r.remove(e)})})},Ae.prototype.subtract=function(){var t=ur.call(arguments,0);if(0===t.length)return this;t=t.map(function(t){return l(t)});var e=this;return this.withMutations(function(r){e.forEach(function(e){t.some(function(t){return t.includes(e)})&&r.remove(e)})})},Ae.prototype.merge=function(){return this.union.apply(this,arguments)},Ae.prototype.mergeWith=function(){var t=ur.call(arguments,1);return this.union.apply(this,t)},Ae.prototype.sort=function(t){return Le(qt(this,t))},Ae.prototype.sortBy=function(t,e){return Le(qt(this,e,t))},Ae.prototype.wasAltered=function(){return this._map.wasAltered()},Ae.prototype.__iterate=function(t,e){var r=this;return this._map.__iterate(function(e,n){return t(n,n,r)},e)},Ae.prototype.__iterator=function(t,e){return this._map.map(function(t,e){\nreturn e}).__iterator(t,e)},Ae.prototype.__ensureOwner=function(t){if(t===this.__ownerID)return this;var e=this._map.__ensureOwner(t);return t?this.__make(e,t):(this.__ownerID=t,this._map=e,this)},Ae.isSet=je;var Gr="@@__IMMUTABLE_SET__@@",Zr=Ae.prototype;Zr[Gr]=!0,Zr[sr]=Zr.remove,Zr.mergeDeep=Zr.merge,Zr.mergeDeepWith=Zr.mergeWith,Zr.withMutations=Tr.withMutations,Zr.asMutable=Tr.asMutable,Zr.asImmutable=Tr.asImmutable,Zr.__empty=Ke,Zr.__make=Ue;var $r;t(Le,Ae),Le.of=function(){return this(arguments)},Le.fromKeys=function(t){return this(p(t).keySeq())},Le.prototype.toString=function(){return this.__toString("OrderedSet {","}")},Le.isOrderedSet=Te;var tn=Le.prototype;tn[dr]=!0,tn.__empty=Be,tn.__make=We;var en;t(Ce,V),Ce.prototype.toString=function(){return this.__toString(Pe(this)+" {","}")},Ce.prototype.has=function(t){return this._defaultValues.hasOwnProperty(t)},Ce.prototype.get=function(t,e){if(!this.has(t))return e;var r=this._defaultValues[t];return this._map?this._map.get(t,r):r},Ce.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var t=this.constructor;return t._empty||(t._empty=Je(this,Qt()))},Ce.prototype.set=function(t,e){if(!this.has(t))throw Error(\'Cannot set unknown key "\'+t+\'" on \'+Pe(this));var r=this._map&&this._map.set(t,e);return this.__ownerID||r===this._map?this:Je(this,r)},Ce.prototype.remove=function(t){if(!this.has(t))return this;var e=this._map&&this._map.remove(t);return this.__ownerID||e===this._map?this:Je(this,e)},Ce.prototype.wasAltered=function(){return this._map.wasAltered()},Ce.prototype.__iterator=function(t,e){var r=this;return p(this._defaultValues).map(function(t,e){return r.get(e)}).__iterator(t,e)},Ce.prototype.__iterate=function(t,e){var r=this;return p(this._defaultValues).map(function(t,e){return r.get(e)}).__iterate(t,e)},Ce.prototype.__ensureOwner=function(t){if(t===this.__ownerID)return this;var e=this._map&&this._map.__ensureOwner(t);return t?Je(this,e,t):(this.__ownerID=t,this._map=e,this)};var rn=Ce.prototype;rn[sr]=rn.remove,rn.deleteIn=rn.removeIn=Tr.removeIn,\nrn.merge=Tr.merge,rn.mergeWith=Tr.mergeWith,rn.mergeIn=Tr.mergeIn,rn.mergeDeep=Tr.mergeDeep,rn.mergeDeepWith=Tr.mergeDeepWith,rn.mergeDeepIn=Tr.mergeDeepIn,rn.setIn=Tr.setIn,rn.update=Tr.update,rn.updateIn=Tr.updateIn,rn.withMutations=Tr.withMutations,rn.asMutable=Tr.asMutable,rn.asImmutable=Tr.asImmutable,t(Ye,k),Ye.prototype.toString=function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(this._step>1?" by "+this._step:"")+" ]"},Ye.prototype.get=function(t,e){return this.has(t)?this._start+u(this,t)*this._step:e},Ye.prototype.includes=function(t){var e=(t-this._start)/this._step;return e>=0&&this.size>e&&e===Math.floor(e)},Ye.prototype.slice=function(t,e){return a(t,e,this.size)?this:(t=h(t,this.size),e=f(e,this.size),t>=e?new Ye(0,0):new Ye(this.get(t,this._end),this.get(e,this._end),this._step))},Ye.prototype.indexOf=function(t){var e=t-this._start;if(e%this._step===0){var r=e/this._step;if(r>=0&&this.size>r)return r}return-1},Ye.prototype.lastIndexOf=function(t){return this.indexOf(t)},Ye.prototype.__iterate=function(t,e){for(var r=this.size-1,n=this._step,i=e?this._start+r*n:this._start,o=0;r>=o;o++){if(t(i,o,this)===!1)return o+1;i+=e?-n:n}return o},Ye.prototype.__iterator=function(t,e){var r=this.size-1,n=this._step,i=e?this._start+r*n:this._start,o=0;return new S(function(){var u=i;return i+=e?-n:n,o>r?I():z(t,o++,u)})},Ye.prototype.equals=function(t){return t instanceof Ye?this._start===t._start&&this._end===t._end&&this._step===t._step:Ve(this,t)};var nn;t(Qe,k),Qe.prototype.toString=function(){return 0===this.size?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},Qe.prototype.get=function(t,e){return this.has(t)?this._value:e},Qe.prototype.includes=function(t){return X(this._value,t)},Qe.prototype.slice=function(t,e){var r=this.size;return a(t,e,r)?this:new Qe(this._value,f(e,r)-h(t,r))},Qe.prototype.reverse=function(){return this},Qe.prototype.indexOf=function(t){return X(this._value,t)?0:-1},Qe.prototype.lastIndexOf=function(t){return X(this._value,t)?this.size:-1;},Qe.prototype.__iterate=function(t){for(var e=0;this.size>e;e++)if(t(this._value,e,this)===!1)return e+1;return e},Qe.prototype.__iterator=function(t){var e=this,r=0;return new S(function(){return e.size>r?z(t,r++,e._value):I()})},Qe.prototype.equals=function(t){return t instanceof Qe?X(this._value,t._value):Ve(t)};var on;_.Iterator=S,Xe(_,{toArray:function(){st(this.size);var t=Array(this.size||0);return this.valueSeq().__iterate(function(e,r){t[r]=e}),t},toIndexedSeq:function(){return new ht(this)},toJS:function(){return this.toSeq().map(function(t){return t&&"function"==typeof t.toJS?t.toJS():t}).__toJS()},toJSON:function(){return this.toSeq().map(function(t){return t&&"function"==typeof t.toJSON?t.toJSON():t}).__toJS()},toKeyedSeq:function(){return new at(this,!0)},toMap:function(){return Lt(this.toKeyedSeq())},toObject:function(){st(this.size);var t={};return this.__iterate(function(e,r){t[r]=e}),t},toOrderedMap:function(){return Ie(this.toKeyedSeq())},toOrderedSet:function(){return Le(d(this)?this.valueSeq():this)},toSet:function(){return Ae(d(this)?this.valueSeq():this)},toSetSeq:function(){return new ft(this)},toSeq:function(){return m(this)?this.toIndexedSeq():d(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Ee(d(this)?this.valueSeq():this)},toList:function(){return fe(d(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(t,e){return 0===this.size?t+e:t+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+e},concat:function(){var t=ur.call(arguments,0);return Ot(this,St(this,t))},contains:function(t){return this.includes(t)},includes:function(t){return this.some(function(e){return X(e,t)})},entries:function(){return this.__iterator(wr)},every:function(t,e){st(this.size);var r=!0;return this.__iterate(function(n,i,o){return t.call(e,n,i,o)?void 0:(r=!1,!1)}),r},filter:function(t,e){return Ot(this,lt(this,t,e,!0))},find:function(t,e,r){var n=this.findEntry(t,e);return n?n[1]:r},findEntry:function(t,e){var r;return this.__iterate(function(n,i,o){\nreturn t.call(e,n,i,o)?(r=[i,n],!1):void 0}),r},findLastEntry:function(t,e){return this.toSeq().reverse().findEntry(t,e)},forEach:function(t,e){return st(this.size),this.__iterate(e?t.bind(e):t)},join:function(t){st(this.size),t=void 0!==t?""+t:",";var e="",r=!0;return this.__iterate(function(n){r?r=!1:e+=t,e+=null!==n&&void 0!==n?""+n:""}),e},keys:function(){return this.__iterator(mr)},map:function(t,e){return Ot(this,pt(this,t,e))},reduce:function(t,e,r){st(this.size);var n,i;return arguments.length<2?i=!0:n=e,this.__iterate(function(e,o,u){i?(i=!1,n=e):n=t.call(r,n,e,o,u)}),n},reduceRight:function(){var t=this.toKeyedSeq().reverse();return t.reduce.apply(t,arguments)},reverse:function(){return Ot(this,vt(this,!0))},slice:function(t,e){return Ot(this,mt(this,t,e,!0))},some:function(t,e){return!this.every(Ze(t),e)},sort:function(t){return Ot(this,qt(this,t))},values:function(){return this.__iterator(gr)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return void 0!==this.size?0===this.size:!this.some(function(){return!0})},count:function(t,e){return o(t?this.toSeq().filter(t,e):this)},countBy:function(t,e){return yt(this,t,e)},equals:function(t){return Ve(this,t)},entrySeq:function(){var t=this;if(t._cache)return new j(t._cache);var e=t.toSeq().map(Ge).toIndexedSeq();return e.fromEntrySeq=function(){return t.toSeq()},e},filterNot:function(t,e){return this.filter(Ze(t),e)},findLast:function(t,e,r){return this.toKeyedSeq().reverse().find(t,e,r)},first:function(){return this.find(s)},flatMap:function(t,e){return Ot(this,It(this,t,e))},flatten:function(t){return Ot(this,zt(this,t,!0))},fromEntrySeq:function(){return new ct(this)},get:function(t,e){return this.find(function(e,r){return X(r,t)},void 0,e)},getIn:function(t,e){for(var r,n=this,i=Kt(t);!(r=i.next()).done;){var o=r.value;if(n=n&&n.get?n.get(o,cr):cr,n===cr)return e}return n},groupBy:function(t,e){return dt(this,t,e)},has:function(t){return this.get(t,cr)!==cr},hasIn:function(t){return this.getIn(t,cr)!==cr},isSubset:function(t){return t="function"==typeof t.includes?t:_(t),\nthis.every(function(e){return t.includes(e)})},isSuperset:function(t){return t.isSubset(this)},keySeq:function(){return this.toSeq().map(Fe).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},max:function(t){return Dt(this,t)},maxBy:function(t,e){return Dt(this,e,t)},min:function(t){return Dt(this,t?$e(t):rr)},minBy:function(t,e){return Dt(this,e?$e(e):rr,t)},rest:function(){return this.slice(1)},skip:function(t){return this.slice(Math.max(0,t))},skipLast:function(t){return Ot(this,this.toSeq().reverse().skip(t).reverse())},skipWhile:function(t,e){return Ot(this,wt(this,t,e,!0))},skipUntil:function(t,e){return this.skipWhile(Ze(t),e)},sortBy:function(t,e){return Ot(this,qt(this,e,t))},take:function(t){return this.slice(0,Math.max(0,t))},takeLast:function(t){return Ot(this,this.toSeq().reverse().take(t).reverse())},takeWhile:function(t,e){return Ot(this,gt(this,t,e))},takeUntil:function(t,e){return this.takeWhile(Ze(t),e)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=nr(this))}});var un=_.prototype;un[vr]=!0,un[Ir]=un.values,un.__toJS=un.toArray,un.__toStringMapper=tr,un.inspect=un.toSource=function(){return""+this},un.chain=un.flatMap,function(){try{Object.defineProperty(un,"length",{get:function(){if(!_.noLengthWarning){var t;try{throw Error()}catch(e){t=e.stack}if(-1===t.indexOf("_wrapObject"))return console&&console.warn&&console.warn("iterable.length has been deprecated, use iterable.size or iterable.count(). This warning will become a silent error in a future version. "+t),this.size}}})}catch(t){}}(),Xe(p,{flip:function(){return Ot(this,_t(this))},findKey:function(t,e){var r=this.findEntry(t,e);return r&&r[0]},findLastKey:function(t,e){return this.toSeq().reverse().findKey(t,e)},keyOf:function(t){return this.findKey(function(e){return X(e,t)})},lastKeyOf:function(t){return this.findLastKey(function(e){return X(e,t)})},mapEntries:function(t,e){var r=this,n=0;return Ot(this,this.toSeq().map(function(i,o){return t.call(e,[o,i],n++,r)}).fromEntrySeq());},mapKeys:function(t,e){var r=this;return Ot(this,this.toSeq().flip().map(function(n,i){return t.call(e,n,i,r)}).flip())}});var sn=p.prototype;sn[lr]=!0,sn[Ir]=un.entries,sn.__toJS=un.toObject,sn.__toStringMapper=function(t,e){return JSON.stringify(e)+": "+tr(t)},Xe(v,{toKeyedSeq:function(){return new at(this,!1)},filter:function(t,e){return Ot(this,lt(this,t,e,!1))},findIndex:function(t,e){var r=this.findEntry(t,e);return r?r[0]:-1},indexOf:function(t){var e=this.toKeyedSeq().keyOf(t);return void 0===e?-1:e},lastIndexOf:function(t){return this.toSeq().reverse().indexOf(t)},reverse:function(){return Ot(this,vt(this,!1))},slice:function(t,e){return Ot(this,mt(this,t,e,!1))},splice:function(t,e){var r=arguments.length;if(e=Math.max(0|e,0),0===r||2===r&&!e)return this;t=h(t,this.size);var n=this.slice(0,t);return Ot(this,1===r?n:n.concat(i(arguments,2),this.slice(t+e)))},findLastIndex:function(t,e){var r=this.toKeyedSeq().findLastKey(t,e);return void 0===r?-1:r},first:function(){return this.get(0)},flatten:function(t){return Ot(this,zt(this,t,!1))},get:function(t,e){return t=u(this,t),0>t||this.size===1/0||void 0!==this.size&&t>this.size?e:this.find(function(e,r){return r===t},void 0,e)},has:function(t){return t=u(this,t),t>=0&&(void 0!==this.size?this.size===1/0||this.size>t:-1!==this.indexOf(t))},interpose:function(t){return Ot(this,bt(this,t))},interleave:function(){var t=[this].concat(i(arguments)),e=Et(this.toSeq(),k.of,t),r=e.flatten(!0);return e.size&&(r.size=e.size*t.length),Ot(this,r)},last:function(){return this.get(-1)},skipWhile:function(t,e){return Ot(this,wt(this,t,e,!1))},zip:function(){var t=[this].concat(i(arguments));return Ot(this,Et(this,er,t))},zipWith:function(t){var e=i(arguments);return e[0]=this,Ot(this,Et(this,t,e))}}),v.prototype[yr]=!0,v.prototype[dr]=!0,Xe(l,{get:function(t,e){return this.has(t)?t:e},includes:function(t){return this.has(t)},keySeq:function(){return this.valueSeq()}}),l.prototype.has=un.includes,Xe(x,p.prototype),Xe(k,v.prototype),Xe(A,l.prototype),Xe(V,p.prototype),Xe(Y,v.prototype),\nXe(Q,l.prototype);var an={Iterable:_,Seq:O,Collection:N,Map:Lt,OrderedMap:Ie,List:fe,Stack:Ee,Set:Ae,OrderedSet:Le,Record:Ce,Range:Ye,Repeat:Qe,is:X,fromJS:F};return an});',eval(immutable),reservedInJs=newSetWith.apply(null,"abstract arguments boolean break byte case catch char class const continue debugger default delete do double else enum eval export extends final finally float for function goto if implements import in instanceof int interface let long native new null package private protected public return short static super switch synchronized this throw throws transient try typeof var void volatile while with yield".split(" ")),compiledModules=newMap(),moduleGraph=newMap(),lookupCompiledModule=function(e){return lookupInMap(compiledModules,e)
},compileTopLevel=function(e,t,n){var r,i,o,s,a,l,c,u,h,d,p;null==t&&(t="@unnamed"),null==n&&(n=newMap()),addToMap(n,"Prelude",!0),removeFromMap(n,t);for(h in values(n))if(!lookupCompiledModule(h))return{request:h};if(replaceOrAddToMap(moduleGraph,t,{requires:n}),d=requiresFor(t),o=injectedContext(d),s=importsFor(subtractSets(newSetWith("Prelude"),newSetWith(t))),declareImportedByDefault(o,s),i=topLevelModule(t,s),p=compileCtxAstToJs(i,o,astFromSource("("+e+")",-1,-1)),u=p.request,r=p.ast,l=p.ir,c=p.js,u){if(!allInjected(u,n))return compileTopLevel(e,t,u);c=compileCtxIrToJs(o,l).js}return a=checkTypes(o),finalizeTypes(o,r),replaceOrAddToMap(compiledModules,t,{declared:subtractContexts(o,injectedContext(d)),js:c}),{js:c,ast:r,errors:a}},compileModule=function(e){return null==e&&(e="@unnamed"),{js:library+immutable+listOfLines(map(lookupJs,setToArray(runtimeDependencies(e))))}},compileExpression=function(e,t){var n,r,i,o,s,a,l,c;return null==t&&(t="@unnamed"),n=astFromSource("("+e+")",-1,-1),_empty(_validTerms(n))?{ast:n,js:""}:(c=contextWithDependencies(moduleDependencies(t)),l=c.modules,i=c.ctx,s=_terms(n)[0],r=topLevelExpressionInModule(importsFor(moduleDependencies(t))),a=compileCtxAstToJs(r,i,s).js,o=checkTypes(i),finalizeTypes(i,s),{js:library+immutable+listOfLines(map(lookupJs,setToArray(runtimeDependencies(t))))+"\n;"+a,ast:n,errors:o,malformed:i.isMalformed})},expandCall=function(e,t){var n,r,i,o,s;s=contextWithDependencies(moduleDependencies(e)),o=s.modules,n=s.ctx;try{if(i=callMacroExpand(n,t),!isTranslated(i))return i}catch(a){return r=a,console.error("Error in expandCall"),console.error(r),null}},importsFor=function(e){var t;return t=function(e){return setToArray(lookupCompiledModule(e).declared.definitions)},mapKeys(t,e)},contextWithDependencies=function(e){return{ctx:injectedContext(e,!0),modules:setToArray(e)}},moduleDependencies=function(e){return concatSets(requiresFor(e),newSetWith(e))},runtimeDependencies=function(e){return concatSets(collectRequiresFor(e),newSetWith(e))},reverseModuleDependencies=function(e){return concatSets(newSetWith(e),requiresFor(e))},checkTypes=function(e){return isFailed(e.substitution)?(labelConflicts(_fst(e.substitution.fails)),e.substitution.fails):void 0},labelConflicts=function(e){return e.conflicts?map(labelConflict,e.conflicts):e},labelConflict=function(e){return e.TypeVariable&&e.ref.val?labelConflict(e.ref.val):e.error=!0},lookupJs=function(e){var t,n;return t=null!=(n=lookupCompiledModule(e))?n.js:void 0,t?t:console.error(""+e+" not found")},allInjected=function(e,t){var n,r,i,o;o=values(e);for(r in o)if(i=o[r],n=lookupInMap(t,r),!n)return!1;return!0},subtractContexts=function(e,t){var n,r,i,o,s,a;return r=subtractMaps(e._scope(),t._scope()),a=subtractMaps(e._scope().typeNames,t._scope().typeNames),n=subtractMaps(e._scope().classes,t._scope().classes),i=subtractMaps(e._scope().macros,t._scope().macros),s=e.savedScopes,o=e.nameIndex,{definitions:r,typeNames:a,classes:n,macros:i,savedScopes:s,nameIndex:o}},injectedContext=function(e,t){var n,r,i,o,s;r=new Context,s=values(e);for(i in s)o=s[i],(n=lookupCompiledModule(i))&&injectContext(r,t,n.declared,i,o);return r},injectContext=function(e,t,n,r,i){var o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,C,w,A;a=n.definitions,y=n.typeNames,s=n.classes,d=n.macros,g=e._scope(),f=function(e){return!i.size||inSet(i,e)},C=values(d);for(p in C)if(h=C[p],f(p)){if(e.isMacroDeclared(p))throw new Error("Macro "+p+" already defined");addToMap(g.macros,p,h)}w=values(a);for(p in w)A=w[p],v=A.type,o=A.arity,l=A.docs,m=A.source,u=A.isClass,b=A.virtual,c=A.final,f(p)&&addToMap(g,p,{arity:o,docs:l,source:m,isClass:u,virtual:b,"final":c,type:t?v:void 0,tempType:v,id:e.freshId()});return g.typeNames=concatMaps(g.typeNames,y),g.classes=concatMaps(g.classes,s),e.scopeIndex+=n.savedScopes.length,e.nameIndex+=n.nameIndex,addToSet(e.importedModules,r),e},collectRequiresFor=function(e){var t,n,r;return n=newSet(),t=newMap(),r=function(e,i){var o,s,a,l,c;if(inSet(n,e))throw new Error("Cyclic dependency between modules "+listOf(setToArray(n)));if(!lookupInMap(t,e)){if(o=lookupInMap(moduleGraph,e)){a=o.requires,addToSet(n,e),c=values(a);for(s in c)l=c[s],r(s,l);return removeFromSet(n,e),addToMap(t,e,i)}return console.error(""+e+" module not found")}},r(e),t},requiresFor=function(e){var t;return t=lookupInMap(moduleGraph,e),t?t.requires:(console.error(""+e+" module not found"),newMap())},findAvailableTypes=function(e,t){var n,r,i,o,s;return s=lookupCompiledModule(e).declared.typeNames,r=contextWithDependencies(reverseModuleDependencies(e)).ctx,o=function(e,t){var n;return n=kindFnNumArgs(e),{type:0===n?t:"("+t+Array(n+1).join(" ")+")",docs:null}},n=concatMaps(s,r._scope().typeNames),t!==!0?(t.name&&(n=filterMap(function(e){return e!==t.name},n)),i=newMapWith("inferred",{type:plainPrettyPrint(toForAll(toConstrained(t)))})):i=newMap(),values(concatMaps(i,mapMap(o,n)))},kindFnNumArgs=function(e){return e===star?0:1+kindFnNumArgs(e.to)},findMatchingDefinitions=function(e,t){var n,r,i,o,s,a,l,c,u;return s=lookupCompiledModule(e).declared.savedScopes,n=contextWithDependencies(reverseModuleDependencies(e)).ctx,a=t.scope,u=t.type,o=t.pattern,r=t.emptyCall,null==a?[]:(l=function(){var e;if(s[a]){for(e=[];0!==a;)i=s[a],a=i.parent,e.push(i.definitions);return e}return[]}(),c=cloneMap(n._scope()),removeFromMap(c,"=="),removeFromMap(c,"is-null-or-undefined"),addToMap(c,"{}",{type:quantifyAll(toConstrained(new TypeApp(arrayType,new TypeVariable("a",star)))),isPattern:!0}),findMatchingDefinitionsOnType(u,o,r,join(l,[c])))},findMatchingDefinitionsOnType=function(e,t,n,r){var o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,C,w,A,x;return s=new Context,x=unzip(function(){var C,w,x;for(x=[],i=C=0,w=r.length;w>C;i=++C)c=r[i],d=function(e,r){return null!=r.type&&!r.type.TempType&&(!t||isConst({symbol:e})||r.isPattern)&&(!n||r.type.type.type&&isFunctionType(r.type.type.type))},A=filterMap(d,c),n||(A=concatMaps.apply(null,[A].concat(__slice.call(function(){var e,t;e=values(A),t=[];for(p in e)l=e[p],l.arity&&(m=concreteReturnType(l.type))&&(a=l.arity.length>1?newMapWith("("+p+" "+Array(l.arity.length-1).join(" ")+")",{type:new ForAll(l.type.kinds,new Constrained([],curriedType(l.type.type.type))),docs:l.docs,fabricated:!0}):void 0,u=newMapWith("("+p+" "+Array(l.arity.length).join(" ")+")",{type:new ForAll(l.type.kinds,new Constrained([],m)),docs:l.docs,fabricated:!0}),t.push(a?concatMaps(u,a):u));return t}())))),o=-1e6,b=0,y=function(e){return printType(e.type)+" "+map(printType,e.constraints).join(" ")},g=function(t){var r,a,l,c,u;return l=n&&!isZeroArityFunctionType(t.type.type.type),a=freshenType(e.type),r=freshInstance(s,t.type).type,u=l?mostGeneralUnifier(functionReturnType(r),functionReturnType(a)):mostGeneralUnifier(r,a),c=isFailed(u)?o:-(subMagnitude(r,a)+100*i),{type:y(t.type.type),arity:t.arity,docs:t.docs,rawType:t.type,score:c,fabricated:t.fabricated}},f=function(e,t){return h(t)||!t.fabricated},h=function(e){return e.score!==o},v=mapMap(g,A),x.push(partitionMap(h,filterMap(f,v)));return x}()),C=x[0],w=x[1],values(concatMaps.apply(null,__slice.call(C).concat(__slice.call(w))))},subMagnitude=function(e,t){var n,r,i,o,s,a;for(o=join(findSubstitutions(e),findSubstitutions(t)),n=0,s=0,a=o.length;a>s;s++)i=o[s],n+=i.TypeApp?(r=actualOpName(i.op),"Fn"===r?20:3):2;return n},findSubstitutions=function(e){return e.TypeVariable&&e.ref.val?[e.ref.val]:e.TypeApp?join(findSubstitutions(e.op),findSubstitutions(e.arg)):[]},actualOpName=function(e){var t;return null!=(t=e.name)?t:actualOpName(e.op)},concreteReturnType=function(e){var t,n;return n=e.type.type,isFunctionType(n)&&(t=functionReturnType(n))&&!t.QuantifiedVar&&t},curriedType=function(e){return e.arg&&isFunctionType(e.arg)?curriedType(e.arg):e},functionReturnType=function(e){return e.arg&&isFunctionType(e)?functionReturnType(e.arg):e},isFunctionType=function(e){var t;return(null!=(t=e.op)?t.op:void 0)&&typeEq(e.op.op,arrowType)||isZeroArityFunctionType(e)},isZeroArityFunctionType=function(e){return e.op&&typeEq(e.op,zeroArrowType)},findDocsFor=function(e,t){var n,r,i,o,s,a;return(i=findDeclarationFor(e,t))?(o=t.name,n=i.arity,a=i.type,r=i.docs,s=i.source,{name:o,rawType:a,docs:r,arity:n,source:s}):void 0},findDeclarationFor=function(e,t){var n,r,i,o,s,a,l,c;for(a=lookupCompiledModule(e).declared.savedScopes,o=t.name,l=t.scope;l>0&&!i&&(s=a[l]);)i=lookupInMap(s.definitions,o),l=s.parent;return i||(n=contextWithDependencies(reverseModuleDependencies(e)).ctx,i=lookupInMap(n._scope(),o)),i||(r=null!=(c=lookupInMap(n._scope().macros,o))?c.docs:void 0,r&&(i={docs:r})),i},syntaxedExpHtml=function(e){return collapse(toHtml(astize(tokenize(e))))},syntaxedType=function(e){return collapse(toHtml(typeCompile(new Context,e)))},compileTopLevelSource=function(e){var t,n,r,i;return i=compileToJs(topLevel,"("+e+")",-1,-1),r=i.js,t=i.ast,n=i.ctx,finalizeTypes(n,t),{js:r,ast:t,types:typeEnumaration(n)}},compileTopLevelAndExpression=function(e){return topLevelAndExpression(e)},topLevelAndExpression=function(e){var t,n,r,i,o,s,a,l;return t=astize(tokenize("("+e+")",-1),-1),l=_validTerms(t),s=2<=l.length?__slice.call(l,0,a=l.length-1):(a=0,[]),o=l[a++],i=(n=compileAstToJs(definitionList,pairs(s))).ctx,r=compileCtxAstToJs(topLevelExpression,i,o),finalizeTypes(i,o),{types:i._scope(),subs:i.substitution.fails,ast:t,compiled:library+immutable+n.js+"\n;"+r.js}},typeEnumaration=function(e){return values(mapMap(_type,e._scope()))},toJs=function(e,t){var n;return null!=(n=compileToJs(e,"("+t+")",-1,-1))?n.js:void 0},compileToJs=function(e,t,n,r){return null==n&&(n=0),null==r&&(r=0),compileAstToJs(e,astFromSource(t,n,r))},astFromSource=function(e,t,n){return null==t&&(t=0),null==n&&(n=0),astize(tokenize(e,t),n)},compileAstToJs=function(e,t){var n;return n=new Context,compileCtxAstToJsAlways(e,n,t)},compileCtxAstToJsAlways=function(e,t,n){var r,i;return r=e(t,n),i=compileCtxIrToJs(t,r).js,{ctx:t,ast:n,ir:r,js:i}},compileCtxAstToJs=function(e,t,n){var r,i;return r=e(t,n),t.requested()?{request:t.requested(),ast:n,ir:r}:(i=compileCtxIrToJs(t,r).js,{ctx:t,ast:n,ir:r,js:i})},compileCtxIrToJs=function(e,t){var n,r;return t&&(r=translateIr(e,t),n=(Array.isArray(r)?translateStatementsToJs:translateToJs)(r)),{js:n}},astizeList=function(e){return parentize(astize(tokenize("("+e+")",-1),-1))},astizeExpression=function(e){return parentize(astize(tokenize(e)))},astizeExpressionWithWrapper=function(e){return parentize(astize(tokenize("("+e+")",-1),-1))},labelDocs=function(e,t){var n,r,i,o,s;for(n=astizeList(e).slice(1,-1),t&&labelUsedParams(n,t),o=0,s=n.length;s>o;o++)i=n[o],isForm(i)||"param"===i.label||(i.label=null);return r=function(e,t,n){return isCall(n)&&e===_operator(n)?e.label="operator":void 0},crawl(n,r),collapse(toHtml(n))},finalizeTypes=function(e,t){var n,r,i,o,s,a,l;for(visitExpressions(t,function(t){var n;"name"===t.label&&t.scope&&(n=e.finalType(t.symbol,t.scope))&&(t.tea=n)}),a=e.savedScopes,o=0,s=a.length;s>o;o++)if(i=a[o],null!=i){l=values(i.definitions);for(r in l)n=l[r],n.type&&(n.type=substitute(e.substitution,n.type))}},_tea=function(e){return e.tea},_operator=function(e){return _terms(e)[0]},_arguments=function(e){return _terms(e).slice(1)},_validArguments=function(e){return _validTerms(e).slice(1)},_terms=function(e){return filter(isExpressionOrFake,e)},_validTerms=function(e){return filter(isExpression,e)},_snd=function(e){var t,n;return t=e[0],n=e[1]},_fst=function(e){var t,n;return t=e[0],n=e[1],t},_labelName=function(e){return _symbol(e).slice(0,-1)},_stringValue=function(e){var t;return t=e.symbol,t.slice(1,-1)},_symbol=function(e){var t;return t=e.symbol},unique=function(e){return setToArray(arrayToSet(e))},join=function(e,t){return e.concat(t)},concatMap=function(e,t){return concat(map(e,t))},concat=function(e){var t;return(t=[]).concat.apply(t,e)},reverse=function(e){return map(id,e).reverse()},id=function(e){return e},map=function(e,t){return t?t.map(e):void 0},allMap=function(e,t){return all(map(e,t))},all=function(e){return filter(_is,e).length===e.length},any=function(e){return filter(_is,e).length>0},filter=function(e,t){return t.filter(e)},partition=function(e,t){return[filter(e,t),filter(__(_not,e),t)]},_notEmpty=function(e){return e.length>0},_empty=function(e){return 0===e.length},_not=function(e){return!e},_is=function(e){return!!e},__=function(e,t){return function(n){return e(t(n))}},test=function(testName,teaSource,result){var compiled,e,failure,got,success;try{compiled=topLevelAndExpression(teaSource)}catch(_error){return e=_error,void logError("Failed to compile test |"+testName+"|\n"+teaSource+"\n",e)}try{log(collapse(toHtml(compiled.ast))),_notEmpty(compiled.subs)&&(log(map(formatFail,compiled.subs)),failure=!0),result!==(got=eval(compiled.compiled))?(log("'"+testName+"' expected",result,"got",got),success=!1):success=!failure}catch(_error){e=_error,logError("Error in test |"+testName+"|\n"+teaSource+"\n",e)}return success},tests=["simple defs","a 2","a",2,"more defs","a 2\nb 3","a",2,"constant data","Color (data Red Blue)\nr Red\nb Blue\nr2 Red","(== r r2)",!0,"match numbers","positive (fn [n]\n(match n\n  0 False\n  m True))","(positive 3)",!0,"composite data",'Person (data\n  Baby\n  Adult [name: String])\n\na (Adult "Adam")\n\nb Baby\n\nname (fn [person]\n  (match person\n    (Adult name) name))',"(name a)","Adam","records","Person (record name: String id: Num)\n\nname (fn [person]\n  (match person\n    (Person name id) name))",'(name ((Person id: 3) "Mike"))',"Mike","polymorphic records","Person (record [a] name: a id: Num)\n\nname (fn [person]\n  (match person\n    (Person name id) name))",'(name ((Person id: 3) "Mike"))',"Mike","recursive data","Tree (data [a]\n  Val [value: a]\n  Node [child: (Tree a)])","(Val-value (Node-child (Node (Val 42))))",42,"late bound function","f (fn [x] (g x))\ng (fn [x] 2)","(f 4)",2,"late bound def","[x y] z\nz [1 2]","y",2,"tuples","snd (fn [pair]\n(match pair\n  [x y] y))","(snd [1 2])",2,"match data",'Person (record name: String id: Num)\nname (fn [person]\n  (match person\n    (Person "Joe" id) 0\n    (Person name id) id))','(name (Person "Mike" 3))',3,"seqs","{x y z} list\nlist {1 2 3}","z",3,"match seq","tail? (fn [list]\n  (match list\n    {} False\n    xx True))\n{x ..xs} {1}","(tail? xs)",!1,"seq splice in match",'& (macro [what to]\n  (: (Fn a (Array a) (Array a)))\n  (Js.call (Js.access to "unshift") {what}))\n\nmap (fn [what to]\n  (match to\n    {} {}\n    {x ..xs} (& (what x) (map what xs))))\n\n{{x} ..xs} (map (& 42) {{}})',"x",42,"typed function","f (fn [x y]\n(: (Fn Bool String Bool))\nx)",'(f True "a")',!0,"classes",'Show (class [a]\n  show (fn [x] (: (Fn a String))))\n\nshow-string (instance (Show String)\n  show (fn [x] x))\n\naliased-show (fn [something]\n  (show something))\n\nshowed-simply (show "Hello")\nshowed-via-alias (aliased-show "Hello")',"(== showed-simply showed-via-alias)",!0,"multiple methods","Util (class [a]\n  show (fn [x] (: (Fn a String)))\n  read (fn [x] (: (Fn String a))))\n\nutil-string (instance (Util String)\n   show (fn [x] x)\n   read (fn [x] x))\n\ntest (fn [string]\n  (: (Fn String String))\n  (read (show string)))",'(test "Hello")',"Hello","multiple instances",'Show (class [a]\n  show (fn [x] (: (Fn a String))))\n\nshow-string (instance (Show String)\n  show (fn [x] x))\n\nshow-bool (instance (Show Bool)\n  show (fn [x]\n    (match x\n      True "True"\n      False "False")))',"(show False)","False","instance constraints","Show (class [a]\n  show (fn [x] (: (Fn a String))))\n\nshow-string (instance (Show String)\n  show (fn [x] x))\n\nshow-snd (instance (Show [a b])\n  {(Show a) (Show b)}\n  show (fn [x]\n    (match x\n      [fst snd] (show snd))))",'(show ["Adam" "Michal"])',"Michal","instance constraints on array","Show (class [a]\n  show (fn [x] (: (Fn a String))))\n\nshow-string (instance (Show String)\n  show (fn [x] x))\n\nhead (fn [array]\n  x\n  {x ..xs} array)\n\nshow-snd (instance (Show (Array a))\n  {(Show a)}\n  show (fn [array]\n    (show (head array))))",'(show {"Michal" "Adam"})',"Michal","multiple constraints","Show (class [a]\n  show (fn [x] (: (Fn a String))))\n\nHide (class [a]\n  hide (fn [x] (: (Fn a String))))\n\nshow-string (instance (Show String)\n  show (fn [x] x))\n\nhide-string (instance (Hide String)\n  hide (fn [x] x))\n\nf (fn [x]\n  (== (show x) (hide x)))",'(f "Hello")',!0,"superclasses","Eq (class [a]\n  = (fn [x y] (: (Fn a a Bool))))\n\nOrd (class [a]\n  {(Eq a)}\n  <= (fn [x y] (: (Fn a a Bool))))\n\neq-bool (instance (Eq Bool)\n  = (fn [x y]\n    (match [x y]\n      [True True] True\n      [False False] True\n      [w z] False)))\n\nord-bool (instance (Ord Bool)\n  <= (fn [x y]\n    (match [x y]\n      [True any] True\n      [w z] (= w z))))\n\ntest (fn [x]\n  (== (<= x x) (= x x)))","(test False)",!0,"function with constrained result","Eq (class [a]\n  = (fn [x y] (: (Fn a a Bool))))\n\n!= (fn [x y]\n  (not (= x y)))\n\nnot (fn [x]\n  (match x\n    False True\n    True False))\n\neq-bool (instance (Eq Bool)\n  = (fn [x y]\n    (match [x y]\n      [True True] True\n      [False False] True\n      [w z] False)))","(!= False True)",!0,"polymorphic data","Maybe (data [a]\n  None\n  Just [value: a])\n\nfrom-just (fn [maybe]\n  (match maybe\n    (Just x) x))","(from-just (Just 42))",42,"js unary op",'~ (macro [x]\n  (: (Fn Num Num))\n  (Js.unary "-" x))\nx -42',"(~ x)",42,"js binary op",'+ (macro [x y]\n  (: (Fn Num Num Num))\n  (Js.binary "+" x y))',"(+ 1 2)",3,"js cond","if (macro [what then else]\n  (: (Fn Bool a a a))\n  (Js.ternary what then else))","(if False 1 2)",2,"currying functional macros",'* (macro [x y]\n  (: (Fn Num Num Num))\n  (Js.binary "*" x y))\n\nf (* 2)',"(f 3)",6,"getters",'Person (record\n  first: String last: String)\n\njack (Person "Jack" "Jack")',"(== (Person-first jack) (Person-last jack))",!0,"macros in instances",'Show (class [a]\n  show (fn [x] (: (Fn a String))))\n\nnum-to-string (macro [n]\n  (: (Fn Num String))\n  (Js.binary "+" n "\\"\\""))\n\nshow-num (instance (Show Num)\n  show (fn [x]\n    (num-to-string x)))',"(show 3)","3","fib",'fibonacci (fn [month] (adults month))\n\nadults (fn [month]\n  (match month\n    1 0\n    n (+ (adults previous-month) (babies previous-month)))\n  previous-month (- 1 month))\n\nbabies (fn [month]\n  (match month\n    1 1\n    n (adults (- 1 month))))\n\n+ (macro [x y]\n  (: (Fn Num Num Num))\n  (Js.binary "+" x y))\n\n- (macro [x y]\n  (: (Fn Num Num Num))\n  (Js.binary "-" y x))',"(fibonacci 7)",8,"Map literal",'data {a: True b: False}\n\nkey? (macro [what in]\n  (: (Fn k (Map k i) Bool))\n  (Js.call (Js.access in "has") {what}))\n\nat (macro [key in]\n  (: (Fn k (Map k i) i))\n  (Js.call (Js.access in "get") {key}))','(== (key? "c" data) (at "b" data))',!0,"create Set",'data (Set "Adam" "Vojta" "Michal")\n\nelem? (macro [what in]\n  (: (Fn i (Set i) Bool))\n  (Js.call (Js.access in "has") {what}))','(elem? "Michal" data)',!0,"create Map",'data (Map 3 "a" 5 "b")\n\nat (macro [key in]\n  (: (Fn k (Map k i) i))\n  (Js.call (Js.access in "get") {key}))',"(at 5 data)","b","type alias","Point (type [Num Num])\n\nx (fn [p]\n  (: (Fn Point Num))\n  first\n  [first second] p)","(x [3 4])",3,"collections",'Collection (class [collection]\n  elem? (fn [what in]\n    (: (Fn item (collection item) Bool))\n    (# Whether in contains what .)))\n\nBag (class [bag]\n  {(Collection bag)}\n\n  fold (fn [with initial over]\n    (: (Fn (Fn item b b) b (bag item)))\n    (# Fold over with using initial .))\n\n  length (fn [bag]\n    (: (Fn (bag item) Num))\n    (# The number of items in the bag .))\n\n  empty? (fn [bag]\n    (: (Fn (bag item) Bool))\n    (# Whether the bag contains no elements.)))\n\nlist-elem? (macro [what in]\n  (: (Fn item (Array item) Bool))\n  (Js.call (Js.access in "contains") {what}))\n\ncollection-list (instance (Collection Array)\n  elem? (fn [what in]\n    (list-elem? what in)))',"(elem? 3 {1 2 3})",!0,"multiparam classes",'Collection (class [ce e]\n  first (fn [in]\n    (: (Fn (ce e) e))))\n\nlist-first (macro [in]\n  (: (Fn (Array item) item))\n  (Js.call (Js.access in "first") {}))\n\nlist-collection (instance (Collection Array a)\n  first (fn [in]\n    (list-first in)))',"(first {42 43 44})",42,"functional deps",'Collection (class [ce e]\n  first (fn [in]\n    (: (Fn ce e))))\n\nlist-first (macro [in]\n  (: (Fn (Array item) item))\n  (Js.call (Js.access in "first") {}))\n\nlist-collection (instance (Collection (Array a) a)\n  first (fn [in]\n    (list-first in)))',"(first {42 43 44})",42,"functional deps on function",'Map (class [m k v]\n  put (fn [key value map]\n    (: (Fn k v m m))))\n\nmap-map (instance (Map (Map k v) k v)\n  put (macro [key value map]\n    (: (Fn k v (Map k v) (Map k v)))\n    (Js.call (Js.access map "set") {key value})))\n\ncount (macro [map]\n  (: (Fn (Map k v) Num))\n  (Js.access map "size"))\n\nmagic (fn [key map]\n  (put key 42 map))',"(count (magic \\C (Map)))",1,"super classes with less params",'Bag (class [b i]\n  length (fn [bag]\n    (: (Fn b Num)))\n  id (fn [item]\n    (: (Fn i i))))\n\nMap (class [m k v]\n  {(Bag m v)}\n  put (fn [key value map]\n    (: (Fn k v m m))))\n\nmap-bag (instance (Bag (Map k v) v)\n  length (macro [map]\n    (: (Fn (Map k v) Num))\n    (Js.access map "size"))\n  id (fn [x] x))\n\nmap-map (instance (Map (Map k v) k v)\n  put (macro [key value map]\n    (: (Fn k v (Map k v) (Map k v)))\n    (Js.call (Js.access map "set") {key value})))\n\nmagic (fn [key map]\n  (put key 42 map))',"(length (magic \\C (Map)))",1,"functional deps with instance constraints",'Stack (data [a]\n  Nil\n  Node [value: a tail: (Stack a)])\n\nEq (class [a]\n  = (fn [x y] (: (Fn a a Bool))))\n\nnum-eq (instance (Eq Num)\n  = (macro [x y]\n    (: (Fn Num Num Bool))\n    (Js.binary "===" x y)))\n\nCollection (class [collection item]\n  elem? (fn [what in]\n    (: (Fn item collection Bool))))\n\nBag (class [bag item]\n  fold (fn [with initial over]\n    (: (Fn (Fn a item a) a bag a))))\n\nstack-collection (instance (Collection (Stack a) a)\n  {(Eq a)}\n  elem? (fn [what in]\n    (= what what)))\n\nstack-bag (instance (Bag (Stack a) a)\n  fold (fn [with initial over]\n    (match over\n      Nil initial\n      (Node x xs) (fold with (with initial x) xs))))',"(elem? 2 (Node 2 Nil))",!0,"nested pattern matching","f (fn [x]\n  y\n  [[z y] g] x)","(f [[2 42] 3])",42,"deferring in tuples","g [f {} 3]\nf 4\n[o t r] g","o",4,"multiple generic constraints",'Show (class [a]\n  show (fn [x] (: (Fn a String))))\n\nshow-string (instance (Show String)\n  show (fn [x] x))\n\nf (fn [pair]\n  [(show a) (show b)]\n  [a b] pair)\n\n[x y] (f ["A" "B"])',"x","A","higher-order use of constrained function",'Show (class [a]\n  show (fn [x] (: (Fn a String))))\n\nshow-string (instance (Show String)\n  show (fn [x] x))\n\nf (fn [pair]\n  [(show a) (show b)]\n  [a b] pair)\n\napply (fn [m to]\n  (m to))\n\n[x y] (apply f ["A" "B"])',"x","A","deeply deferred","c b\nb a\na 3","c",3,"compile before typing due to multiple deferred","a (f 3)\nf (fn [x] (h g x))\ng (fn [x] b)\nh (fn [y z] (y z))\nb 4\nc (f 2)","a",4,"more deferred","a (e 3)\n\nmap (fn [l] (l 2))\n\ne (fn [x]\n  (map f)\n  k (g 2))\n\nf (fn [x]\n  (h 2))\n\ng (fn [x]\n  2)\n\nh (fn [x]\n  (j 1))\n\nj (fn [x]\n  2)","a",2,"constants in classes",'A (class [c e]\n  empty (: c)\n\n  first (fn [x] (: (Fn c e))))\n\nlist-a (instance (A (Array a) a)\n  empty {}\n\n  first (macro [list]\n    (: (Fn (Array a) a))\n    (Js.call (Js.access list "first") {})))\n\nunshift (macro [what to]\n  (: (Fn a (Array a) (Array a)))\n  (Js.call (Js.access to "unshift") {what}))',"(first (unshift 3 empty))",3,"values with constraints",'A (class [c]\n  empty (: c))\n\nB (class [c e]\n  add (fn [what to] (: (Fn e c c))))\n\nlist-a (instance (A (Array a))\n  empty {})\n\nlist-b (instance (B (Array a) a)\n  add (macro [what to]\n    (: (Fn a (Array a) (Array a)))\n    (Js.call (Js.access to "unshift") {what})))\n\nfirst (macro [list]\n  (: (Fn (Array a) a))\n  (Js.call (Js.access list "first") {}))\n\nsome (add 2 empty)\n\nx (first some)',"x",2,"curried type constructor",'+ (macro [x y]\n  (: (Fn Num Num Num))\n  (Js.binary "+" x y))\n\nget (macro [key from]\n  (: (Fn k (Map k v) v))\n  (Js.method from "get" {key}))\n\nput (macro [key value into]\n  (: (Fn k v (Map k v) (Map k v)))\n  (Js.method into "set" {key value}))\n\nMappable (class [wrapper]\n  map (fn [what onto]\n    (: (Fn (Fn a b) (wrapper a) (wrapper b)))\n    (# Apply what to every value inside onto .)))\n\nreduce-map (macro [with initial over]\n  (: (Fn (Fn a v k a) a (Map k v) a))\n  (Js.method over "reduce" {with initial}))\n\nmap-mappable (instance (Mappable (Map k))\n  map (fn [what onto]\n    (reduce-map helper (Map) onto)\n    helper (fn [acc value key]\n      (put key (what value) acc))))','(get "c" (map (+ 1) {a: 3 b: 2 c: 4}))',5,"reduced call context",'Bag (class [bag item]\n  empty (: bag)\n\n  fold (fn [with initial over]\n    (: (Fn (Fn item a a) a bag a)))\n\n  append (fn [what to]\n    (: (Fn bag bag bag)))\n\n  first (fn [of]\n    (: (Fn bag item))))\n\narray-bag (instance (Bag (Array a) a)\n  empty {}\n\n  fold (macro [with initial list]\n    (: (Fn (Fn a b b) b (Array a) b))\n    (Js.method list "reduce"\n      {(fn [acc x] (with x acc)) initial}))\n\n  append (macro [what to]\n    (: (Fn (Array a) (Array a) (Array a)))\n    (Js.method to "concat" {what}))\n\n  first (macro [list]\n    (: (Fn (Array a) a))\n    (Js.method list "first" {})))\n\nconcat (fn [bag-of-bags]\n  (fold append empty bag-of-bags))',"(first (concat {{1} {2} {3}}))",1,"mixing constructor classes with fundeps",concatTest='Mappable (class [wrapper]\n  map (fn [what onto]\n    (: (Fn (Fn a b) (wrapper a) (wrapper b)))))\n\nBag (class [bag item]\n  size (fn [bag]\n    (: (Fn bag Num)))\n\n  empty (: bag)\n\n  fold (fn [with initial over]\n    (: (Fn (Fn item a a) a bag a)))\n\n  join (fn [what with]\n    (: (Fn bag bag bag))))\n\narray-mappable (instance (Mappable Array)\n  map (macro [what over]\n    (: (Fn (Fn a b) (Array a) (Array b)))\n    (Js.method over "map" {what})))\n\narray-bag (instance (Bag (Array a) a)\n  size (macro [list]\n    (: (Fn (List a) Num))\n    (Js.access list "size"))\n\n  empty {}\n\n  fold (macro [with initial list]\n    (: (Fn (Fn a b b) b (Array a) b))\n    (Js.method list "reduce"\n      {(fn [acc x] (with x acc)) initial}))\n\n  join (macro [what with]\n    (: (Fn (Array a) (Array a) (Array a)))\n    (Js.method what "concat" {with})))\n\nconcat (fn [bag-of-bags]\n  (fold join empty bag-of-bags))\n\nconcat-map (fn [what over]\n  (concat (map what over)))',"(size (concat-map (fn [x] {1}) {1 2 3}))",3,"overloaded subfunctions",""+concatTest+"\n\nconcat-suffix (fn [suffix what]\n  (fold join-suffix empty what)\n  join-suffix (fn [x joined]\n    (concat {joined suffix x})))","(size (concat-suffix {1} (concat-map (fn [x] {{1}}) {1 2 3})))",6,"overloaded subfunctions 2","id (fn [x] x)\n\nBag (class [bag item]\n  fold (fn [with initial over]\n    (: (Fn (Fn item a a) a bag a))))\n\nfold-right (fn [with initial over]\n  ((fold helper id over) initial)\n  helper (fn [x r acc]\n    (r (with x acc))))","6",6,"overloaded subfunctions 3",'Deq (class [seq item]\n  && (fn [what to]\n    (: (Fn item seq seq))))\n\narray-deq (instance (Deq (Array a) a)\n  && (macro [what to]\n    (: (Fn a (Array a) (Array a)))\n    (Js.method to "push" {what})))\n\nAppendable (class [collection item]\n  & (fn [what to]\n    (: (Fn item collection collection))))\n\nBag (class [bag item]\n  empty (: bag)\n\n  fold (fn [with initial over]\n    (: (Fn (Fn item a a) a bag a))))\n\nsplit (fn [bag]\n  (: (Fn ba (Array ba)) (Appendable ba a) (Bag ba a))\n  (fold wrap {} bag)\n  wrap (fn [x all]\n    (&& (& x empty) all)))',"6",6,"overloaded subfunctions 4",'id (fn [x] x)\n\nif (macro [what then else]\n  (: (Fn Bool a a a))\n  (Js.ternary what then else))\n\nBag (class [bag item]\n  fold (fn [with initial over]\n    (: (Fn (Fn item a a) a bag a))\n    (# Fold over using with and initial folded value .)))\n\nAppendable (class [collection item]\n  & (fn [what to]\n    (: (Fn item collection collection))))\n\nfold-right (fn [with initial over]\n  ((fold wrap id over) initial)\n  wrap (fn [x r acc]\n    (r (with x acc))))\n\narray-bag (instance (Bag (Array a) a)\n  fold (macro [with initial list]\n    (: (Fn (Fn a b b) b (Array a) b))\n    (Js.method list "reduce"\n      {(fn [acc x] (with x acc)) initial})))\n\narray-appendable (instance (Appendable (Array a) a)\n  & (macro [what to]\n    (: (Fn a (Array a) (Array a)))\n    (Js.method to "unshift" {what})))\n\nchars (macro [string]\n  (: (Fn String (Array Char)))\n  (Js.call "Immutable.List"\n    {(Js.method string "split" {"\'\'"})}))\n\nstring-bag (instance (Bag String Char)\n  fold (fn [with initial string]\n    (fold with initial (chars string))))\n\nstring-appendable (instance (Appendable String Char)\n  & (macro [what to]\n    (: (Fn Char String String))\n    (Js.binary "+" what to)))\n\nSet (class [set item]\n  elem? (fn [what in]\n    (: (Fn item set Bool))\n    (# Whether in contains what .)))\n\nset-set (instance (Set (Set a) a)\n  elem? (macro [what in]\n    (: (Fn (Set a) a Bool))\n    (Js.method in "contains" {what})))\n\nmy-split (fn [separators text]\n  (fold-right distinguish ["" {""}] text)\n  distinguish (fn [letter done]\n    (if (elem? letter separators)\n      [(& letter seps-in-order) (& "" words)]\n      [seps-in-order (& (& letter first-word) rest-words)])\n    {first-word ..rest-words} words\n    [seps-in-order words] done))\n\nseparators (Set \\space \\, \\!)\n\n[seps words] (my-split separators "Hello, world!")',"seps",", !","recursive overloaded functions",'Show (class [a]\n  show (fn [x] (: (Fn a String))))\n\nshow-string (instance (Show String)\n  show (fn [x] x))\n\nshow-bool (instance (Show Bool)\n  show (fn [x] "Bool"))\n\naliased-show (fn [something b]\n  (match b\n    True (aliased-show something False)\n    False (show something)))\n\nx (aliased-show "Bool" True)\ny (fn [x] (aliased-show x True))',"(== x (y True))",!0,"ffi function","upper-case (fn [x]\n  (: (Fn String String))\n  (.toUpperCase x))",'(upper-case "Hello")',"HELLO","ffi expression","",'(.toUpperCase "x")',"X","ffi access","","Math.PI",Math.PI,"ffi access on global","","global.Math.PI",Math.PI,"sets",'first (macro [set]\n  (: (Fn (Set a) a))\n  (Js.method set "first" {}))\nx 2\ny (Set x 1 3)',"(first y)",2,"recursion in subfunction","f (fn [x]\n  (match x\n    True False\n    False g)\n  g (f True))","False",!1,"lifting into conditionals","f (fn [x]\n  (cond\n    x False\n    True g)\n  g (f True))","(f False)",!1,"lifting with nested functions","f (fn [x]\n  ((fn [y]\n      g) 2)\n  g 3)","(f False)",3,"lifting into match conditional","f (fn [x]\n  (match x\n    True False\n    False g)\n  g (f h)\n  h True)","(f False)",!1,"lifting into match","Maybe (data [a]\n  None\n  Just [value: a])\n\nf (fn [x]\n  (match x\n    None 0\n    (Just y) g)\n  g y)","(f (Just 4))",4,"lifting into match from a call","Maybe (data [a]\n  None\n  Just [value: a])\n\nf (fn [x]\n  (match x\n    None 0\n    (Just [y z]) g)\n  g (y z))","(f (Just [(fn [w] w) 2]))",2,"shadowing",'f (macro [n]\n  (: (Fn Num Num))\n  (Js.binary "+" n 2))\n\ng (fn [x]\n  y\n  y (f x)\n  f (fn [y] y))',"(g 3)",3,"zero arity","f (fn [] 4)\n\ng (f)","g",4,"syntax macro","id (syntax [x]\n  x)\n\nsome (syntax [y]\n  (` (id (, y))))","(some 42)",42,"pattern match syntax",'+ (macro [x y]\n  (: (Fn Num Num Num))\n  (Js.binary "+" x y))\n\ninfix (syntax [exp]\n  (match exp\n    (` ((, x) (, op) (, z))) (` ((, op) (, x) (, z)))\n    _ (` "Failed to match syntax")))\n\nf (infix (3 + 4))',"f",7,"shortened syntax quote",'+ (macro [x y]\n  (: (Fn Num Num Num))\n  (Js.binary "+" x y))\n\ninfix (syntax [exp]\n  (match exp\n    (` ,x ,op ,z) (` ,op ,x ,z)\n    _ (` "Failed to match syntax")))\n\nf (infix (3 + 4))',"f",7,"constraints and deferring",'Show (class [a]\n  show (fn [x] (: (Fn a String))))\n\nshow-string (instance (Show String)\n  show (fn [x] x))\n\ns (fn [y]\n  (show y))\n\nf (fn [x]\n  g)\n\ng "2"\n\nr (fn [y]\n  (f (s y)))\n\nj (fn [x]\n  (r "src"))',"(j 2)","2","deferred in where",'f (fn [x] g)\n\ng 3\n\nh (fn [x]\n  2\n  gg (fn [x]\n    ff)\n  ff (f ""))',"(h 3)",2,"overloaded reference",'Mappable (class [wrapper]\n  map (fn [what onto]\n    (: (Fn (Fn a b) (wrapper a) (wrapper b)))))\n\narray-mappable (instance (Mappable Array)\n  map (macro [what over]\n    (: (Fn (Fn a b) (Array a) (Array b)))\n    (Js.method over "map" {what})))\n\ng (fn [lines]\n  (map f lines))\n\nf (fn [x]\n  x)\n\nexpand (fn [x]\n  gg\n  gg (g {""}))',"3",3,"defer in subdefinition",'f (fn [x]\n  ""\n  g (fn [y]\n    ((fn [x] x) h))\n  h ((fn [x] x) x))',"3",3,"dont lift when used in function","Maybe (data [a]\n  None\n  Some [value: a])\n\nf (fn [x]\n  (match x\n    None (g 4)\n    (Some v) h)\n  h 45\n  hh h\n  g (fn [x]\n    h)\n  p (fn [x] (p x)))","(f None)",45,"ambiguity on deferred non polymorphic",'Show (class [a]\n  show (fn [x] (: (Fn a String))))\n\nshow-string (instance (Show String)\n  show (fn [x] x))\n\nf (fn [x]\n  (g x))\n\ng (fn [y]\n  "")\n\nexpand (fn [z w]\n  ""\n  d (f (show w)))','(expand 3 "2")',"","shadowing in resolve deferred types",'f (fn [x]\n  (g x))\n\ng (fn [y]\n  "")\n\nd 4\n\nexpand (fn [z w]\n  ""\n  d (f 3))','(expand 3 "2")',"","using constructor in deferred definition","Maybe (data [a]\n  None\n  Just [value: a])\n\ntest (fn []\n  (Just x)\n  x (test2))\n\ntest2 (fn []\n  42)","(Just-value (test))",42],testNamed=function(e){var t,n,r,i,o,s,a,l;
for(a=tuplize(4,tests),o=0,s=a.length;s>o;o++)if(l=a[o],n=l[0],i=l[1],t=l[2],r=l[3],n===e)return i+"\n_ "+t;throw new Error("Test "+e+" not found!")},logError=function(e,t){return log(e,t.message,t.stack.replace(/\n?((\w+)[^>\n]+>[^>\n]+>[^>\n]+:(\d+:\d+)|.*)(?=\n)/g,"\n$2 $3").replace(/\n (?=\n)/g,""))},debug=function(e){var t;try{return e()}catch(n){return t=n,logError("debug",t)}},runTest=function(e){var t,n,r,i,o,s,a,l;for(a=tuplize(4,tests),o=0,s=a.length;s>o;o++)l=a[o],n=l[0],i=l[1],t=l[2],r=l[3],n===e&&test(n,i+"\n"+t,r);return"Done"},runTests=function(e){var t,n,r,i,o;return i=function(){var i,s,a,l,c;for(a=tuplize(4,e),c=[],i=0,s=a.length;s>i;i++)l=a[i],n=l[0],o=l[1],t=l[2],r=l[3],c.push(test(n,o+"\n"+t,r));return c}(),all(i)?"All correct":filter(_not,i).length+" failed"},exports.compileTopLevel=compileTopLevel,exports.compileModule=compileModule,exports.compileExpression=compileExpression,exports.expand=expandCall,exports.findAvailableTypes=findAvailableTypes,exports.findMatchingDefinitions=findMatchingDefinitions,exports.findDocsFor=findDocsFor,exports.astizeList=astizeList,exports.astizeExpression=astizeExpression,exports.astizeExpressionWithWrapper=astizeExpressionWithWrapper,exports.syntaxedExpHtml=syntaxedExpHtml,exports.syntaxedType=syntaxedType,exports.prettyPrint=prettyPrint,exports.plainPrettyPrint=plainPrettyPrint,exports.labelDocs=labelDocs,exports.builtInLibraryNumLines=library.split("\n").length+immutable.split("\n").length,exports.library=library,exports.originOf=originOf,exports.sortedArgs=sortedArgs,exports.isNotCapital=isNotCapital,exports.isForm=isForm,exports.isCall=isCall,exports.isAtom=isAtom,exports.join=join,exports.concatMap=concatMap,exports.concat=concat,exports.id=id,exports.map=map,exports.zipWith=zipWith,exports.unzip=unzip,exports.allMap=allMap,exports.all=all,exports.filter=filter,exports.partition=partition,exports._notEmpty=_notEmpty,exports._empty=_empty,exports._is=_is,exports.__=__,exports._operator=_operator,exports._arguments=_arguments,exports._terms=_terms,exports._validTerms=_validTerms,exports._snd=_snd,exports._fst=_fst,exports._labelName=_labelName,exports._symbol=_symbol,exports.call_=call_,exports.fn_=fn_,exports.token_=token_});