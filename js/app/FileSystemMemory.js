define(function(require,exports,module){var e,t,o,r,n,i,s,a=module.uri||"",u=(a.substring(0,a.lastIndexOf("/")+1),{}.hasOwnProperty),d=function(e,t){function o(){this.constructor=e}for(var r in t)u.call(t,r)&&(e[r]=t[r]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e};e=require("tinyemitter"),o=require("./Memory"),requireNode&&(n=requireNode("fs"),s=requireNode("path"),i=requireNode("mkdirp")),r=function(e,t){var o,r,n;o={};for(r in e)n=e[r],t(r,n)&&(o[r]=n);return o},module.exports=t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return d(t,e),t.prototype._directory=function(){var e;return e=s.join(process.env.PWD,window.GolemOpenFilePath,"src"),i.sync(e),e},t.prototype._countLines=function(e,t){return this._readFile(s.join(e,t)).split("\n").length},t.prototype.fileTable=function(){},t.prototype._fileTableStorage=function(e){var t,o,r,i,a,u,d,c;if(void 0!==e&&this.emitter.emit("fileTable"),!e){for(a={},i=this._directory(),c=n.readdirSync(i),u=0,d=c.length;d>u;u++)o=c[u],t=s.extname(o),"shem"===t.slice(1)&&(r=s.basename(o,t),a[r]={name:r,numLines:this._countLines(i,r)});return a}},t.prototype._fileStorage=function(e,t){var o,r,n,i;if(i=this._directory(),r=s.join(i,e),void 0!==t&&this.emitter.emit("file"),t)return o=t.value,delete t.value,this._writeFile(r,o),$.totalStorage("GolemFile_"+r,t);if(n=$.totalStorage("GolemFile_"+r))try{n.value=this._readFile(r)}catch(a){}return n},t.prototype._writeFile=function(e,t){return n.writeFileSync(""+e+".shem",t)},t.prototype._readFile=function(e){return n.readFileSync(""+e+".shem",{encoding:"utf8"})},t.prototype.writeBuilt=function(e){var t;return t=this._directory(),n.writeFileSync(s.join(t,"..","index.js"),e)},t}(o)});