define(function(require,exports,module){var e,t,r,n,o,i,s,a=module.uri||"",u=(a.substring(0,a.lastIndexOf("/")+1),{}.hasOwnProperty),d=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};e=require("tinyemitter"),r=require("./Memory"),requireNode&&(o=requireNode("fs"),s=requireNode("path"),i=requireNode("mkdirp")),n=function(e,t){var r,n,o;r={};for(n in e)o=e[n],t(n,o)&&(r[n]=o);return r},module.exports=t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return d(t,e),t.prototype._directory=function(){var e;return e=s.join(process.env.PWD,window.GolemOpenFilePath,"src"),i.sync(e),e},t.prototype._countLines=function(e,t){return this._readFile(s.join(e,t)).split("\n").length},t.prototype.fileTable=function(){},t.prototype._fileTableStorage=function(e){var t,r,n,i,a,u,d,c;if(void 0!==e&&this.emitter.emit("fileTable"),!e){for(a={},i=this._directory(),c=o.readdirSync(i),u=0,d=c.length;d>u;u++)r=c[u],t=s.extname(r),"shem"===t.slice(1)&&(n=s.basename(r,t),a[n]={name:n,numLines:this._countLines(i,n)});return a}},t.prototype._fileStorage=function(e,t){var r,n,o,i;if(i=this._directory(),n=s.join(i,e),void 0!==t&&this.emitter.emit("file"),t)return r=t.value,delete t.value,this._writeFile(n,r),$.totalStorage("GolemFile_"+n,t);if(o=$.totalStorage("GolemFile_"+n))try{o.value=this._readFile(n)}catch(a){}return o},t.prototype._writeFile=function(e,t){return o.writeFileSync(""+e+".shem",t)},t.prototype._readFile=function(e){return o.readFileSync(""+e+".shem",{encoding:"utf8"})},t.prototype.writeBuilt=function(e){var t;return t=this._directory(),o.writeFileSync(s.join(t,"..","index.js"),e)},t}(r)});